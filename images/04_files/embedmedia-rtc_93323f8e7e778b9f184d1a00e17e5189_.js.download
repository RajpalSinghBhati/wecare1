!function(){var w={WAITING_TIME_30:3e4,WAITING_TIME:6e4,RINGTONE_DURATION:65e3,WAITING_TIME_SECS:60,audio:"audio",video:"video",screen_share:"screen_share",screen_view:"screen_view",request_screen:"request_screen",audio_unified_mix:"audio_unified_mix",audio_smart:"audio_smart",screen_share_smart:"screen_share_smart",screen_view_smart:"screen_view_smart",data_channel:"data_channel",mic_permission_blocked:"mic_permission_blocked",screen_permission_blocked:"screen_permission_blocked",monitor:"monitor",call_timer:"call_timer",waiting_timer:"waiting_timer",isAlreadySharing:"isAlreadySharing",0:"audio",2:"video",1:"screen_share",connecting:"connecting",connected:"connected",cancelled:"cancelled",sharing:"sharing",viewing:"viewing",facebookUrl:"https://facebook.com/pages",negotiation:"negotiation",offer:"offer",answer:"answer",height:"260",width:"400",reinit:"reinit",accept:"accept",miss:"miss",reject:"reject",end:"end",failed:"failed",request:"request",restart:"restart",candidates:"candidates",candidate:"candidate",screenshare:"screenshare",voicemessage:"voicemessage",upstream:"upstream",downstream:"downstream",incoming:"incoming",outgoing:"outgoing",ringing:"ringing",missed:"missed",rejected:"rejected",queued:"queued",reconnecting:"reconnecting",requested:"requested",invited:"invited",ended:"ended",cancel:"cancel",init_monitor:"init_monitor",leave_monitor:"leave_monitor",monitor_join:"monitor_join",monitor_end:"monitor_end",monitoring:"monitoring",visitor:"visitor",stopscreen:"stopscreen",click:"click",keyup:"keyup",stopsharing:"stopsharing",Zoho_SalesIQ:"Zoho_SalesIQ",window:"window",screen:"screen",Entire_Screen:"Entire Screen",desktop:"desktop",function:"function",requestscreensahre:"requestscreensahre",showConstent:"showConsent",call_initiate:"call_initiate",call_cancel:"call_cancel",call_miss:"call_miss",call_failed:"call_failed",invite:"invite",setCredential:"setCredential",handleInvitation:"handleInvitation",handleCallAccept:"handleCallAccept",handleCallReject:"handleCallReject",handleCandidates:"handleCandidates",handleCallAnswer:"handleCallAnswer",handleCallEnd:"handleCallEnd",handleCallOffer:"handleCallOffer",handleCallCancel:"handleCallCancel",handleCallMissed:"handleCallMissed",handleCallInvite:"handleCallInvite",handleCallRequest:"handleCallRequest",handleCallFailed:"handleCallFailed",audiocall:"audiocall",outgoingcall:"outgoingcall",incomingcall:"incomingcall",siq_directcall:"siq_directcall",siq_unifiedMedia:"siq_unifiedMedia",status:"status",is_refreshed:"is_refreshed",media_inv:"media_inv",https:"https",User_Agent:"User-Agent",disable:"disable",show:"show",hide:"hide",media_active:"media_active",requestCancelled:"requestCancelled",requestRejected:"requestRejected",requestMissed:"requestMissed",mediaCallDetails:"mediaCallDetails",mediaDetailsKeys:{wmsPushData:"wmsPushData",apiData:"apiData",callStatus:"callStatus",isCallInitiatedFromOldUI:"isCallInitiatedFromOldUI",isMobileOperator:"isMobileOperator"},chidMapList:"chidMapList",activity:{MEDIA_AUDIO_INITIATE:101,MEDIA_AUDIO_ACCEPT:102,MEDIA_AUDIO_OFFER:103,MEDIA_AUDIO_ANSWER:104,MEDIA_AUDIO_CONNECT:105,MEDIA_AUDIO_REJECT:106,MEDIA_AUDIO_CANCEL:107,MEDIA_AUDIO_END:108,MEDIA_AUDIO_MISS:109,MEDIA_AUDIO_UI_SHOWN:131,MEDIA_AUDIO_UI_CLEARED:132,MEDIA_AUDIO_INVITATION_SHOWN:133,MEDIA_AUDIO_INVITATION_CLEARED:134,MEDIA_AUDIO_OUTGOING_UI_SHOWN:135,MEDIA_AUDIO_OUTGOING_UI_CLEARED:136,MEDIA_AUDIO_INCOMING_SOUND_START:146,MEDIA_AUDIO_OUTGOING_SOUND_START:147,MEDIA_AUDIO_SOUND_STOP:148,MEDIA_AUDIO_MIC_PERMISSION_ALLOWED:149,MEDIA_AUDIO_MIC_PERMISSION_BLOCKED:150,MEDIA_AUDIO_INPUT_DEVICE_CHANGED:151,MEDIA_AUDIO_OUTPUT_DEVICE_CHANGED:152,MEDIA_AUDIO_MUTE:161,MEDIA_AUDIO_UNMUTE:162,MEDIA_AUDIO_VOICE:163,MEDIA_AUDIO_START:164,MEDIA_AUDIO_RECONNECT_STATE:165,MEDIA_AUDIO_RENEGOTIATION_INITIATE:171,MEDIA_AUDIO_RENEGOTIATION_ACCEPT:172,MEDIA_AUDIO_RENEGOTIATION_CANCEL:173,MEDIA_AUDIO_RENEGOTIATION_REJECT:174,MEDIA_AUDIO_RENEGOTIATION_MISS:175,MEDIA_AUDIO_RENEGOTIATION_TRACKADDED:176,MEDIA_AUDIO_RENEGOTIATION_TRACKREMOVED:177,MEDIA_SCREENSHARE_INITIATE:201,MEDIA_SCREENSHARE_ACCEPT:202,MEDIA_SCREENSHARE_OFFER:203,MEDIA_SCREENSHARE_ANSWER:204,MEDIA_SCREENSHARE_CONNECT:205,MEDIA_SCREENSHARE_REJECT:206,MEDIA_SCREENSHARE_CANCEL:207,MEDIA_SCREENSHARE_END:208,MEDIA_SCREENSHARE_MISS:209,MEDIA_SCREENSHARE_UI_SHOWN:231,MEDIA_SCREENSHARE_UI_CLEARED:232,MEDIA_SCREENSHARE_CONFIRMBOX_SHOWN:233,MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED:234,MEDIA_SCREENSHARE_POPUP_SHOWN:235,MEDIA_SCREENSHARE_POPUP_CLEARED:236,MEDIA_SCREENSHARE_PLAYER_SHOWN:237,MEDIA_SCREENSHARE_PLAYER_CLEARED:238,MEDIA_SCREENSHARE_SCREEN_PERMISSION_ALLOWED:246,MEDIA_SCREENSHARE_SCREEN_PERMISSION_BLOCKED:247,MEDIA_SCREENSHARE_SHARESCREEN:261,MEDIA_SCREENSHARE_REQUESTSCREEN:262,MEDIA_SCREENSHARE_RECONNECT_STATE:263,MEDIA_SCREENSHARE_SWAP:264,MEDIA_SCREENSHARE_RENEGOTIATION_REQUEST:271,MEDIA_SCREENSHARE_RENEGOTIATION_ACCEPT:272,MEDIA_SCREENSHARE_RENEGOTIATION_CANCEL:273,MEDIA_SCREENSHARE_RENEGOTIATION_REJECT:274,MEDIA_SCREENSHARE_RENEGOTIATION_MISS:275,MEDIA_SCREENSHARE_RENEGOTIATION_TRACKADDED:276,MEDIA_SCREENSHARE_RENEGOTIATION_TRACKREMOVED:277},TURN_URL:["geo","primary","secondary","default"],error_code:{AUDIO_CALL_NOT_ALLOWED:5001,UNABLE_TO_INTIATE_CALL:5004,ALREADY_CLOSE_CONVERSATION:6104,INVALID_CHAT_ID:6006,invalid_chat_errors:[6104,6006]},iceConnectionStates:{CONNECTED:"connected",COMPLETED:"completed",FAILED:"failed",DISCONNECTED:"disconnected",CLOSED:"closed"},callMode:{P2P:"visitor",O2O:"operator",UNIFIED_P2P:"unifiedVisitor"},connectionType:{PEER2PEER:"p2p",UNIFIED:"unified",SMART:"smart"},audioCallAllowedBrowserVersions:{chrome:53,firefox:68,opera:40,safari:11,edge:79},screenShareAllowedBrowserVersions:{chrome:72,firefox:66,opera:60,safari:13,edge:79},consent_audioandscreen:"audio_call_and_screen_share",consent_recordingdisabled:"do_not_record",consent_onlyaudio:"audio_call",mediaUserTypes:{owner:"owner",available_monitor:"available_monitor",silent_monitor:"silent_monitor",active_monitor:"active_monitor",transferee:"transferee"}};function R(e){try{return JSON.parse(e)}catch(e){}return N(e)?e:{}}function D(e){try{return JSON.stringify(e)}catch(e){}return""}function P(e){return"function"==typeof e}function N(e){return"object"==typeof e}function v(e){return!!(e&&0<Object.keys(e).length)}function L(t){return N(t)?Object.keys(t).map(function(e){return(encodeURIComponent(e)+"="+encodeURIComponent(t[e])).replace(/%2C/g,",").replace(/%2F/g,"/")}).filter(Boolean).join("&").replace(/%20/g,"+"):encodeURIComponent(t)}function j(){}function V(l,u,e){var n,t=Object.assign({},{aspectRatio:1.6,widthRange:{min:w.width,max:(u?window.parent:window).innerWidth},heightRange:{min:w.height,max:(u?window.parent:window).innerHeight}},e),p=1!==t.aspectRatio,i={},h={},a={},o=0,s=0,r=!1,m={},c="",e=R(localStorage.getItem("siqmedia_ss_playersize")),d=e?e.width:"",e=e?e.height:"";d&&(l.style.width=d+"px"),e&&(l.style.height=e+"px");function _(e,t,i){return Math.min(Math.max(e,t),i)}function g(e){e=e?1:-1;return{width:_(h.width+e*i.x,t.widthRange.min,t.widthRange.max),height:_(h.height+e*i.y,t.heightRange.min,t.heightRange.max),aspectRatioWidth:_(h.width+i.y*(e*t.aspectRatio),t.widthRange.min,t.widthRange.max),aspectRatioHeigth:_(h.height+i.x/(e*t.aspectRatio),t.heightRange.min,t.heightRange.max)}}function f(e,t,i,n){var a,o,s,r,c,d;n+t<=(u?window.parent:window).innerHeight&&i+e<=(u?window.parent:window).innerWidth&&(o=a=r=s="",n===m.top?s=m.top:r=m.bottom,i===m.left?a=m.left:o=m.right,n=e.toString(),i=t.toString(),e=s.toString(),t=r.toString(),s=a.toString(),r=o.toString(),localStorage.setItem("siqmedia_ss_playersize",D({width:n,height:i})),n&&(l.style.width=n+"px"),i&&(l.style.height=i+"px"),e&&r?(d=i-h.height,c=n-h.width,l.style.top=e+"px",l.style.right=r+"px",l.style.left=p?m.left-c+"px":m.left+"px",l.style.bottom=p?m.bottom-d+"px":m.bottom+"px"):e&&s?(c=i-h.height,d=n-h.width,l.style.top=e+"px",l.style.left=s+"px",l.style.bottom=p?m.bottom-c+"px":m.bottom+"px",l.style.right=p?m.right-d+"px":m.right+"px"):s&&t?(e=i-h.height,c=n-h.width,l.style.left=s+"px",l.style.bottom=t+"px",l.style.top=p?m.top-e+"px":m.top+"px",l.style.right=p?m.right-c+"px":m.right+"px"):t&&r&&(d=i-h.height,s=n-h.width,l.style.bottom=t+"px",l.style.right=r+"px",l.style.top=p?m.top-d+"px":m.top+"px",l.style.left=p?m.left-s+"px":m.left+"px"))}function y(e){(u?window.parent:window).removeEventListener("mousemove",S)}function C(e){!0===r&&(r=!1,(u?window.parent:window).removeEventListener("mousemove",I))}var v={top_left_corner:function(){var e=g(!1);f(e.aspectRatioWidth,e.height,m.right,m.bottom)},top_border:function(){var e=g(!1);f(p?e.aspectRatioWidth:h.width,e.height,m.right,m.bottom)},top_right_corner:function(){var e=g(!0);f(e.width,e.aspectRatioHeigth,m.left,m.bottom)},right_border:function(){var e=g(!0);f(e.width,p?e.aspectRatioHeigth:h.height,m.left,m.bottom)},bottom_right_corner:function(){var e=g(!0);f(e.aspectRatioWidth,e.height,m.left,m.top)},bottom_border:function(){var e=g(!0);f(p?e.aspectRatioWidth:h.width,e.height,m.left,m.top)},bottom_left_corner:function(){var e=g(!1);f(e.width,e.aspectRatioHeigth,m.right,m.top)},left_border:function(){var e=g(!1);f(e.width,p?e.aspectRatioHeigth:h.height,m.right,m.top)}},S=function(e){e.preventDefault(),i={x:e.pageX-a.x,y:e.pageY-a.y},v[c](e)},I=function(e){A(e),e.preventDefault();var t,i,n=parseInt(getComputedStyle(l,null).getPropertyValue("left").replace("px","")),a=parseInt(getComputedStyle(l,null).getPropertyValue("top").replace("px",""));return n<0||a<0?(n<0&&(l.style.left="0px"),a<0&&(l.style.top="0px"),r=!1,void(u?window.parent:window).removeEventListener("mousemove",I)):(t=parseInt(getComputedStyle(l,null).getPropertyValue("right").replace("px","")),i=parseInt(getComputedStyle(l,null).getPropertyValue("bottom").replace("px","")),t<0||i<0?(e.pageX,e.pageY,t<0&&(l.style.left=n+t+"px"),i<0&&(l.style.top=a+i+"px"),t<0&&(l.style.right="0px"),i<0&&(l.style.bottom="0px"),r=!1,void(u?window.parent:window).removeEventListener("mousemove",I)):(l.style.left=e.pageX-o+"px",l.style.top=e.pageY-s+"px",l.style.right=(u?window.parent:window).innerWidth-h.width-(e.pageX-o)+"px",void(l.style.bottom=(u?window.parent:window).innerHeight-h.height-(e.pageY-s)+"px")))};function A(e){e.stopPropagation(),e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1}l.addEventListener("mousedown",function(e){var t,i;A(e),e.preventDefault(),h={width:parseInt(getComputedStyle(l,null).getPropertyValue("width").replace("px","")),height:parseInt(getComputedStyle(l,null).getPropertyValue("height").replace("px",""))},a={x:e.pageX,y:e.pageY},n=l.getBoundingClientRect(),m={right:(u?window.parent:window).innerWidth-n.left-h.width,bottom:(u?window.parent:window).innerHeight-n.top-h.height,left:n.left,top:n.top},(c=e.target.getAttribute("position"))?((u?window.parent:window).addEventListener("mousemove",S),(u?window.parent:window).addEventListener("mouseup",y)):(e.preventDefault(),r=!0,t=parseInt(getComputedStyle(l,null).getPropertyValue("left").replace("px","")),i=parseInt(getComputedStyle(l,null).getPropertyValue("top").replace("px","")),o=e.pageX-t,s=e.pageY-i,(u?window.parent:window).addEventListener("mousemove",I),(u?window.parent:window).addEventListener("mouseup",C))})}j.prototype.request=function(e){var t=e.url,i=e.type,n=e.data,a=e.rest,o=new XMLHttpRequest;o.open(i,this.processUrl(t,i,n),!0),o.onreadystatechange=this.handleStateChange(e),this.beforeSend(o,e),o.send(function(e,t,i){if(-1!=["POST","PUT"].indexOf(e))return i?JSON.stringify(t):L(t);["GET","DELETE"].indexOf(e)}(i,n,a))},j.prototype.processUrl=function(e,t,i){return-1!=["GET","DELETE"].indexOf(t)&&i&&"object"==typeof i&&0<Object.keys({}).length?e+"?"+L(i):e},j.prototype.handleStateChange=function(n){return function(){var e,t,i="2"===this.status.toString()[0]?n.success:n.error;4===this.readyState&&(i=i,e=R(this.response),void 0===t&&(t=!1),P(i)&&(t?i.call(t,e):i(e)))}},j.prototype.beforeSend=function(e,t){var i=t.rest?"application/json":"application/x-www-form-urlencoded",n=SiqAVRouter.container.detailsHandler.isembed;n||e.setRequestHeader("X-reqsrc","ajax"),-1!=["POST","PUT","DELETE"].indexOf(t.type)&&(n||e.setRequestHeader("X-ZCSRF-TOKEN","zls_csrparam="+function(e){if(2==(e=("; "+document.cookie).split("; "+e+"=")).length)return e.pop().split(";").shift()}("LS_CSRF_TOKEN")),e.setRequestHeader("Content-Type",i))};function a(e,t){this.container=t,this._statsObjects={},this._statsGatheringInterval=void 0,this._statsGatheringIntervalTime=1e3,this.statsConstants={connectedTransportKeyIncludes:"RTCTransport_",candidateKeyIncludes:"RTCIceCandidate",hostCandidateTypeValue:"host",candidatePairType:"candidate-pair",candidatePairSelectedState:"succeeded",localCandidateType:"local-candidate",remoteCandidateType:"remote-candidate"},this.statValidKeysMapping={RTCLiveIceCandidatePair:{bytesSent:"bytessent",bytesReceived:"bytesreceived",availableOutgoingBitrate:"availablebitrate",availableIncomingBitrate:"recvbitrate",totalRoundTripTime:"totalrtt",currentRoundTripTime:"rtt"},RTCOutboundRTPVideoStream_:{pliCount:"videoplisrecv",nackCount:"videonacksrecv"},RTCInboundRTPAudioStream_:{packetsLost:"recvaudiopacketlost"},RTCInboundRTPVideoStream_:{pliCount:"videoplissent",nackCount:"videonackssent",packetsLost:"recvvideopacketlost"}},this._initiateGathering(e)}function o(e,t){var n=this;this.container=t,this._id=e.mediaID,this._connection=e.connection,this._timeVsStats={},this._networkInfo={},this._networkInfoCallBack=e.networkInfoCallBack,this._updateStatsCallBack=e.updateStatsCallBack,this._hasSentNetworkInfo=!1,this._statsObjectMaxSize=30,o.prototype.setNetworkInfo=function(e,t,i){n._networkInfo={network_type:e,private_ip:t,public_ip:i}},o.prototype.getId=function(){return this._id},o.prototype.getConnection=function(){return this._connection},o.prototype.isConnectionActive=function(){var e=this.getConnection().iceConnectionState;return e===w.iceConnectionStates.CONNECTED||e===w.iceConnectionStates.COMPLETED},o.prototype.isConnectionClosed=function(){return this.getConnection().iceConnectionState===w.iceConnectionStates.CLOSED},o.prototype.hasSentNetworkInfo=function(){return this._hasSentNetworkInfo},o.prototype.sendNetworkInfo=function(){"function"==typeof this._networkInfoCallBack&&this._networkInfoCallBack(this._id,this._networkInfo),this._hasSentNetworkInfo=!0},o.prototype.updateAndSendStats=function(e,t){this._timeVsStats[e]=t,Object.keys(this._timeVsStats).length===this._statsObjectMaxSize&&this._sendStats()},o.prototype._sendStats=function(){this._updateStatsCallBack(this._id,this._timeVsStats),this._timeVsStats={}}}a.prototype._isHostCandidate=function(e){return(this._isLocalCandidate(e)||this._isRemoteCandidate(e))&&e.candidateType===this.statsConstants.hostCandidateTypeValue},a.prototype._isLocalCandidate=function(e){return void 0!==e&&e.type===this.statsConstants.localCandidateType},a.prototype._isRemoteCandidate=function(e){return void 0!==e&&e.type===this.statsConstants.remoteCandidateType},a.prototype._isCandidatePair=function(e){return void 0!==e&&e.type===this.statsConstants.candidatePairType},a.prototype._isCandidatePairSelected=function(e){return this._isCandidatePair(e)&&e.state===this.statsConstants.candidatePairSelectedState},a.prototype._getSelectedCandidatePair=function(e){var t=void 0,i=e.values(),n=void 0;do{var a=(n=i.next()).value;if(this._isCandidatePairSelected(a)){t=a.id;break}}while(!n.done);return t},a.prototype._getValidStatKey=function(e){for(var t in this.statValidKeysMapping)if(-1!==e.indexOf(t)||e.toUpperCase()===t.toUpperCase())return t},a.prototype._redefineStats=function(e,t){var i={},e=this._getValidStatKey(e);if(e){var n,a=this.statValidKeysMapping[e];for(n in a)i[a[n]]=t[n]}return i},a.prototype._findHostCandidate=function(e,i){var n,a=this;return e.forEach(function(e,t){a._isHostCandidate(e)&&e.networkType===i&&(n=e)}),n},a.prototype._updateAndSendNetworkInfo=function(e,t,i){var i=t.get(i.localCandidateId),n=i.networkType,a=i.ip||i.address,o=void 0,s=void 0;void 0!==(s=this._isHostCandidate(i)?i:this._findHostCandidate(t,n))&&(o=s.ip||s.address),e.setNetworkInfo(n,o,a),e.sendNetworkInfo()},a.prototype._updateStatsData=function(n){var a=this,e=n.getConnection();n.isConnectionClosed()?this._stopGathering(n.getId()):n.isConnectionActive()&&e.getStats().then(function(e){var i,t=a._getSelectedCandidatePair(e);void 0!==t&&(t=e.get(t),n.hasSentNetworkInfo()||a._updateAndSendNetworkInfo(n,e,t),i=a._redefineStats("RTCLiveIceCandidatePair",t),e.forEach(function(e,t){i=Object.assign({},i,a._redefineStats(t,e))}),n.updateAndSendStats((new Date).getTime(),i))})},a.prototype._initiateGathering=function(e){var t,i=this,n=e.mediaID;this.container.MediaDetails.checkBrowserSupportedForStats()&&((t=this._statsObjects[n]||{})[n]=new o(e,this.container),this._statsObjects=t,void 0===this._statsGatheringInterval&&(this._statsGatheringInterval=setInterval(function(){i._gatherStats()},this._statsGatheringIntervalTime)))},a.prototype._gatherStats=function(){for(var e in this._statsObjects){e=this._statsObjects[e];try{this._updateStatsData(e)}catch(e){}}},a.prototype._stopGathering=function(e){var t=this._statsObjects[e];t&&t._sendStats(),delete this._statsObjects[e],0===Object.keys(this._statsObjects).length&&(clearInterval(this._statsGatheringInterval),this._statsGatheringInterval=void 0)};function S(e,t){this.container=t,this.sdpConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!1},this.audio="audio",this.screen_share="screen_share",this.video="video",this.curr_connection={audio:!1,screen_share:!1,video:!1},this.init(e)}function n(e,t){this.container=t,this.sdpConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!1},this.audio="audio",this.screen_share="screen_share",this.video="video",this.curr_connection={audio:!1,screen_share:!1,video:!1},this.init(e)}function e(e){(this.container=e).audioImpl=this,e.audio_unified_mixImpl=this,e.audio_smartImpl=this,(e.data_channelImpl=this).init(),this.audio="audio",this.timeout={},this.iconClicked={},this.reinit=!1,this.isWaitingForPermission=!1}function t(e){e.videoImpl=this}function i(e){e.screenShareImpl=this,e.screen_viewImpl=this,e.screen_share_smartImpl=this,(e.screen_view_smartImpl=this).container=e,this.timeout={},this.init(),this.reinit=!1,this.removeTrackOnReNegotiation=!1}function s(e){((this.container=e).commonImpl=this).reloadCheck=!1}S.prototype.init=function(e){this.chid=e.chatid,this.mid=e.id,this.type=e.type,this.localDescription="",this.remoteDescription="",this.localStream="",this.remoteStream="",this.localIceCandidates=[],this.remoteIceCandidates=[],this.iceRestart=e.iceRestart,this.isUpStream=e.isUpStream,this.connectionStatus="",this.rtcConnection="",this.isReconnecting=!1,this.remoteCandidatePushed=!1,this.mediaRequest=e.mediaRequest,this.reconnectInterval=null,this.statsObj=null,this.reconnectEndTimer=null,this.audioStream=null,this.screenStream=null,this.remoteStream=[],this.remoteAudioStream=null,this.remoteScreenStream=null,this.screenRtpSenders=null,this.audioRtpSenders=null,this.videoRtpSenders=null,this.isOfferer=!1,this.remoteTracksId=null,this.isNegotiation=!1,this.negotiationType=null,this.streamType={audio:"audioStream",screen_share:"screenStream",video:"videoStream",screen_view:"screenStream"},this.streamData={audio:"audioRtpSenders",screen_share:"screenRtpSenders",screen_view:"screenRtpSenders",video:"videoRtpSenders"},this.currentPerfectRenegotiation=this.container.MediaDetails.getClientSupport().perfect_renegotiation,this.remotePerfectRenegotiation=e.perfectReNegotiation||!0,this.isFirstOfferer=!1,this.istransceiverAdded=!1,this.isCallConnected=!1,this.intRTCConn()},S.prototype.intRTCConn=function(){try{this.rtcConnection=new RTCPeerConnection(this.getCredentail()),this.getStream(),this.isUpStream&&(!this.iceRestart&&this[this.streamType[this.type]]&&this.addStream(),this.isFirstOfferer=!0,this.createOffer(),this[this.curr_connection[this.type]]=!0),this.getRemoteStream(),this.rtcConnectionStatus()}catch(e){}},S.prototype.getStream=function(){this[this.streamType[this.type]]=this.container.MediaPermission.getStreamByType(this.type)},S.prototype.getCredentail=function(){var t,i,n,e=this.mid,a=this.container.dataHandler.get(e+"_credential").credential;return a?(a=R(a),e=this.getServerUrl(a,e).split(","),t=a.user_name,i=a.token,n=[],e.forEach(function(e){n.push({username:t,urls:e,credential:i})}),{iceServers:n}):null},S.prototype.getServerUrl=function(e,t){var i=this.container.dataHandler;switch(i.get(t+"_nextTurnServer")){case w.TURN_URL[0]:return i.set(t+"_nextTurnServer",w.TURN_URL[1]),e.geo_turnurls||this.getServerUrl(e,t);case w.TURN_URL[1]:return i.set(t+"_nextTurnServer",w.TURN_URL[2]),e.primary_turnurls||this.getServerUrl(e,t);case w.TURN_URL[2]:return i.set(t+"_nextTurnServer",w.TURN_URL[3]),e.secondary_turnurls||this.getServerUrl(e,t);case w.TURN_URL[3]:if(i.remove(t+"_nextTurnServer"),e.servers)return e.servers;break;default:return i.remove(t+"_nextTurnServer"),e.servers}},S.prototype.createOffer=function(){var t=this,e=this.getSDPConstraints();this.iceRestart&&(e.iceRestart=!0),this.rtcConnection.createOffer(e).then(function(e){return t.offerSuccessCallBack(e)}).catch(function(e){return t.offerErrorCallBack(e)})},S.prototype.offerSuccessCallBack=function(e){var t=this.container,i=t.commonImpl,t=t.constants,e=(this.isOfferer=!0,this.localDescription=e,this.rtcConnection.setLocalDescription(new RTCSessionDescription(e)),{session:D(e)}),t=(this.isNegotiation&&(e.tracks_id=D(this.tracksId),e.negotiation_type=this.negotiationType,e.process_type=t.negotiation),{action:t.offer,success_cbk:null,failure_cbk:null,extraData:e});i.setApiData(this.mid,t),i.makeApiCall(this.mid),this.createIceCandidates()},S.prototype.offerErrorCallBack=function(e){},S.prototype.createAnswer=function(){var t=this;this.rtcConnection.createAnswer(this.sdpConstraints).then(function(e){return t.answerSuccessCallBack(e)}).catch(function(e){return t.answerErrorCallBack(e)})},S.prototype.answerSuccessCallBack=function(e){var t=this.container,i=t.commonImpl,t=t.constants,e=(this.localDescription=e,this.rtcConnection.setLocalDescription(new RTCSessionDescription(e)),{session:D(e)}),t=(this.negotiationType&&(e.tracks_id=D(this.tracksId),e.negotiation_type=this.negotiationType,e.process_type=t.negotiation),{action:t.answer,success_cbk:null,failure_cbk:null,extraData:e});i.setApiData(this.mid,t),i.makeApiCall(this.mid)},S.prototype.addStream=function(){var t=this;this[this.streamType[this.type]]&&this[this.streamType[this.type]].getTracks().forEach(function(e){t[t.streamData[t.type]]="function"==typeof t.rtcConnection.addTrack?t.rtcConnection.addTrack(e,t[t.streamType[t.type]]):t.rtcConnection.addStream(t[t.streamType[t.type]])})},S.prototype.createIceCandidates=function(){var i=this,e=this.container,n=e.commonImpl,a=e.constants;this.localIceCandidates=[],this.rtcConnection.onicecandidate=function(e){i.localIceCandidates.push(e);var t={};e.candidate&&(t.label=e.candidate.sdpMLineIndex,t.type=a.candidate,t.id=e.candidate.sdpMid,t.candidate=e.candidate.candidate,e={candidates:D(t)},t={action:a.candidates,success_cbk:null,failure_cbk:null,extraData:e},n.setApiData(i.mid,t),n.makeApiCall(i.mid))}},S.prototype.setRemoteDescription=function(e){var t=this;this.negotiationType&&this.negotiationType==this.audio&&!this.audioRtpSenders&&(this.audioStream=this.container.MediaPermission.getStreamByType("audio"),this.audioRtpSenders=this.addTrack(this.audioStream)),this.isUpStream||this.isReconnecting||this.iceRestart||!this.audioStream||this.audioRtpSenders||this.addStream(),this.rtcConnection.setRemoteDescription(new RTCSessionDescription(R(e))).then(function(){t.isOfferer||(t.createAnswer(),t.createIceCandidates()),t.clearReconnectNWTimer()}),this.remoteDescription=e,this.remoteCandidatePushed||this.pushIceCandidate(),this.negotiationType&&this.updateRemoteStream()},S.prototype.setOfferRemoteDescription=function(e){this.isOfferer=!1,this.localDescription=null,this.curr_connection.audio=!(!this.remoteTracksId||!this.remoteTracksId[this.audio]),this.curr_connection.screen_share=!(!this.remoteTracksId||!this.remoteTracksId[this.screen_share]),this.tracksId=this.container.MediaPermission.getTracksId(),this.setRemoteDescription(e)},S.prototype.setAnswerRemoteDesription=function(e){this.isOfferer=!0,this.setRemoteDescription(e)},S.prototype.pushIceCandidate=function(){var t=this;this.remoteIceCandidates.forEach(function(e){e=new RTCIceCandidate({sdpMid:e.id,sdpMLineIndex:e.label,candidate:e.candidate});t.rtcConnection.addIceCandidate(e)}),this.remoteCandidatePushed=!0},S.prototype.setIceCandidates=function(e){var t,e=R(e.candidates||e.msg.candidate);this.remoteDescription&&this.localDescription?(this.remoteIceCandidates&&0<this.remoteIceCandidates.length&&!this.remoteCandidatePushed&&this.pushIceCandidate(),t=new RTCIceCandidate({sdpMid:e.id,sdpMLineIndex:e.label,candidate:e.candidate}),this.rtcConnection.addIceCandidate(t)):(this.remoteIceCandidates&&0<this.remoteIceCandidates.length||(this.remoteIceCandidates=[]),this.remoteIceCandidates.push(e))},S.prototype.rtcConnectionStatus=function(){var n=this;this.rtcConnection.oniceconnectionstatechange=function(){var e,t=n.rtcConnection.iceConnectionState,i=n.mid;"connected"==t?(n.remoteIceCandidates=[],n.localIceCandidates=[],n.remoteDescription=null,n.localDescription=null,n.isCallConnected=!0,e=n.type+"Impl",n.container[e].callConnected(n),n.container.commonImpl.clearNetworkTimer(n),n.statsObj=new a({mediaID:i,connection:n.rtcConnection,networkInfoCallBack:n.container.commonImpl.sendRTCNetworkStats,updateStatsCallBack:n.container.commonImpl.sendRTCConnectionStats},n.container)):"failed"==t&&(n.isCallConnected?n.initReconnect():n.container.dataHandler.get(i+"_nextTurnServer")?(n.clearRTCData(),n.intRTCConn()):n.initCallFailed())},this.rtcConnection.onconnectionstatechange=function(e){var t=n.mid;"failed"==n.rtcConnection.connectionState&&(n.isCallConnected?n.initReconnect():n.container.dataHandler.get(t+"_nextTurnServer")?(n.clearRTCData(),n.intRTCConn()):n.initCallFailed()),"connected"==n.rtcConnection.iceConnectionState&&(n.remoteIceCandidates=[],n.localIceCandidates=[],n.remoteDescription=null,n.localDescription=null,n.isCallConnected=!0,n.updateRemoteStream())}},S.prototype.initReconnect=function(){this.isReconnecting=!0,this.iceRestart=!0,this.remoteIceCandidates=[],this.remoteDescription=null,this.remoteCandidatePushed=!1,this.container.commonImpl.checkNetwork(this.chid,this.mid)},S.prototype.initCallFailed=function(){this.container.commonImpl.callFailed(this.chid,this.mid)},S.prototype.getRemoteStream=function(){var t=this;this.rtcConnection.onaddstream=this.rtcConnection.ontrack=function(e){t.remoteStream.push(e),(e.streams&&e.streams[0]||e.stream)&&t.container[t.type+"Impl"].addRemoteStream(e,t),t.type!=t.screen_share&&"screen_view"!=t.type||t.negotiationType||e.streams&&(e.streams[0].onremovetrack=t.handleScreenTrackremoved),t.negotiationType&&e.streams&&e.streams[0]&&t.updateRemoteStream()}},S.prototype.updateRemoteStream=function(){try{for(var e in this.remoteStream){var t,i=this.remoteStream[e],n=null,n="track"==i.type?i.streams&&i.streams[0]?i.streams[0].id:null:i.stream?i.stream.id:null;for(t in this.remoteTracksId){var a=this.remoteTracksId[t];n&&n===a&&(this.container[t+"Impl"].addRemoteStream(i,this),t==this.screen_share&&i.streams&&i.streams[0]&&(i.streams[0].onremovetrack=this.handleScreenTrackremoved))}}}catch(e){}},S.prototype.handleScreenTrackremoved=function(){SiqAVRouter.container.commonImpl.handleScreenTrackEnd()},S.prototype.contructResponse=function(e){var t=this.mid,i=this.type,n=this.chid;return Object.assign({},{mid:t,type:i,chid:n},e)},S.prototype.closeConnection=function(){try{this.rtcConnection.close(),this.statsObj._stopGathering(this.mid),this[this.streamType[this.type]]&&this.closeTracksInStream(this[this.streamType[this.type]])}catch(e){}},S.prototype.closeTracksInStream=function(e){try{e.getTracks().forEach(function(e){return e.stop()})}catch(e){}},S.prototype.getSDPConstraints=function(){var e=this.type,t=(this.mid,this.chid),i=this.container,n=i.dataHandler,i=i.constants,n=(n.get(t+"_call_status",!0),{offerToReceiveAudio:!0,offerToReceiveVideo:!0});return e==i.audio?n.offerToReceiveVideo=!0:e==i.screen_share&&(n.offerToReceiveVideo=!0,n.offerToReceiveAudio=!0),n},S.prototype.clearReconnectNWTimer=function(){this.reconnectInterval&&(clearInterval(this.reconnectInterval),this.reconnectInterval=null,this.iceRestart=!1)},S.prototype.addAudioTrackInConnection=function(){return!!this.checkIsEligibleToCreateOfferOnNegotiation()&&(this.audioStream=this.container.MediaPermission.getStreamByType(this.audio),this.audioRtpSenders=this.addTrack(this.audioStream),this.isNegotiation=!0,this.negotiationType=this.audio,this.tracksId=this.container.MediaPermission.getTracksId(),this.curr_connection.audio=!0,this.curr_connection.screen_share=!0,this.createOffer(),!0)},S.prototype.removeAudioTrackInConnection=function(){this.rtcConnection.removeTrack(this.audioRtpSenders),this.container.MediaPermission.closeStreamByType(this.audio)},S.prototype.addScreenTrackInConnection=function(){return!!this.checkIsEligibleToCreateOfferOnNegotiation()&&(this.screenStream=this.container.MediaPermission.getStreamByType(this.screen_share),this.screenRtpSenders=this.addTrack(this.screenStream),this.isNegotiation=!0,this.negotiationType=this.screen_share,this.tracksId=this.container.MediaPermission.getTracksId(),this.curr_connection.audio=!0,this.curr_connection.screen_share=!0,this.createOffer(),this.istransceiverAdded=!0)},S.prototype.removeScreenTrackInConnection=function(){return!!this.checkIsEligibleToCreateOfferOnNegotiation()&&(this.rtcConnection.removeTrack(this.screenRtpSenders),this.container.MediaPermission.closeStreamByType(this.screen_share),this.isNegotiation=!0,this.negotiationType=this.screen_share,this.tracksId=this.container.MediaPermission.getTracksId(),this.curr_connection.audio=!0,this.curr_connection.screen_share=!1,this.screenRtpSenders=null,this.createOffer(),!0)},S.prototype.addTrack=function(t){var i,n=this;return t&&t.getTracks().forEach(function(e){i="function"==typeof n.rtcConnection.addTrack?n.rtcConnection.addTrack(e,t):n.rtcConnection.addStream(t)}),i},S.prototype.checkIsEligibleToCreateOfferOnNegotiation=function(){return!!(this.currentPerfectRenegotiation&&this.remotePerfectRenegotiation||this.isFirstOfferer)},S.prototype.screenShareRenegotiation=function(){this.isNegotiation=!0,this.negotiationType=this.screen_share,this.tracksId=this.container.MediaPermission.getTracksId(),this.istransceiverAdded||(this.rtcConnection.addTransceiver(this.video),this.istransceiverAdded=!0),this.createOffer()},S.prototype.handleScreenShareRenegotiation=function(e,t){(t=void 0===t?!1:t)?(this.rtcConnection.removeTrack(this.screenRtpSenders),this.container.MediaPermission.closeStreamByType(this.screen_share)):(this.screenStream=this.container.MediaPermission.getStreamByType(this.screen_share),this.screenRtpSenders=this.addTrack(this.screenStream)),this.isNegotiation=!0,this.negotiationType=this.screen_share,this.setOfferRemoteDescription(e)},S.prototype.audioRenegotiation=function(){this.__addAudioTracks(),this.isNegotiation=!0,this.negotiationType=this.audio,this.tracksId=this.container.MediaPermission.getTracksId(),this.createOffer()},S.prototype.handleAudioRenegotiation=function(e){this.__addAudioTracks(),this.isNegotiation=!0,this.negotiationType=this.audio,this.setOfferRemoteDescription(e)},S.prototype.__addAudioTracks=function(){this.audioStream=this.container.MediaPermission.getStreamByType(this.audio),this.audioRtpSenders=this.addTrack(this.audioStream)},S.prototype.clearRTCData=function(){this.remoteIceCandidates=[],this.remoteDescription=null,this.localDescription=null,this.audioRtpSenders=null,this.rtcConnection.close(),this.container.uiHandler.updateCallInvitationState(this.type,{chid:this.chid,media_id:this.mid},w.reconnecting)},n.prototype.init=function(e){this.chid=e.chatid||e.chid,this.mid=e.id,this.type=e.datatype||e.type,this.localDescription="",this.remoteDescription="",this.localStream="",this.remoteStream="",this.localIceCandidates=[],this.remoteIceCandidates=[],this.iceRestart=e.iceRestart||!1,this.isUpStream=e.isUpStream,this.connectionStatus="",this.rtcConnection="",this.isReconnecting=!1,this.remoteCandidatePushed=!1,this.mediaRequest=e.mediaRequest,this.reconnectInterval=null,this.statsObj=null,this.reconnectEndTimer=null,this.audioStream=null,this.screenStream=null,this.remoteStream=[],this.remoteAudioStream=null,this.remoteScreenStream=null,this.screenRtpSenders=null,this.audioRtpSenders=null,this.videoRtpSenders=null,this.isOfferer=!1,this.remoteTracksId=null,this.isNegotiation=!1,this.negotiationType=null,this.dataChannel=null,this.isDataChannel=e.isDataChannel||!1,this.streamType={audio:"audioStream",screen_share:"screenStream",video:"videoStream",screen_view:"screenStream",audio_unified_mix:"audioStream",audio_smart:"audioStream",screen_share_smart:"screenStream"},this.streamData={audio:"audioRtpSenders",screen_share:"screenRtpSenders",screen_view:"screenRtpSenders",video:"videoRtpSenders",audio_unified_mix:"audioRtpSenders",screen_share_smart:"screenRtpSenders",audio_smart:"audioRtpSenders"},this.currentPerfectRenegotiation=this.container.MediaDetails.getClientSupport().perfect_renegotiation,this.remotePerfectRenegotiation=e.perfectReNegotiation||!0,this.isFirstOfferer=!1,this.istransceiverAdded=!1,this.firstCandidate=null,this.creatorid=e.creatorid,this.isNotified=!1,this.intRTCConn()},n.prototype.intRTCConn=function(){try{this.rtcConnection=new RTCPeerConnection(this.getCredentail()),this.getStream(),this.isUpStream&&(this.iceRestart||!this[this.streamType[this.type]]||this.isDataChannel||this.addStream(),this.isFirstOfferer=!0,this.isDataChannel&&this.createDataChannel(),this.createOffer(),this[this.curr_connection[this.type]]=!0),this.getRemoteStream(),this.rtcConnectionStatus()}catch(e){}},n.prototype.getStream=function(){var e=this.type,t={audio_unified_mix:w.audio,audio_smart:w.audio,screen_share_smart:w.screen_share,screen_view_smart:w.screen_share},e=null!=t[e]?t[e]:e;this[this.streamType[this.type]]=this.container.MediaPermission.getStreamByType(e)},n.prototype.getCredentail=function(){var e,t,i,n,a=this.mid,a=this.container.dataHandler.get(a+"_credential");return a.credential?(e=(a=R(a.credential)).servers.split(","),t=a.user_name,i=a.token,n=[],e.forEach(function(e){n.push({urls:e,username:t,credential:i})}),{iceServers:n}):null},n.prototype.createOffer=function(){var t=this,e=this.getSDPConstraints();this.iceRestart&&(e.iceRestart=!0),this.rtcConnection.createOffer(e).then(function(e){return t.offerSuccessCallBack(e)}).catch(function(e){return t.offerErrorCallBack(e)})},n.prototype.offerSuccessCallBack=function(e){this.isOfferer=!0,this.localDescription=e,this.rtcConnection.setLocalDescription(new RTCSessionDescription(e)),this.isNegotiation?this.sendOffer():this.createIceCandidates()},n.prototype.sendOffer=function(){var e={description:this.localDescription.sdp,dataType:this.type},e=(this.firstCandidate&&(e.candidate=this.firstCandidate.candidate.candidate),this.tracksId&&(e.tracksId=this.tracksId),this.isNegotiation&&(e.negotiationType=this.negotiationType,e.processType="negotiation"),this.iceRestart&&(e.processType=w.restart),this.contructResponse(e)),t=this.type+"Impl";this.container[t].sendUnifiedOffer(e)},n.prototype.offerErrorCallBack=function(e){},n.prototype.createAnswer=function(){var t=this;this.rtcConnection.createAnswer(this.sdpConstraints).then(function(e){return t.answerSuccessCallBack(e)}).catch(function(e){return t.answerErrorCallBack(e)})},n.prototype.answerSuccessCallBack=function(e){this.localDescription=e,this.rtcConnection.setLocalDescription(new RTCSessionDescription(e))},n.prototype.sendAnswer=function(){var e={description:this.localDescription.sdp,candidate:this.firstCandidate.candidate.candidate,dataType:this.type,creatorid:this.creatorid},e=(this.isNegotiation&&(e.tracksId=this.tracksId,e.negotiationType=this.negotiationType,e.processType="negotiation"),this.contructResponse(e)),t=this.type+"Impl";this.container[t].sendUnifiedAnswer(e)},n.prototype.addStream=function(){var t=this;this[this.streamType[this.type]]&&this[this.streamType[this.type]].getTracks().forEach(function(e){t[t.streamData[t.type]]="function"==typeof t.rtcConnection.addTrack?t.rtcConnection.addTrack(e,t[t.streamType[t.type]]):t.rtcConnection.addStream(t[t.streamType[t.type]])})},n.prototype.createIceCandidates=function(){var t=this;this.localIceCandidates=[],this.rtcConnection.onicecandidate=function(e){t.firstCandidate?e.candidate&&e.candidate.candidate&&t.localIceCandidates.push(e.candidate.candidate):(t.firstCandidate=e,t.isOfferer?t.sendOffer():t.sendAnswer()),e.candidate}},n.prototype.sendCandidates=function(){this.container[this.type+"Impl"].sendUnifiedCandidates(this.contructResponse({candidates:this.localIceCandidates,isupstream:this.isUpStream,dataType:this.type,creatorid:this.creatorid}))},n.prototype.createDataChannel=function(){this.dataChannel=this.rtcConnection.createDataChannel("receiveChannel"),this.dataChannel.binaryType="arraybuffer"},n.prototype.setRemoteDescription=function(e){var t=this;this.rtcConnection.setRemoteDescription(new RTCSessionDescription(R(e))).then(function(){t.isOfferer||(t.createAnswer(),t.createIceCandidates()),t.clearReconnectNWTimer()}),this.remoteDescription=e,this.remoteCandidatePushed||this.pushIceCandidate(),this.negotiationType&&this.updateRemoteStream()},n.prototype.setOfferRemoteDescription=function(e){this.isOfferer=!1,this.localDescription=null,this.curr_connection.audio=!(!this.remoteTracksId||!this.remoteTracksId[this.audio]),this.curr_connection.screen_share=!(!this.remoteTracksId||!this.remoteTracksId[this.screen_share]),this.tracksId=this.container.MediaPermission.getTracksId(),this.setRemoteDescription(e)},n.prototype.setAnswerRemoteDesription=function(e){this.isOfferer=!0,this.setRemoteDescription(e)},n.prototype.pushIceCandidate=function(){var t=this;this.remoteIceCandidates.forEach(function(e){e=new RTCIceCandidate({sdpMid:e.id,sdpMLineIndex:e.label,candidate:e.candidate});t.rtcConnection.addIceCandidate(e)}),this.remoteCandidatePushed=!0},n.prototype.setIceCandidatesArray=function(e){this.remoteIceCandidates=e.candidates,this.pushUnifiedIceCandidate()},n.prototype.setIceCandidates=function(e){var t,e=R(e.candidates||e.msg.candidate);this.remoteDescription&&this.localDescription?(this.remoteIceCandidates&&0<this.remoteIceCandidates.length&&!this.remoteCandidatePushed&&this.pushIceCandidate(),t=new RTCIceCandidate({sdpMid:e.id,sdpMLineIndex:e.label,candidate:e.candidate}),this.rtcConnection.addIceCandidate(t)):(this.remoteIceCandidates&&0<this.remoteIceCandidates.length||(this.remoteIceCandidates=[]),this.remoteIceCandidates.push(e))},n.prototype.rtcConnectionStatus=function(){var i=this;this.rtcConnection.oniceconnectionstatechange=function(){var e,t=i.rtcConnection.iceConnectionState;"connected"==t?(i.remoteIceCandidates=[],i.remoteDescription=null,i.localDescription=null,e=i.type+"Impl",i.type!=w.data_channel&&i.container[e].unifiedcallConnected(i),i.container.commonImpl.clearNetworkTimer(i),!i.isUpStream||i.isNegotiation||i.isNotified||i.container.commonImpl.isCurrentUserMonitor(i.mid)||i.container[e].notifyUser(i)):"failed"==t&&i.initReconnect()},this.rtcConnection.onconnectionstatechange=function(e){"failed"==i.rtcConnection.connectionState&&i.initReconnect(),"connected"==i.rtcConnection.iceConnectionState&&(i.remoteIceCandidates=[],i.remoteDescription=null,i.localDescription=null,i.updateRemoteStream())}},n.prototype.initReconnect=function(){this.isReconnecting=!0,this.iceRestart=!0,this.remoteIceCandidates=[],this.remoteDescription=null,this.remoteCandidatePushed=!1,this.container.commonImpl.checkUnifiedNetwork(this)},n.prototype.getRemoteStream=function(){var t=this;this.rtcConnection.onaddstream=this.rtcConnection.ontrack=function(e){t.remoteStream.push(e),e.streams&&e.streams[0]&&t.container[t.type+"Impl"].addUnifiedRemoteStream(e,t),t.type!=t.screen_share&&"screen_view"!=t.type||t.negotiationType||e.streams&&(e.streams[0].onremovetrack=t.handleScreenTrackremoved),t.negotiationType&&e.streams&&e.streams[0]&&t.updateRemoteStream()}},n.prototype.updateRemoteStream=function(){try{for(var e in this.remoteStream){var t,i=this.remoteStream[e],n=null,n="track"==i.type?i.streams&&i.streams[0]?i.streams[0].id:null:i.stream?i.stream.id:null;for(t in this.remoteTracksId){var a=this.remoteTracksId[t];n&&n===a&&(this.container[t+"Impl"].addUnifiedRemoteStream(i,this),t==this.screen_share&&i.streams&&i.streams[0]&&(i.streams[0].onremovetrack=this.handleScreenTrackremoved))}}}catch(e){}},n.prototype.handleScreenTrackremoved=function(){SiqAVRouter.container.commonImpl.handleScreenTrackEnd()},n.prototype.contructResponse=function(e){var t=this.mid,i=this.type,n=this.chid;return Object.assign({},{mid:t,type:i,chid:n},e)},n.prototype.closeConnection=function(){try{this.rtcConnection.close(),this[this.streamType[this.type]]&&this.closeTracksInStream(this[this.streamType[this.type]])}catch(e){}},n.prototype.closeTracksInStream=function(e){try{e.getTracks().forEach(function(e){return e.stop()})}catch(e){}},n.prototype.getSDPConstraints=function(){var e=this.type,t=(this.mid,this.chid),i=this.container,n=i.dataHandler,i=i.constants,n=(n.get(t+"_call_status",!0),{offerToReceiveAudio:!0,offerToReceiveVideo:!1});return e==i.audio?n.offerToReceiveVideo=!1:e==i.screen_share||e==i.screen_share_smart||e==i.screen_view_smart?(n.offerToReceiveVideo=!0,n.offerToReceiveAudio=!1):e==i.data_channel&&(n.offerToReceiveVideo=!1,n.offerToReceiveAudio=!1),n},n.prototype.clearReconnectNWTimer=function(){this.reconnectInterval&&(clearInterval(this.reconnectInterval),this.reconnectInterval=null,this.iceRestart=!1)},n.prototype.addAudioTrackInConnection=function(){return!!this.checkIsEligibleToCreateOfferOnNegotiation()&&(this.audioStream=this.container.MediaPermission.getStreamByType(this.audio),this.audioRtpSenders=this.addTrack(this.audioStream),this.isNegotiation=!0,this.negotiationType=this.audio,this.tracksId=this.container.MediaPermission.getTracksId(),this.curr_connection.audio=!0,this.curr_connection.screen_share=!0,this.createOffer(),!0)},n.prototype.removeAudioTrackInConnection=function(){this.rtcConnection.removeTrack(this.audioRtpSenders),this.container.MediaPermission.closeStreamByType(this.audio)},n.prototype.addScreenTrackInConnection=function(){return!!this.checkIsEligibleToCreateOfferOnNegotiation()&&(this.screenStream=this.container.MediaPermission.getStreamByType(this.screen_share),this.screenRtpSenders=this.addTrack(this.screenStream),this.isNegotiation=!0,this.negotiationType=this.screen_share,this.tracksId=this.container.MediaPermission.getTracksId(),this.curr_connection.audio=!0,this.curr_connection.screen_share=!0,this.createOffer(),this.istransceiverAdded=!0)},n.prototype.removeScreenTrackInConnection=function(){return!!this.checkIsEligibleToCreateOfferOnNegotiation()&&(this.rtcConnection.removeTrack(this.screenRtpSenders),this.container.MediaPermission.closeStreamByType(this.screen_share),this.isNegotiation=!0,this.negotiationType=this.screen_share,this.tracksId=this.container.MediaPermission.getTracksId(),this.curr_connection.audio=!0,this.curr_connection.screen_share=!1,this.screenRtpSenders=null,this.createOffer(),!0)},n.prototype.addTrack=function(t){var i,n=this;return t&&t.getTracks().forEach(function(e){i="function"==typeof n.rtcConnection.addTrack?n.rtcConnection.addTrack(e,t):n.rtcConnection.addStream(t)}),i},n.prototype.checkIsEligibleToCreateOfferOnNegotiation=function(){return!!(this.currentPerfectRenegotiation&&this.remotePerfectRenegotiation||this.isFirstOfferer)},n.prototype.screenShareRenegotiation=function(){this.isNegotiation=!0,this.negotiationType=this.screen_share,this.tracksId=this.container.MediaPermission.getTracksId(),this.istransceiverAdded||(this.rtcConnection.addTransceiver(this.video),this.istransceiverAdded=!0),this.createOffer()},n.prototype.handleScreenShareRenegotiation=function(e,t){(t=void 0===t?!1:t)?(this.rtcConnection.removeTrack(this.screenRtpSenders),this.container.MediaPermission.closeStreamByType(this.screen_share)):(this.screenStream=this.container.MediaPermission.getStreamByType(this.screen_share),this.screenRtpSenders=this.addTrack(this.screenStream)),this.isNegotiation=!0,this.negotiationType=this.screen_share,this.setOfferRemoteDescription(e)},n.prototype.audioRenegotiation=function(){this.__addAudioTracks(),this.isNegotiation=!0,this.negotiationType=w.audio_unified_mix,this.firstCandidate=null,this.createOffer()},n.prototype.handleAudioRenegotiation=function(e){this.__addAudioTracks(),this.isNegotiation=!0,this.negotiationType=this.audio,this.setOfferRemoteDescription(e)},n.prototype.__addAudioTracks=function(){this.audioStream=this.container.MediaPermission.getStreamByType(this.audio),this.audioRtpSenders=this.addTrack(this.audioStream)},n.prototype.pushUnifiedIceCandidate=function(){var t=this;this.remoteIceCandidates.forEach(function(e){e=new RTCIceCandidate(R(e));t.rtcConnection.addIceCandidate(e)}),this.remoteCandidatePushed=!0},e.prototype.setCredential=function(e){this.container.commonImpl.setCredential(e)},e.prototype.handleInvitation=function(e,t){var i=this,n=(void 0===t&&(t=0),this.container),a=n.constants,o=n.detailsHandler,s=n.commonImpl,r=n.mediaUIHandler,n=s.getWmsPushData(e),c=n.chatid,d=n.type,l=n.mediaRequest,u=n.isOldUI,p=n.perfectReNegotiation,h=n.mediaInvitation,m=n.isMobileOperator,_=n.connection_type,n=n.recordingType,g=a.RINGTONE_DURATION,f={};if(o.isOldUI()?(f.is_old_ui=o.isOldUI(),_=w.connectionType.PEER2PEER):(_&&(d=s.getTypeFromConnectionType(_,d)),o.isEmbed()||o.checkAndFillVisitorStore(c)),s.endCallFromSameChat(e),o.canShowAudioCallInvitation(c))try{var y,C=s.getActiveCallData();if(o.isembed&&C&&C!=c)return y={action:a.reject,success_cbk:null,failure_cbk:null,extraData:f},s.setApiData(e,y),void s.makeApiCall(e);function v(){clearTimeout(i.timeout[e]),i.handleUIReject(e)}var S,I,A,R,D,b={rejectCbk:v,acceptCbk:function(){clearTimeout(i.timeout[e]),_==w.connectionType.PEER2PEER||!o.isEmbed()||i.isConsentBannerAccepted()||!o.isScreenRecordingEnabled()?i.handleUIAccept(e):i.showConsentUI(e,!0)},chid:c,media_id:e,isDirectCall:!1};if(s.checkIncomingCallAllowed(e))return S={action:a.reject,success_cbk:null,failure_cbk:null,extraData:f},s.setApiData(e,S),s.makeApiCall(e),!0;s.setCredential(e),u&&s.setIsCallInitiatedFromOldUI(u,e),m&&s.setIsMobileOperator(m,e),o.handleIncomingCall({type:d,chid:c}),h?(setTimeout(function(){r.handleAudioCallInvite(d,b)},500),I={callType:a.incoming,callStatus:a.ringing,mediarequest:l,host:a.downstream,isdirectcall:!1,isPerfectRenegotiation:p,type:d,connection_type:_,recording_type:n},s.setCallStatusData(e,I),A=s.getActiveTab(),R={chatid:c,type:a.audiocall,duration:A?"3":g,tone:A?a.outgoingcall:a.incomingcall,isEncrypted:!1},s.playMediaNotificationSound(R),s.sendMediaActivity({param:{action_type:R.tone==a.incomingcall?w.activity.MEDIA_AUDIO_INCOMING_SOUND_START:w.activity.MEDIA_AUDIO_OUTGOING_SOUND_START,add_info:o.getMediaActivityAddInfo()},mid:e}),s.showDesktopNotif({chatid:c}),this.timeout[e]=setTimeout(v,g)):(D={callType:a.incoming,callStatus:a.connecting,mediarequest:l,host:a.downstream,isdirectcall:!1,isPerfectRenegotiation:p,connection_type:_},s.setCallStatusData(e,D),this.handleUIAccept(e));var E={chid:c,type:d,media_id:e,status:w.incoming},k=(s.setMediaCache(w.siq_unifiedMedia,E),s.updateIncomingRequestData(e),"siqMedia: media invitation  | chid :"+c+" | mediaid : "+e+" | curUserId : "+o.getCurrentUserId());this.callBackAction(this.implConstants.postDebugLog,k),o.triggerIconCheck(c)}catch(e){}else t<3&&(0==t&&o.joinChat(c),setTimeout(function(){return i.handleInvitation(e,t++)},3e3))},e.prototype.handleCallRequest=function(a){var o=this,e=this.container,s=e.commonImpl,r=e.mediaUIHandler,t=e.dataHandler,c=e.MediaPermission,d=e.constants,i=e.detailsHandler,e=s.getWmsPushData(a),l=e.chatid,n=e.negotiationType,e=e.processType,u=t.get(l+"_peer")||{},p={process_type:d.negotiation,negotiation_type:n};if(i.isOldUI()&&(p.is_old_ui=i.isOldUI()),e&&e==d.reinit)s.getPeerObject(a).audioRenegotiation();else try{function h(){clearTimeout(o.timeout[a]),r.updateCallInvitationState(d.audio,{chid:l,media_id:a},d.rejected);var e={action:d.reject,success_cbk:null,failure_cbk:null,extraData:p};s.setApiData(a,e),s.makeApiCall(a)}var m={chid:l,media_id:a,rejectCbk:h,acceptCbk:function(){function e(){clearTimeout(o.timeout[a]);var e={action:d.reject,success_cbk:null,failure_cbk:null,extraData:p},i={chid:l,media_id:a,isDirectCall:s.getCallStatusData(a).isdirectcall,muteCbk:function(){return o.toggleMute()},rejectCbk:function(){return s.setApiData(a,e)&&s.makeApiCall(a)}},n=function(){clearTimeout(t)},t=setTimeout(function(){n=r.mediaPermissionUI()},3e3);s.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_RENEGOTIATION_ACCEPT},mid:a}),c.getAudioStream(function(){n(),s.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_MIC_PERMISSION_ALLOWED},mid:a}),r.updateCallInvitationState(d.audio,i,d.connecting);var e={action:d.accept,success_cbk:null,failure_cbk:null,extraData:p},t=s.isSmartFlow(a);s.setApiData(a,e),s.makeApiCall(a),t?o.addAudioCallInConnection():u[a].addAudioTrackInConnection()||o.handleInitReNegotiation(a),s.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_RENEGOTIATION_TRACKADDED}})},o.onDownStreamMediaPermissionFailureSecondary({chatid:l,id:a,cbk:n}))}i.isEmbed()&&!o.isConsentBannerAccepted()&&i.isScreenRecordingEnabled()&&i.isAudioRecordAllowed()?o.showConsentUIForAudioRequest(a,e):e.call()}};e&&e==w.negotiation&&(m.process_type=e),this.timeout[a]=setTimeout(h,65e3),r.handleAudioCallInvite(n,m)}catch(e){}},e.prototype.callConnected=function(e){var t=this,i=e.chid,n=(e.type,e.mid),e=(e.isReconnecting,this.container),a=e.commonImpl,o=e.dataHandler,s=e.mediaUIHandler,r=e.detailsHandler,c=e.constants,e=a.getCallStatusData(n).isdirectcall,d=(clearTimeout(o.get(n+"_connecting_timer")),e?function(){return t.handleUIApiCallEnd(n)}:function(){var e={action:c.end,success_cbk:null,failure_cbk:null,extraData:{}};a.setApiData(n,e),a.makeApiCall(n),t.handleCallEnd(n)}),l=n,s=(s.updateCallInvitationState(c.audio,{chid:i,callEndCbk:d,muteCbk:function(){return t.toggleMute()},media_id:l,isDirectCall:e},c.connected),a.updateMediaCache(w.siq_unifiedMedia,w.status,w.connected),a.getCallStatusData(n)),d=(s?(s.callStatus=c.connected,s.active_participants=[r.getCurrentUserId()]):s={callStatus:c.connected,active_participants:[r.getCurrentUserId()]},a.setCallStatusData(n,s),r.triggerIconCheck(i),a.sendMediaStats({id:n},"call connected "),"siqMedia: Audio call connected  | chid :"+i+" | mediaid : "+n+" | curUserId : "+r.getCurrentUserId()),l=(this.callBackAction(this.implConstants.postDebugLog,d),o.get(i+"_peer"));l&&l[n]&&l.reconnectEndTimer&&clearTimeout(l.reconnectEndTimer),e&&a.updateMediaCache(w.siq_directcall,w.status,w.connected),a.updateMediaStatsDetail({connectedTime:Date.now(),isreconnected:!1,mediaid:n}),a.getConnectedStatsDetail(n),a.makeApiCall(n),a.stopNotificationSound()},e.prototype.handleCallAccept=function(t){var i=this,e=this.container,n=e.dataHandler,a=e.constants,o=e.commonImpl,s=e.mediaUIHandler,e=e.detailsHandler,r=o.getWmsPushData(t),c=r.chatid,d=r.type,l=r.processType,u=r.isOldUI,p=r.isMobileOperator,h=r.perfectReNegotiation,m=r.connection_type,_=a.WAITING_TIME,g=c+"_peer",f=n.get(g)||{},y=o.getCallStatusData(t);if(clearTimeout(n.get(t+"_waiting_timer")),n.remove(t+"_waiting_timer"),e.handleOutgoingAccept({type:d,chid:c}),!l||l!=a.negotiation){u&&o.setIsCallInitiatedFromOldUI(u,t),p&&o.setIsMobileOperator(p,t);r.isUpStream=!0,r.iceRestart=!1,f[t]=new S(r,this.container),n.set(g,f),o.updateMediaCache(w.siq_unifiedMedia,w.status,w.accept);l=o.getCallStatusData(t),u=(l?(l.type=d,l.callStatus=a.connecting,l.isPerfectRenegotiation=h,l.connection_type=m):l={callStatus:a.connecting,isPerfectRenegotiation:h,connection_type:m},o.setCallStatusData(t,l),n.set(t+"_connecting_timer",setTimeout(function(){var e={action:a.end,success_cbk:null,failure_cbk:null,extraData:{}};o.setApiData(t,e),o.makeApiCall(t),i.clearData(t),s.updateCallInvitationState(a.audio,{chid:c,media_id:t},a.ended)},_)),{}),p=(e.isOldUI()&&(u.is_old_ui=e.isOldUI()),{action:y.host==a.upstream?a.cancel:a.reject,success_cbk:null,failure_cbk:null,extraData:u}),r=(o.setApiData(t,p),{chid:c,media_id:t,isDirectCall:y.isdirectcall,muteCbk:function(){return i.toggleMute()},rejectCbk:function(){return y.host,a.upstream,o.makeApiCall(t)}});s.updateCallInvitationState(a.audio,r,a.connecting),o.stopNotificationSound(),o.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_SOUND_STOP,add_info:e.getMediaActivityAddInfo()},mid:t});try{var C={type:d,acceptedTime:Date.now(),callerType:0,reconnectCount:0,mediaid:t};o.setMediaStatsDetail(C)}catch(e){}g="siqMedia: call accept request received  | chid :"+c+" | mediaid : "+t+" | curUserId : "+e.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,g)}},e.prototype.handleCallReject=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.dataHandler,o=t.detailsHandler,t=t.constants,s=i.getWmsPushData(e),r=s.chatid,c=s.processType,s=s.opruser,d=i.getCallStatusData(e),s={chid:r,media_id:e,isDirectCall:d.isdirectcall,lsuid:R(s).lsuid,process_type:c};delete this.iconClicked[r],clearTimeout(a.get(e+"_waiting_timer")),clearTimeout(a.get(e+"_connecting_timer")),n.updateCallInvitationState(t.audio,s,t.rejected),d.isdirectcall&&i.removeMediaCache(t.siq_directcall),c&&c==t.negotiation||(this.clearData(e),i.removeCredential(e),i.removeMediaCache(w.siq_unifiedMedia),o.handleCallRejected({type:t.audio,chid:r}),a="siqMedia: call reject request received  | chid :"+r+" | mediaid : "+e+" | curUserId : "+o.getCurrentUserId(),this.callBackAction(this.implConstants.postDebugLog,a))},e.prototype.handleCandidates=function(e){var t=this.container,i=t.dataHandler,t=t.commonImpl,n=t.getWmsPushData(e),a=n.chatid,o=i.get(a+"_peer")[e];o||((o={})[e]=new S(n,this.container),i.set(a+"_peer",o),o=o[e],t.setRemotePerfectReNegotiation(o,e,a)),o.setIceCandidates(n)},e.prototype.handleCallAnswer=function(e){var t=this.container,i=t.commonImpl,t=t.dataHandler,i=i.getWmsPushData(e),n=i.chatid,a=i.session,o=i.tracksId,i=i.negotiationType,t=t.get(n+"_peer")[e];t.remoteTracksId=o?JSON.parse(o):null,t.negotiationType=i||null,t.setAnswerRemoteDesription(a)},e.prototype.handleCallEnd=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.detailsHandler,o=t.constants,t=t.screenShareImpl,s=i.getWmsPushData(e).chatid,r=i.getCallStatusData(e),c={chid:s,media_id:e,isDirectCall:r.isdirectcall};n.updateCallInvitationState(o.audio,c,o.ended),r.isdirectcall&&i.removeMediaCache(o.siq_directcall),t.handleAudioCallEnd(s),this.clearData(e),a.removeAudioPlayers(),a.handleCallEnded({type:o.audio,chid:s})},e.prototype.handleCallOffer=function(e){var t,i,n,a,o,s,r=this.container,c=r.dataHandler,d=r.constants,l=r.MediaPermission,r=r.commonImpl;r.isSmartFlow(e)||(i=(t=r.getWmsPushData(e)).chatid,n=t.session,a=t.tracksId,o=t.negotiationType,s=c.get(i+"_peer")||{},l.getStreamByType(d.screen_share)&&o==d.screen_share&&c.set(d.isAlreadySharing,!0),t.isUpStream=!1,t.iceRestart=!1,l=s[e],s[e]||(s[e]=new S(t,this.container),c.set(i+"_peer",s),l=s[e]),l.remoteTracksId=a?JSON.parse(a):null,l.negotiationType=o||null,r.setRemotePerfectReNegotiation(l,e,i),this.reinit?l.handleAudioRenegotiation(n):l.setOfferRemoteDescription(n),this.reinit=!1)},e.prototype.handleCallCancel=function(e){try{var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.dataHandler,o=t.detailsHandler,s=t.constants,r=i.getWmsPushData(e),c=r.chatid,d=r.type,l=r.processType,u={chid:c,media_id:e,isDirectCall:i.getCallStatusData(e).isdirectcall};if(clearTimeout(this.timeout[e]),clearTimeout(a.get(e+"_waiting_timer")),clearTimeout(a.get(e+"_connecting_timer")),n.updateCallInvitationState(s.audio,u,s.cancelled),l&&l==s.negotiation)return;i.removeCredential(e),i.removeMediaCache(w.siq_unifiedMedia);var p="siqMedia: call cancel request received  | chid :"+c+" | mediaid : "+e+" | curUserId : "+o.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,p),this.clearData(e),o.handleCallCancelled({type:d,chid:c})}catch(e){}},e.prototype.handleCallFailed=function(e){try{var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.detailsHandler,o=t.constants,s=(t.screenShareImpl,i.getWmsPushData(e)),r=(s.processType,s.chatid),c=i.getCallStatusData(e),d={chid:r,media_id:e,isDirectCall:c.isdirectcall};n.updateCallInvitationState(o.audio,d,o.failed),c.isdirectcall&&i.removeMediaCache(o.siq_directcall),this.clearData(e),a.handleCallFailed({type:o.audio,chid:r})}catch(e){}},e.prototype.clearData=function(e){try{var t=this.container,i=t.detailsHandler,n=t.commonImpl,a=(t.mediaUIHandler,n.getWmsPushData(e));if(!a)return;var o=a.chatid,s="siqMedia: before clearing Audio call data  | chid :"+o+" | mediaid : "+e+" | curUserId : "+i.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,s),this.closePeerConn(e),this.closeAllPeerConn(e),n.removeCredential(e),n.checkAVIcon(o),n.clearCallDetails(o,e),n.clearMissedCallTimeout(e),n.getActiveCallData()&&n.getActiveCallData()==o&&(n.removeActiveCallData(),n.removeActiveTab(),this.clearMediaPermision(w.audio),i.removeAudioPlayers()),n.removeIncomingRequestData({id:e,chatid:o}),i.isEmbed()&&i.checkIsChatEndTimerAlive(o)||n.stopNotificationSound(),n.checkAndPlayNotification(),i.triggerIconCheck(o),n.clearConnectedStatsDetail(e),n.removeMediaCallDetails(e),n.removeChidMapList(o),n.removeMediaCache(w.siq_unifiedMedia)}catch(e){}},e.prototype.handleCallInvite=function(){},e.prototype.closePeerConn=function(t){var e=this.container,i=e.dataHandler,n=e.detailsHandler,e=e.commonImpl,a=e.getWmsPushData(t),o=a.type,a=a.chatid;try{var s,r=i.get(a+"_peer");r&&(s=r[t],e.clearNetworkTimer(s),s.closeConnection(),delete r[t],this.clearMediaPermision(e.getType(o)),this.removeAudioPlayer())}catch(e){i="siqMedia: error while clearing peer connection  | chid :"+a+" | mediaid : "+t+" | curUserId : "+n.getCurrentUserId()+" | error msg :"+e;this.callBackAction(this.implConstants.postDebugLog,i)}},e.prototype.clearMediaPermision=function(e){"audio_unified_mix"==e?e="audio":"screen_share_smart"!=e&&"screen_view_smart"!=e||(e="screen_share"),this.container.MediaPermission.closeStreamByType(e)},e.prototype.startAudioCall=function(e){var t=this,i=this.container,n=i.commonImpl,a=i.detailsHandler,o=i.mediaUIHandler,s=i.MediaPermission,r=i.MediaDetails,c=i.constants,d=e.chatid,l=e.normalchid,i=e.mode,u=n.getActiveCallData();if((!u||u==d||a.isEmbed())&&!this.iconClicked[l||d]){if(this.iconClicked[l||d]=!0,a.isoldUI&&(e.is_old_ui=a.isoldUI),e.perfect_renegotiation=r.getClientSupport().perfect_renegotiation,u){r=n.getMediaIdByChid(u),u=r?n.getCallStatusData(r):{};if(v(u)&&u.type==c.audio)return void delete this.iconClicked[l||d]}try{var p=a.isembed;if(i!=w.callMode.P2P||(!!p||this.isAudioCallAllowed(e))){if(a.isAudioCallDisabled(d))return void delete this.iconClicked[l||d];function h(){permissionUItimer=setTimeout(function(){g=o.mediaPermissionUI()},3e3);s.getAudioStream(function(){g(),t.onMediaPermissionSuccess(e).call(t)},t.onUpStreamMediaPermissionFailure(function(){return g()},d))}var m,_,g=function(){clearTimeout(permissionUItimer)},f=(this.isWaitingForPermission=!0,this.getAudioInputDevice()&&!a.isOldUI()&&(m=this.getAudioInputDevice(),s.updatePreferredDeviceByDeviceId(m,"audioInput")),o.getUIState().states),y=f&&f[l||d]&&f[l||d].screen_share;a.isEmbed()&&a.isScreenRecordingEnabled()&&a.isAudioRecordAllowed()&&!this.isConsentBannerAccepted()&&y?(delete this.iconClicked[l||d],_={cancelCbk:function(){t.handleUICancel(y.media_id)},muteCbk:function(){return t.toggleMute()},chid:l,media_id:y.media_id},o.handleAudioCallInitiate(c.audio,_),this.showConsentUI(y.media_id,!1,h,function(){t.hideConsentUI(y.media_id),t.isWaitingForPermission=!1;var e=n.getCallStatusData(y.media_id),e={chid:l||d,media_id:y.media_id,isDirectCall:e.isdirectcall};o.updateCallInvitationState(c.audio,e,c.rejected)})):h.call()}else{var C="siqMedia: To start AUDIO call - permission checks failed | chid - "+d+" ";this.callBackAction(this.implConstants.postDebugLog,C),delete this.iconClicked[l||d]}}catch(e){}}},e.prototype.constructResponeObj=function(e){return Object.assign({},{type:"audio"},e)},e.prototype.onMediaPermissionSuccess=function(t){var i=this;try{var e=this.container,n=e.constants,a=e.commonImpl,o=e.ajaxHandler,s=e.MediaPermission,r=t.normalchid,c=t.chatid,d=t.mode,l=t.mediainvitation,u=t.mediarequest,c=(t.type,n.WAITING_TIME_SECS,r||c),p=a.getMediaIdByChid(c),h=p?a.getCallStatusData(p):{};if(t.mode=d||n.visitor,!this.isCallAllowed(c))return s.closeStreamByType(n.audio),delete this.iconClicked[c],function(){i.isWaitingForPermission=!1};var m=this.constructResponeObj(t),_=(a.setActiveTab(),m.mediainvitation=l||!1,m.mediarequest=u||!1,a.constructURL(null,null));return a.setActiveCallData(c),a.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_MIC_PERMISSION_ALLOWED}}),function(){i.isWaitingForPermission=!1;var e=i.onstarted.bind(i);if(v(h))return m={},a.getCallStatusData(p).type,_=a.constructURL(n.audio,p),e=function(){return i.onstartedSecondary({chid:c,id:p,negotiationType:m.negotiation_type||n.audio})},m.action=w.request,m.process_type=w.negotiation,m.negotiation_type=w.audio,void o.put(_,m,e,i.startCallFailure.bind(i),!0,"v3");delete t.normalchid,m.normalchid&&delete m.normalchid,o.post(_,m,e,i.startCallFailure.bind(i),!0,!1,"v3")}}catch(e){}},e.prototype.onUpStreamMediaPermissionFailure=function(i,n){var a=this,e=this.container,o=e.commonImpl,s=e.mediaUIHandler;return function(e,t){o.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_MIC_PERMISSION_BLOCKED}}),i(),a.isWaitingForPermission=!1;e=o.getFailureMessage(e);s.mediaPermissionUnlock(),s.showDialog({desc:e,buttons:{accept:{text:"common.ok",callback:function(){return null}}}}),delete a.iconClicked[n]}},e.prototype.onDownStreamMediaPermissionFailure=function(e){var o=this,t=this.container,s=t.commonImpl,r=t.mediaUIHandler,c=t.detailsHandler,d=t.constants,l=e.chatid,u=e.id,p=e.cbk;return function(e,t){try{s.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_MIC_PERMISSION_BLOCKED},mid:u}),p(),r.mediaPermissionUnlock();var i=s.getFailureMessage(e),n={closed_reason:d.mic_permission_blocked},a=(c.isOldUI()&&(n.is_old_ui=c.isOldUI()),{action:d.reject,success_cbk:null,failure_cbk:null,extraData:n});s.setApiData(u,a),s.makeApiCall(u),c.handleCallRejected(),o.clearData(u),s.removeActiveTab(),r.updateCallInvitationState(d.audio,{chid:l,media_id:u},d.rejected),r.showDialog({desc:i,buttons:{accept:{text:"common.ok",callback:function(){return null}}}})}catch(e){}}},e.prototype.onDownStreamMediaPermissionFailureSecondary=function(e){var t=this.container,a=t.commonImpl,o=t.mediaUIHandler,i=t.detailsHandler,s=t.constants,r=e.chatid,c=e.id,d=e.cbk,l={process_type:s.negotiation,negotiation_type:s.audio};return i.isOldUI()&&(l.is_old_ui=i.isOldUI()),function(e,t){try{a.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_MIC_PERMISSION_BLOCKED},mid:c}),d(),o.mediaPermissionUnlock();var i=a.getFailureMessage(e),n={action:s.reject,success_cbk:null,failure_cbk:null,extraData:l};a.setApiData(c,n),a.makeApiCall(c),o.updateCallInvitationState(s.audio,{chid:r,media_id:c},s.rejected),o.showDialog({desc:i,buttons:{accept:{text:"common.ok",callback:function(){return null}}}})}catch(e){}}},e.prototype.isAudioCallAllowed=function(t){var e=this.container,i=e.commonImpl,n=e.mediaUIHandler,a=e.detailsHandler,e=e.MediaDetails,t=t.chatid;try{var o=a.getVisitorBrowser(t),s=a.getVisitorPage(t),r=!0,c="",d="",l=a.getVisitorID(t);return i.getMediaDataByChidAndType({chatid:t,type:this.audio})?(d="siqMedia - Call data not cleared/call ongoing | chid - "+t+" | visitorId - "+l,this.callBackAction(this.implConstants.postDebugLog,d),!1):(a.isChatMonitor(t)?(d="siqMedia - call Not Allowed because chat is in monitor | chid - "+t+" | chatMonitors - "+MediaLib.getConversationByCHID(chid).chat.ismonitor,c=a.I18N("av.info.chatinvite"),r=!1):a.isVisitorBrowserSupported(t)?e.checkBrowserSupported(w.audio)?a.isVisitorPageSecured(t)?a.isGroupConversation(t)&&!a.isCallMonitorConfEnabled()?(c=a.I18N("av.info.chatinvite"),d="siqMedia - Failed Visitor not in secure connection | chid - "+t+" |  visitorId - "+l,r=!1):a.isAttenderBot(t)?(d="siqMedia - Failed bot attender | chid - "+t+" |  visitorId - "+l,r=!1):a.isFaceBookIntegration(t)&&(c=a.I18N("av.info.facebookpagenotsupported"),d="siqMedia - Failed Visitor is in Facebook page | chid - "+t+" |  visitorId - "+l,r=!1):(c=a.I18N("av.info.insecuredwebsite"),d="siqMedia - Failed Visitor not in secure connection | chid - "+t+" |  visitor page - "+s,r=!1):(c=a.I18N("av.audio.info.agentbrowsernotsupported"),d="siqMedia - Failed agent browser not supported| chid - "+t,r=!1):(c=a.I18N("av.audio.info.visitorbrowsernotsupported"),d="siqMedia - Failed visitor browser not supported | chid - "+t+" | browser-"+o,r=!1),r||(n.showDialog({desc:c,buttons:{accept:{text:"common.ok",callback:function(){return null}}}}),this.callBackAction(this.implConstants.postDebugLog,d)),r)}catch(e){this.callBackAction(this.implConstants.postDebugLog,"siqMedia - Failed in isAudioCallAllowed method | chid - "+t)}},e.prototype.postDebugLog=function(e){this.container.detailsHandler.sendDebugLogger(e,null,null,!0)},e.prototype.callBackAction=function(e,t){({postDebugLog:this.postDebugLog.bind(this)})[e](t)},e.prototype.init=function(){this.implConstants={postDebugLog:"postDebugLog"}},e.prototype.addRemoteStream=function(e,t){var i=this,n=this.container,a=n.detailsHandler,o=n.commonImpl,s=n.mediaUIHandler,n=n.constants,r=t.chid,c=t.mid,d=t.type,t=t.negotiationType,l=o.getCallStatusData(c).isdirectcall;try{var u,p="siqMedia: adding remote stream  | chid :"+r+" | mediaid : "+c+" | lsuid : "+a.getCurrentUserId(),h=l?function(){i.handleUIApiCallEnd(c)}:function(){i.handleUIEnd(c)},m=(t==n.audio&&s.updateCallInvitationState(n.audio,{chid:r,id:c,callEndCbk:h},n.connected),this.callBackAction(this.implConstants.postDebugLog,p),""),_=e.stream;d!=this.audio&&t!=this.audio&&d!=n.audio_unified_mix||(m=this.addAudioPlayer()),e.streams&&(_=e.streams[0]);try{m.srcObject=_,this.getAudioOutputDevice()&&!a.isOldUI()&&(u=this.getAudioOutputDevice(),this.changeAudioPlayer(u,r))}catch(e){m.src=window.URL.createObjectURL(_)}o.checkAndUpdateUIForApi()}catch(e){l="siqMedia: adding remote stream  | chid :"+r+" | mediaid : "+c+" | lsuid : "+a.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,l)}},e.prototype.addAudioPlayer=function(){try{var e,t="siqMedia: creating audio player stream  | curUserId : "+this.container.detailsHandler.getCurrentUserId(),i=(this.callBackAction(this.implConstants.postDebugLog,t),document.querySelector("#remoteaudio"));return null==i||0==i.length?((e=document.createElement("audio")).id="remoteaudio",e.autoplay=!0,document.querySelector("body").appendChild(e),e):i}catch(e){}},e.prototype.removeAudioPlayer=function(){var e=document.querySelector("#remoteaudio");e.parentNode.removeChild(e)},e.prototype.startCallFailure=function(e){this.iconClicked={},callBackAction()},e.prototype.startcall=function(e,t,i){var n={},a=this.container,o=a.ajaxHandler,s=a.commonImpl,a=a.constants,e=(n.type=e,n.chatid=t,n.mode=i||a.visitor,s.constructURL(null,null));s.setActiveCallData(t),o.post(e,n,this.onstarted,this.startCallFailure)},e.prototype.handleUIReject=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.detailsHandler,t=t.constants,o=i.getWmsPushData(e),s=o.chatid,o=o.type,r={chid:s,media_id:e,isDirectCall:i.getCallStatusData(e).isdirectcall},n=(n.updateCallInvitationState(t.audio,r,t.rejected),{}),r=(a.isOldUI()&&(n.is_old_ui=a.isOldUI()),{action:t.reject,success_cbk:null,failure_cbk:null,extraData:n}),t=(i.setApiData(e,r),i.makeApiCall(e),i.removeMediaCache(w.siq_unifiedMedia),this.clearData(e),a.handleCallRejected({type:o,chid:s}),"siqMedia -  reject trigger from UI | chid :"+s+" | mediaid : "+e+" | curUserId : "+a.getCurrentUserId());this.callBackAction(this.implConstants.postDebugLog,t)},e.prototype.handleUIEnd=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.detailsHandler,o=t.screenShareImpl,t=t.constants,s=i.getWmsPushData(e),r=s.type,s=s.chatid,c=i.getCallStatusData(e);try{var d={chid:s,media_id:e,isDirectCall:c.isdirectcall},l={action:t.end,success_cbk:null,failure_cbk:null,extraData:{}};i.clearConnectingTimer(e),i.setApiData(e,l),i.makeApiCall(e),n.updateCallInvitationState(t.audio,d,t.ended),a.triggerIconCheck(s),this.clearData(e),a.removeAudioPlayers(),o.handleAudioCallEnd(s),this.container.detailsHandler.handleCallEnded({type:r,chid:s})}catch(e){}},e.prototype.endOngoingCall=function(e,t,i){try{var n=this.container,a=n.dataHandler,o=n.mediaUIHandler,s=n.commonImpl,r=n.screenShareImpl,c=n.detailsHandler,d=n.constants,l=a.get(e+"_peer");if(r.handleAudioCallEnd(e),l)for(var u in l){var p=l[u],h=p.type,m=p.mid,_=(o.updateCallInvitationState(h,{chid:e,media_id:m},d.ended),{action:d.end,success_cbk:i,failure_cbk:null,extraData:{}});s.setApiData(m,_),s.makeApiCall(m),this.clearData(m),delete l[u]}else{o.updateCallInvitationState(w.audio,{chid:e,media_id:t},d.ended);var g={action:d.end,success_cbk:i,failure_cbk:null,extraData:{}};s.setApiData(t,g),s.makeApiCall(t),this.clearData(t)}s.stopNotificationSound(),s.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_SOUND_STOP,add_info:c.getMediaActivityAddInfo()},mid:t}),s.removeActiveCallData(e)}catch(e){}},e.prototype.endFailedCall=function(e){var t=this.container,i=t.dataHandler,n=t.mediaUIHandler,a=t.commonImpl,t=t.constants,o=a.getWmsPushData(e),s=o.chatid,o=o.type;try{var r=i.get(s+"_peer");a.updateFailedTimeForMediaStats({failedTime:Date.now(),isreconnected:!1,mediaid:e}),a.getFailedStatsDetail(e),a.makeApiCall(e),n.updateCallInvitationState(o,{chid:s,media_id:e},t.failed),this.clearData(e),delete r[e]}catch(e){}},e.prototype.__handleUIAccept=function(t){var e,i,n,a,o,s,r=this,c=this.container,d=c.commonImpl,l=c.detailsHandler,u=c.mediaUIHandler,p=c.MediaPermission,h=c.dataHandler,m=c.constants,_=c.MediaDetails,c=d.getWmsPushData(t),g=c.chatid,f=(c.mediaInvitation,d.getActiveCallData()),c=d.getMediaIdByChid(f),y=c?d.getCallStatusData(c):{},C=d.getCallStatusData(t),v=(l.isOldUI()&&l.focusChatWindow(g),f&&f!=g&&(e=y.type,i=y.callStatus,n=y.isdirectcall,y=y.host,a=d.getImplType(e),a+="Impl",o=function(){return n&&l.endSession(f)},s={type:e,chid:f,media_id:c},i==m.connected?(e.includes(m.connectionType.UNIFIED)||e.includes(m.connectionType.SMART)?this.container.commonImpl.endOngoingUnifiedCall(c,f,o):this.container[a].endOngoingCall(f,c,o),u.updateCallInvitationState(e,s,m.ended)):i!=m.ringing&&i!=m.connecting||(y==m.upstream?this.container[a].handleUICancel(c):this.container[a].handleUIReject(c),d.removeActiveCallData()),this.clearData(c)),function(){clearTimeout(S)}),S=setTimeout(function(){v=u.mediaPermissionUI()},3e3);p.getAudioStream(function(){v(),d.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_MIC_PERMISSION_ALLOWED},mid:t});var e=d.getCallStatusData(t),e=(e?e.callStatus=m.connecting:e={callStatus:m.connecting},d.setCallStatusData(t,e),d.setActiveCallData(g),{}),e=(l.isoldUI&&(e.is_old_ui=l.isoldUI),e.perfect_renegotiation=_.getClientSupport().perfect_renegotiation,e.session_id=l.getSessionID(),{action:m.accept,success_cbk:null,failure_cbk:null,extraData:e}),e=(d.setApiData(t,e),d.makeApiCall(t),u.updateCallInvitationState(m.audio,{chid:g,media_id:t,muteCbk:function(){return r.toggleMute()},rejectCbk:function(){return C.host==m.upstream?r.handleUICancel(t):r.handleUIReject(t)}},m.connecting),m.WAITING_TIME);h.set(t+"_connecting_timer",setTimeout(function(){var e={action:m.end,success_cbk:null,failure_cbk:null,extraData:{}};d.setApiData(t,e),d.makeApiCall(t),r.clearData(t),u.updateCallInvitationState(m.audio,{chid:g,media_id:t},m.ended),d.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_INVITATION_CLEARED,add_info:l.getMediaActivityAddInfo()},mid:t})},e))},this.onDownStreamMediaPermissionFailure({chatid:g,id:t,cbk:v})),d.removeIncomingRequestData({id:t,chatid:g}),d.setActiveTab(),d.stopNotificationSound(),d.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_SOUND_STOP,add_info:l.getMediaActivityAddInfo()},mid:t})},e.prototype.handleUIAccept=function(e){var t=this,i=this.container,n=i.detailsHandler,a=i.mediaUIHandler,i=i.commonImpl,o=i.getWmsPushData(e),s=o.type,o=o.chatid,r=i.getActiveCallData();this.isWaitingForPermission||(i.isSmartFlow(e)&&n.isEmbed()&&!n.isScreenRecordingEnabled()&&n.showEmbedBanner("av.info.recording.disclaimer",5e3,o),i.updateMediaCache(w.siq_unifiedMedia,w.status,w.accept),r&&r!=o?a.handleCallClash(function(){return t.__handleUIAccept(e)},function(){return t.handleUIReject(e)}):this.__handleUIAccept(e),r={type:s,acceptedTime:Date.now(),callerType:1,reconnectCount:0,mediaid:e},i.setMediaStatsDetail(r),n.handleIncomingAccept({type:s,chid:o}))},e.prototype.handleUICancel=function(e){var t=this.container,i=t.detailsHandler,n=t.mediaUIHandler,a=t.commonImpl,o=t.dataHandler,t=t.constants,s=a.getWmsPushData(e),r=s.type,s=s.chatid,n=(n.updateCallInvitationState(r,{chid:s,media_id:e},t.cancelled),a.getCallStatusData(e)),n=(n&&(n.callStatus=t.cancelled),a.setCallStatusData(e,n),{}),t=(i.isOldUI()&&(n.is_old_ui=i.isOldUI()),{action:t.cancel,success_cbk:null,failure_cbk:null,extraData:n}),n=(a.setApiData(e,t),a.makeApiCall(e),a.removeMediaCache(w.siq_unifiedMedia),this.clearData(e),i.handleCallCancelled({type:r,chid:s}),clearTimeout(this.timeout[e]),clearTimeout(o.get(e+"_waiting_timer")),clearTimeout(o.get(e+"_connecting_timer")),o.remove(e+"_waiting_timer"),i.clearChatWindow(),i.clearPlayer()&&a.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:i.getMediaActivityAddInfo()},mid:e}),"siqMedia - cancel trigger from UI | chid :"+s+" | mediaid : "+e+" | curUserId : "+i.getCurrentUserId());this.callBackAction(this.implConstants.postDebugLog,n)},e.prototype.toggleMute=function(){this.container.MediaPermission.toggleMute()},e.prototype.startVisitorAudioCall=function(e){var t=this.container.constants,e={chatid:e,mode:t.visitor,mediarequest:!0,mediainvitation:!0,type:t.audio};this.startAudioCall(e)},e.prototype.handleCallMissed=function(t){var e=this.container,i=e.detailsHandler,n=e.mediaUIHandler,a=e.constants,e=e.commonImpl,o=e.getWmsPushData(t),s=o.chatid,o=o.processType;try{delete this.iconClicked[s];var r={chid:s,media_id:t};if(clearTimeout(this.timeout[t]),n.updateCallInvitationState(a.audio,r,a.missed),o&&o==a.negotiation)return void this.hideConsentUI(t);e.removeMediaCache(w.siq_unifiedMedia),this.clearData(t),i.handleCallMissed({type:a.audio,chid:s})}catch(e){n="siqMedia - call missed  | chid :"+s+" | mediaid : "+t+" | curUserId : "+i.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,n)}},e.prototype.acceptAudioCallForDsk=function(e){var t=this.container,i=t.commonImpl,t=t.mediaUIHandler,n=i.getMediaDataByChidAndType({chatid:e,type:this.audio}).id,e=(clearTimeout(this.timeout[n]),{chatid:e,id:n,type:this.type,mediaInvitation:!0});i.setWmsPushData(n,e),this.handleUIAccept(n),t.clearAudioCallInvite(this.audio,n)},e.prototype.rejectAudioCallForDsk=function(e){var t=this.container,i=t.commonImpl,t=t.mediaUIHandler,n=i.getMediaDataByChidAndType({chatid:e,type:this.audio}).id,e=(clearTimeout(this.timeout[n]),{chatid:e,id:n,type:this.type});i.setWmsPushData(n,e),this.handleUIReject(n),t.clearAudioCallInvite(this.audio,n)},e.prototype.hasIncommingCall=function(e){var t=this.container,i=t.commonImpl,t=t.constants,n=i.getActiveCallData(),a=i.getMediaIdByChid(n),i=a?i.getCallStatusData(a):{};return!(!v(i)||(i.type!=t.audio||i.callType!=t.incoming||i.callStatus!=t.ringing)&&n!=e)},e.prototype.handleCallRequestSuccesCbk=function(e){e.mid,e.chid},e.prototype.initCallRequest=function(e){var t=e.mid,i=e.negotiationType,n=e.chid,e=this.container,a=e.commonImpl,o=e.dataHandler,s=e.constants,r=e.mediaUIHandler,c=e.screenShareImpl,e=e.detailsHandler,d={negotiation_type:i,process_type:s.negotiation},i=(e.isOldUI()&&(d.is_old_ui=e.isOldUI()),o.set(t+"_connecting_timer",setTimeout(function(){var e={action:s.miss,success_cbk:null,failure_cbk:null,extraData:d},e=(a.setApiData(t,e),a.makeApiCall(t),r.getUIState().states[n]),e=e&&e.screen_share&&e.screen_share.type;a.getRequestingWhileViewingState()?c.handleRequestingWhileViewingCloseState(n,t):e==s.sharing||a.getSwapRequestCallbackState()?a.getSwapRequestCallbackState()&&c.handlingRequestStateOnSwap(n,t,s.requestMissed):(r.updateCallInvitationState(s.screenshare,{chid:n,media_id:t},s.requestMissed),r.deleteScreenShareState(n))},s.WAITING_TIME)),{action:s.request,success_cbk:null,failure_cbk:null,extraData:d});a.setApiData(t,i),a.makeApiCall(t)},e.prototype.addScreenShareTrack=function(e){var i=e.chid,n=e.id,e=this.container,a=e.commonImpl,o=e.screenShareImpl,s=e.MediaPermission,r=e.mediaUIHandler,c=e.constants,d=a.getMediaIdByChid(i),l=a.getPeerObject(n);s.getScreenShareStream(function(){function e(){return o.handleUIEnd(d)}l.addScreenTrackInConnection()||o.handleInitReNegotiation(n),a.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_RENEGOTIATION_TRACKADDED}});var t=r.getUIState().states[i];t.screen_share=t.screen_share||{};r.makeScreenShareConnected(c.screen_share,{chid:i,media_id:d,callEndCbk:e,ss_type:c.sharing}),s.screenEndFromBrowserUI(e),a.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_ALLOWED},mid:d})},function(){a.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_BLOCKED},mid:d})})},e.prototype.handleAudioCallEnd=function(e){var t=this.container,i=t.mediaUIHandler,n=t.MediaPermission,a=t.commonImpl,o=t.detailsHandler,t=t.constants,s=a.getWmsPushData(e).chatid,r=a.getCallStatusData(e),n=(n.closeStreamByType(t.audio),i.clearAudioCallInvite(t.audio,e),{chid:s,media_id:e,isDirectCall:!!r&&r.isdirectcall});i.updateCallInvitationState(t.audio,n,t.ended),i.stopTimer(s),i.clearAllStates(s),o.clearAudioUI(),o.clearChatWindow(),o.clearPlayer()&&a.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:o.getMediaActivityAddInfo()},mid:e}),o.clearPopup()&&a.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:o.getMediaActivityAddInfo()},mid:e})},e.prototype.isCallAllowed=function(e){for(var t=this.container,i=t.dataHandler,n=t.detailsHandler,t=t.constants,a=i.get(t.media_inv),o=0;a&&a.length>o;o++)if(a[o][e=n.isembed?n.getChatWinObjById(e,!0).RCHID:e])return!1;return!0},e.prototype.handleInitReNegotiation=function(e){var t=this.container,i=t.commonImpl,t=t.constants,n=(this.reinit=!0,{process_type:t.reinit,negotiation_type:t.audio}),t={action:t.request,success_cbk:null,failure_cbk:null,extraData:n};i.setApiData(e,t),i.makeApiCall(e)},e.prototype.changeAudioPlayer=function(e,t){var i=document.querySelector("#remoteaudio");void 0!==i.sinkId&&(this.setAudioOutputDevice(e),i.setSinkId(e),this.container.commonImpl.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_OUTPUT_DEVICE_CHANGED}}))},e.prototype.changeAudioInputDevice=function(e,t,i){var n=this,a=this.container,o=a.MediaPermission,a=a.commonImpl,t=a.getActiveMediaID(t),s=a.getPeerObject(t);s&&s.removeAudioTrackInConnection(),o.updatePreferredDeviceByDeviceId(e,"audioInput"),o.getAudioStream(function(){s.audioRenegotiation(),i&&n.toggleMute(),n.setAudioIputDevice(e),n.container.commonImpl.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_INPUT_DEVICE_CHANGED}})},function(){})},e.prototype.setAudioIputDevice=function(e){localStorage.setItem("siqmedia_audio_input_device",D(e))},e.prototype.setAudioOutputDevice=function(e){localStorage.setItem("siqmedia_audio_output_device",D(e))},e.prototype.getAudioInputDevice=function(){return R(localStorage.getItem("siqmedia_audio_input_device"))},e.prototype.getCurrentStreamDeviceId=function(){var e=this.container.MediaPermission.getStreamByType(w.audio);return e&&e.getAudioTracks()&&e.getAudioTracks()[0].getSettings().deviceId},e.prototype.getAudioOutputDevice=function(){return R(localStorage.getItem("siqmedia_audio_output_device"))},e.prototype.showConsentUI=function(e,t,i,n){var a=this,o=(void 0===t&&(t=!1),void 0===i&&(i=void 0),void 0===n&&(n=void 0),this.container),s=o.mediaUIHandler,o=o.commonImpl.getWmsPushData(e).chatid;s.updateCallInvitationState(w.audio,{acceptCbk:function(){a.setConsentBannerAccepted(),a.hideConsentUI(e),"function"==typeof i?i.call():t?a.handleUIAccept(e):a.__handleunifiedcallcredentail(e)},rejectCbk:function(){"function"==typeof n?n.call():a.handleUIConsentReject(e)},chid:o},w.showConstent)},e.prototype.handleUIConsentReject=function(e){this.hideConsentUI(e);var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.detailsHandler,o=t.constants,t=t.dataHandler,s=i.getWmsPushData(e),r=s.chatid,c=s.type,s=(s.negotiationType,{chid:r,media_id:e,isDirectCall:i.getCallStatusData(e).isdirectcall,isConsent:!0}),d={},d=(a.isOldUI()&&(d.is_old_ui=a.isOldUI()),d.is_consent_allowed=!1,{action:o.reject,success_cbk:null,failure_cbk:null,extraData:d}),d=(i.setApiData(e,d),i.makeApiCall(e),n.updateCallInvitationState(o.audio,s,o.rejected),i.removeMediaCache(w.siq_unifiedMedia),this.clearData(e),clearTimeout(this.timeout[e]),clearTimeout(t.get(e+"_waiting_timer")),clearTimeout(t.get(e+"_connecting_timer")),a.handleCallRejected({type:c,chid:r}),"siqMedia -  reject trigger from consent UI | chid :"+r+" | mediaid : "+e+" | curUserId : "+a.getCurrentUserId());this.callBackAction(this.implConstants.postDebugLog,d)},e.prototype.hideConsentUI=function(e){var t=this.container,i=t.mediaUIHandler,t=t.commonImpl.getWmsPushData(e).chatid;i.clearConsentUIState(t)},e.prototype.isConsentBannerAccepted=function(){var e=this.container.detailsHandler,t=this.getConsentCookieKey();return!!e.getValueInSession(t)},e.prototype.setConsentBannerAccepted=function(){var e=this.container.detailsHandler,t=this.getConsentCookieKey();e.setValueInSession(t,!0)},e.prototype.getConsentCookieKey=function(){var e=this.container.detailsHandler,t=e.getAppName(),i=e.getApiVisitorId(),e=e.getAVUID();return i?i+"_"+t+"_audio_consent":e+"_"+t+"_audio_consent"},e.prototype.showConsentUIForAudioRequest=function(t,e){var i=this,n=this.container,a=n.mediaUIHandler,o=n.commonImpl,s=n.constants,n=o.getWmsPushData(t),r=n.chatid,c=n.negotiationType;a.updateCallInvitationState(w.audio,{acceptCbk:function(){i.setConsentBannerAccepted(),i.hideConsentUI(t),e.call()},rejectCbk:function(){i.hideConsentUI(t);var e={process_type:s.negotiation,negotiation_type:c,is_consent_allowed:!1},e=(clearTimeout(i.timeout[t]),a.updateCallInvitationState(s.audio,{chid:r,media_id:t},s.rejected),{action:s.reject,success_cbk:null,failure_cbk:null,extraData:e});o.setApiData(t,e),o.makeApiCall(t)},chid:r},w.showConstent)},t.prototype.handleInvitation=function(){},t.prototype.handleCallAccept=function(){},t.prototype.handleCallReject=function(){},t.prototype.handleCandidates=function(){},t.prototype.handleCallAnswer=function(){},t.prototype.handleCallEnd=function(){},t.prototype.handleCallOffer=function(){},t.prototype.handleCallCancel=function(){},t.prototype.handleCallCancel=function(){},t.prototype.handleCallInvite=function(){},i.prototype.setCredential=function(e){this.container.commonImpl.setCredential(e)},i.prototype.handleInvitation=function(i){function e(){return g(!1)}var n=this,t=this.container,a=t.commonImpl,o=t.mediaUIHandler,s=t.MediaPermission,r=t.detailsHandler,c=t.MediaDetails,d=t.constants,t=a.getWmsPushData(i),l=t.chatid,u=t.type,p=t.perfectReNegotiation,h=t.mediaInvitation,m=t.mediaRequest,_=t.connection_type,t=t.recordingType,g=(a.endCallFromSameChat(i),r.isEmbed()&&r.clearBusyUI(),function(e){(e=void 0===e?!0:e)&&a.isSmartFlow(i)&&r.isScreenRecordingEnabled()&&!n.isConsentBannerAccepted()&&n.setConsentBannerAccepted(),clearTimeout(n.timeout[i]),e?n.handleUIAccept(i):n.handleUIReject(i);try{var t={type:u,acceptedTime:Date.now(),callerType:1,reconnectCount:0,mediaid:i};a.setMediaStatsDetail(t)}catch(e){}}),f={chid:l,media_id:i,rejectCbk:e,acceptCbk:g},y={};if(r.isOldUI()&&(y.is_old_ui=r.isOldUI()),a.checkIncomingCallAllowed(i))return y={action:d.reject,success_cbk:null,failure_cbk:null,extraData:y},a.setApiData(i,y),a.makeApiCall(i),!0;if(a.setScreenShareRequestData(l),a.setCredential(i),h){y={callType:d.incoming,callStatus:d.ringing,mediarequest:m,host:d.downstream,isdirectcall:!1,isPerfectRenegotiation:p,type:u,connection_type:_,recording_type:t},h=(a.setCallStatusData(i,y),o.handleAudioCallInvite(d.screen_share,f),{chid:l,type:u,media_id:i,status:w.incoming}),y=(a.setMediaCache(w.siq_unifiedMedia,h),{chatid:l,type:d.audiocall,duration:"1",tone:d.requestscreensahre,isEncrypted:!1});a.playMediaNotificationSound(y),this.timeout[i]=setTimeout(e,65e3)}else{var C={perfect_renegotiation:c.getClientSupport().perfect_renegotiation,session_id:r.getSessionID()},o={chid:l,type:u,media_id:i,status:w.accept},f=(a.setMediaCache(w.siq_unifiedMedia,o),{callType:d.incoming,callStatus:d.connecting,mediarequest:m,host:d.downstream,isdirectcall:!1,isPerfectRenegotiation:p,type:u,connection_type:_,recording_type:t});a.setCallStatusData(i,f),m?s.getScreenShareStream(function(){var e;a.isScreenRequestPending(l)&&(e={action:d.accept,success_cbk:null,failure_cbk:null,extraData:C},a.setApiData(i,e),a.makeApiCall(i),s.screenEndFromBrowserUI(function(){return n.handleUIEnd(i)}),a.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_ALLOWED},mid:i}))},this.onMediaPermissionFailure(i)):(a.setActiveCallData(l),setTimeout(function(){var e={action:d.accept,success_cbk:null,failure_cbk:null,extraData:C};a.setApiData(i,e),a.makeApiCall(i)},2e3)),a.setActiveTab(),r.triggerIconCheck(l);try{var v={type:u,acceptedTime:Date.now(),callerType:1,reconnectCount:0,mediaid:i};a.setMediaStatsDetail(v)}catch(e){}}r.handleIncomingCall({type:u,chid:l})},i.prototype.handleAcceptSuccessCbk=function(e){var t=this.container,i=t.dataHandler,n=t.constants,t=t.commonImpl.getWmsPushData(e).chatid,a=t+"_peer",o=i.get(a)||{},t={id:e,chatid:t,type:n.screen_share,iceRestart:!1,isUpStream:!0,mediaRequest:!0};o[e]=new S(t,this.container),i.set(a,o)},i.prototype.handleCallAccept=function(t){var i=this,e=this.container,n=e.dataHandler,a=e.commonImpl,o=e.constants,s=e.mediaUIHandler,e=e.detailsHandler,r=a.getWmsPushData(t),c=r.chatid,d=r.type,l=r.processType,u=r.perfectReNegotiation,p=r.connection_type;if(l&&l==o.negotiation)return a.clearConnectingTimer(t),a.clearMissedCallTimeout(t),s.deleteScreenShareState(c),a.deleteSwapRequestCallbackState(),void(a.getRequestingWhileViewingState()&&this.handleRequestingWhileViewingCloseState(c,t));var l=c+"_peer",h=n.get(l)||{},m=(r.isUpStream=!0,r.iceRestart=!1,d==o.screen_share&&(h[t]=new S(r,this.container),n.set(l,h)),clearTimeout(n.get(t+"_waiting_timer")),n.remove(t+"_waiting_timer"),{}),r=(e.isOldUI()&&(m.is_old_ui=e.isOldUI()),{chid:c,media_id:t,muteCbk:function(){},rejectCbk:function(){var e={action:o.cancel,success_cbk:null,failure_cbk:null,extraData:m};a.setApiData(t,e),a.makeApiCall(t),s.updateCallInvitationState(d,{chid:c,media_id:t},o.cancelled),i.clearData(t)}});try{var _={type:d,acceptedTime:Date.now(),callerType:0,reconnectCount:0,mediaid:t};a.setMediaStatsDetail(_)}catch(e){}l=a.getCallStatusData(t);l?(l.callStatus=o.connecting,l.isPerfectRenegotiation=u,l.connection_type=p):l={callStatus:o.connecting,isPerfectRenegotiation:u,connection_type:p},a.setCallStatusData(t,l),s.updateCallInvitationState(o.screen_share,r,o.connecting)},i.prototype.handleCallReject=function(e){var t=this.container,i=t.detailsHandler,n=t.mediaUIHandler,a=t.constants,t=t.commonImpl,o=t.getWmsPushData(e),s=o.chatid,r=o.type,o=o.processType;if(o&&o==a.negotiation)return t.getRequestingWhileViewingState()?this.handleRequestingWhileViewingCloseState(s,e):t.getSwapRequestCallbackState()?this.handlingRequestStateOnSwap(s,e,a.requestRejected):n.getUIState().states[s][a.screen_share].status==a.requested&&n.updateCallInvitationState(a.screen_share,{chid:s,media_id:e},a.rejected),t.clearMissedCallTimeout(e),void t.clearConnectingTimer(e);n.updateCallInvitationState(a.screen_share,{chid:s,media_id:e},a.rejected),this.clearData(e),t.removeMediaCache(w.siq_unifiedMedia),i.handleCallRejected({type:r,chid:s})},i.prototype.handleRequestingWhileViewingCloseState=function(e,t){var i=this,n=this.container,a=n.commonImpl;n.mediaUIHandler.getUIState().states[e].screen_share.reject_cbk=function(){return i.handleUiunifiedEnd(t)},a.deleteRequestingWhileViewingState(),a.clearConnectingTimer(t),a.clearMissedCallTimeout(t)},i.prototype.handleCandidates=function(e){var t=this.container,i=t.dataHandler,t=t.commonImpl,n=t.getWmsPushData(e),a=n.chatid,o=i.get(a+"_peer")[e];o||((o={})[e]=new S(n,this.container),i.set(a+"_peer",o),o=o[e],t.setRemotePerfectReNegotiation(o,e,a)),o.setIceCandidates(n)},i.prototype.handleCallAnswer=function(e){var t=this.container,i=t.commonImpl,t=t.dataHandler,i=i.getWmsPushData(e),n=i.chatid,a=i.session,o=i.tracksId,i=i.negotiationType,t=t.get(n+"_peer")[e];t.remoteTracksId=o?JSON.parse(o):null,t.negotiationType=i||null,t.setAnswerRemoteDesription(a)},i.prototype.handleCallEnd=function(e){var t=this.container,i=t.mediaUIHandler,n=t.detailsHandler,a=t.audioImpl,o=t.commonImpl,t=t.constants,s=o.getWmsPushData(e),r=s.type,c=s.chatid,d=s.negotiationType,s=s.processType;e==o.getActiveMediaID(c)&&(d==w.screen_share&&s==w.negotiation?this.handleStopScreenShare(e):(i.updateCallInvitationState(r,{chid:c,media_id:e},t.ended),i.deleteScreenShareState(c),n.clearChatWindow(),i.deletePlayer(c),n.clearPlayer()&&o.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:n.getMediaActivityAddInfo()},mid:e}),n.clearPopup()&&o.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:n.getMediaActivityAddInfo()},mid:e}),a.handleAudioCallEnd(e),this.clearData(e),o.removeMediaCache(w.siq_unifiedMedia),n.handleCallEnded({type:r,chid:c})))},i.prototype.handleCallOffer=function(e){var t=this.container,i=t.dataHandler,n=t.constants,a=t.MediaPermission,t=t.commonImpl,o=t.getWmsPushData(e),s=o.chatid,r=o.session,c=o.tracksId,d=o.negotiationType,l=i.get(s+"_peer")||{},a=(a.getStreamByType(n.screen_share)&&d==n.screen_share&&!this.reinit&&i.set(n.isAlreadySharing,!0),o.isUpStream=!1,o.iceRestart=!1,l[e]);l[e]||(l[e]=new S(o,this.container),i.set(s+"_peer",l),a=l[e]),a.remoteTracksId=c?JSON.parse(c):null,a.negotiationType=d||null,t.setRemotePerfectReNegotiation(a,e,s);try{this.reinit?(a.handleScreenShareRenegotiation(r,this.removeTrackOnReNegotiation),this.removeTrackOnReNegotiation=!1):a.setOfferRemoteDescription(r),this.reinit=!1}catch(e){}},i.prototype.handleCallCancel=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.detailsHandler,t=t.constants,o=i.getWmsPushData(e),s=o.chatid,r=o.type,o=o.processType,c={chid:s,media_id:e};i.deleteScreenShareRequestData(s),a.isEmbed()&&a.clearConformBox()&&i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:a.getMediaActivityAddInfo()},mid:e}),clearTimeout(this.timeout[e]),o&&o==t.negotiation||(n.updateCallInvitationState(t.screen_share,c,t.cancelled),i.removeCredential(e),this.clearData(e),o="siqMedia: call cancel request received  | chid :"+s+" | mediaid : "+e+" | curUserId : "+a.getCurrentUserId(),this.callBackAction(this.implConstants.postDebugLog,o),i.removeMediaCache(w.siq_unifiedMedia),a.handleCallCancelled({type:r,chid:s}))},i.prototype.handleCallFailed=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.detailsHandler,t=t.constants,i=i.getWmsPushData(e),o=i.chatid,s=i.type,i=i.processType,r={chid:o,media_id:e};clearTimeout(this.timeout[e]),i&&i==t.negotiation||(n.updateCallInvitationState(t.screen_share,r,t.failed),this.clearData(e),a.handleCallFailed({type:s,chid:o}))},i.prototype.handleUIReject=function(e){var t=this.container,i=t.mediaUIHandler,n=t.commonImpl,a=t.detailsHandler,t=t.constants,o=n.getWmsPushData(e),s=o.chatid,o=o.type,r={},i=(a.isOldUI()&&(r.is_old_ui=a.isOldUI()),i.updateCallInvitationState(o,{chid:s,mid:e},t.rejected),{action:t.reject,success_cbk:null,failure_cbk:null,extraData:r}),t=(n.setApiData(e,i),n.makeApiCall(e),this.clearData(e),n.removeMediaCache(w.siq_unifiedMedia)," reject trigger from UI | chid :"+s+" | mediaid : "+e+" | curUserId : "+a.getCurrentUserId());this.callBackAction(this.implConstants.postDebugLog,t),a.handleCallRejected({type:o,chid:s})},i.prototype.__handleUIAccept=function(t){var e,i=this,n=this.container,a=n.commonImpl,o=n.mediaUIHandler,s=n.MediaPermission,r=n.constants,c=n.MediaDetails,d=n.detailsHandler,n=a.getWmsPushData(t),l=n.chatid,u=n.type,n=(n.mediaInvitation,a.getActiveCallData()),p=a.getMediaIdByChid(n),h=p?a.getCallStatusData(p):{},m=a.getCallStatusData(t),_=(n&&n!=l&&(e=h.callStatus,h=h.host,d.isOldUI()&&d.isOldUI(),e==r.connected?this.endOngoingCall(n,p):e==r.ringing?(n={action:h==r.upstream?r.cancel:r.reject,success_cbk:null,failure_cbk:null,extraData:{}},a.setApiData(p,n),r.upstream,a.makeApiCall(p),a.removeActiveCallData()):e==r.connecting&&(n={action:h==r.upstream?r.cancel:r.reject,success_cbk:null,failure_cbk:null,extraData:{}},a.setApiData(p,n),r.upstream,a.makeApiCall(p),a.removeActiveCallData())),{perfect_renegotiation:c.getClientSupport().perfect_renegotiation,session_id:d.getSessionID()});a.getCallStatusData(t).mediarequest?u==w.screen_share_smart||u==w.screen_view_smart?(a.setActiveCallData(l),a.deleteScreenShareRequestData(l),this.__makeCallAccept(t),this.addScreenTrackInConference({type:u,isInvite:!0})):s.getScreenShareStream(function(){var e;a.getCallStatusData(t)&&a.isScreenRequestPending(l)?(a.deleteScreenShareRequestData(l),(e=a.getCallStatusData(t))?e.callStatus=r.connecting:e={callStatus:r.connecting},a.setCallStatusData(t,e),a.setActiveCallData(l),e={action:r.accept,success_cbk:function(){i.handleAcceptSuccessCbk(t)},failure_cbk:null,extraData:_},a.setApiData(t,e),a.makeApiCall(t),e={},d.isOldUI()&&(e.is_old_ui=d.isOldUI()),e={action:m.host==r.upstream?r.cancel:r.reject,success_cbk:null,failure_cbk:null,extraData:e},a.setApiData(t,e),o.updateCallInvitationState(u,{chid:l,media_id:t,muteCbk:function(){return i.toggleMute()},rejectCbk:function(){return m.host,r.upstream,a.makeApiCall(t)}},r.connecting),s.screenEndFromBrowserUI(function(){return i.handleUIEnd(t)}),a.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_ALLOWED},mid:t})):s.closeStreamByType(r.screen_share)},this.onMediaPermissionFailure(l,t)):(e={action:r.accept,success_cbk:null,failure_cbk:null,extraData:_},a.setApiData(t,e),a.makeApiCall(t)),a.removeIncomingRequestData({id:t,chatid:l}),a.setActiveTab()},i.prototype.handleUIAccept=function(e){var t=this,i=this.container,n=i.mediaUIHandler,a=i.commonImpl,i=i.detailsHandler,o=a.getWmsPushData(e).chatid,a=a.getActiveCallData();a&&a!=o?n.handleCallClash(function(){return t.__handleUIAccept(e)},function(){return t.handleUIReject(e)}):this.__handleUIAccept(e),i.triggerIconCheck(o)},i.prototype.startScreenShare=function(e){try{var t,i=this.container,n=i.detailsHandler,a=i.MediaPermission,o=i.commonImpl,s=i.MediaDetails,r=i.constants,c=e.mediarequest,d=e.chatid,l=e.mode,u=e.id,p=!0,h=c?w.screen_view:w.screen_share;if(e.perfect_renegotiation=s.getClientSupport().perfect_renegotiation,l==r.visitor){if(n.checkIsSSOnGoing(d,h))return;p=this.isScreenShareAllowed(e,h)}p?c?this.initRequest(this.onMediaPermissionSuccess(e)):a.getScreenShareStream(this.onMediaPermissionSuccess(e),this.onMediaPermissionFailure(d,u,!0)):(t="To start Siq Screen Share  - permission checks failed | chid - "+d+" ",this.callBackAction(this.implConstants.postDebugLog,t)),o.setActiveTab()}catch(e){}},i.prototype.initRequest=function(e){e()},i.prototype.onMediaPermissionSuccess=function(e){var t=this,i=this.container,n=i.commonImpl,a=i.ajaxHandler,o=i.MediaPermission,s=i.constants,r=(e.mediarequest,e.chatid),i=e.mode,i=(e.id,e.type,i||s.visitor),c=this.constructResponeObj(e),d=n.constructURL(null,null);return n.setActiveCallData(r),function(){if(!t.checkOngoingCall(r))return o.closeStreamByType(s.screen_share),delete t.iconClicked[r],function(){};n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_ALLOWED}}),a.post(d,c,t.onstarted.bind(t),t.startCallFailure.bind(t),!0,!1,"v3")}},i.prototype.onMediaPermissionFailure=function(d,l,u){var p=this;return void 0===u&&(u=!1),function(e,t){try{var i,n=p.container,a=n.commonImpl,o=n.mediaUIHandler,s=n.detailsHandler,r=n.constants,c={closed_reason:r.screen_permission_blocked};s.isOldUI()&&(c.is_old_ui=s.isOldUI()),u||(i={action:r.reject,success_cbk:null,failure_cbk:null,extraData:c},a.setApiData(l,i),a.makeApiCall(l),o.updateCallInvitationState(r.screen_share,{chid:d,media_id:l},r.rejected),p.clearData(l),s.triggerIconCheck(d),s.handleCallRejected({chid:d})),a.getActiveCallData()&&a.getActiveCallData()==d&&!a.getCallStatusData(l)&&(a.removeActiveCallData(),a.removeActiveTab()),a.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_BLOCKED}})}catch(e){}}},i.prototype.constructResponeObj=function(e){return Object.assign({},{type:"screen_share"},e)},i.prototype.onstarted=function(e){function t(){return i.handleUICancel(u)}var i=this,n=this.container,a=n.commonImpl,o=n.mediaUIHandler,s=n.dataHandler,r=n.MediaPermission,c=n.detailsHandler,d=n.constants,n=R(e.msg||e.data.msg).media?R(R(e.msg||e.data.msg).media):R(e.msg||e.data.msg),l=n.chatid,u=n.id,p=n.type,e=n.media_request,h=n.chid,m=n.connection_type,_=n.recording_type,h=(l||(l=l||h,n.chatid=l),a.setWmsPushData(u,n),s.set(u+"_waiting_timer",setTimeout(function(){var e={},e=(c.isOldUI()&&(e.is_old_ui=c.isOldUI()),{action:d.miss,success_cbk:null,failure_cbk:null,extraData:e});a.setApiData(u,e),a.makeApiCall(u),o.updateCallInvitationState(p,{chid:l,media_id:u},d.missed),i.clearData(u),a.removeMediaCache(w.siq_unifiedMedia),c.handleCallMissed({type:p,chid:l})},6e4)),{chid:l,type:p,media_id:u,status:w.outgoing}),n=(a.setMediaCache(w.siq_unifiedMedia,h),{callType:d.outgoing,callStatus:d.ringing,mediarequest:e,host:d.upstream,isdirectcall:!1,isPerfectRenegotiation:!1,type:p,connection_type:m,recording_type:_}),s=(a.setCallStatusData(u,n),{chid:l,media_id:u,rejectCbk:t,cancelCbk:t,muteCbk:function(){},initiated:!0});p==d.screen_share||p==d.screen_share_smart?o.makeScreenShareConnecting(p,s):o.showScreenShareMaking(p,s),e||r.screenEndFromBrowserUI(function(){return m==w.connectionType.PEER2PEER?i.handleUIEnd(u):i.handleUiunifiedEnd(u)}),c.triggerIconCheck(l),c.handleCallInitiate({type:p,chid:l})},i.prototype.startCallFailure=function(){},i.prototype.addRemoteStream=function(e,t){var i=this;try{t.type;var n=t.mid,a=t.chid,o=t.negotiationType,s=this.container,r=s.constants,c=s.mediaUIHandler,d=s.dataHandler,l=(s.MediaPermission,e.stream);if(e.streams&&(l=e.streams[0]),o==r.audio)return;function u(){i.handleUIEnd(n)}if(d.get(r.isAlreadySharing)&&(d.set(r.isAlreadySharing,!1),setTimeout(function(){i.handleStopScreenShare(n)},2e3)),c.getUIState().states&&c.getUIState().states[a]&&c.getUIState().states[a].screen_share&&c.getUIState().states[a].screen_share.type==r.sharing)return;c.updateCallInvitationState(r.screen_share,{chid:a,media_id:n,id:n,callEndCbk:u},r.connected),c.playScreenShareStream({stream:l,chid:a,mid:n,endCbk:u})}catch(e){}},i.prototype.clearData=function(e){try{var t=this.container,i=t.commonImpl,n=t.dataHandler,a=t.constants,o=t.detailsHandler,s=(t.mediaUIHandler,i.getWmsPushData(e));if(!s)return;s.type;var r=s.chatid;this.closePeerConn(e),this.closeAllPeerConn(e),i.removeCredential(e),i.checkAVIcon(r),i.clearCallDetails(r,e),i.clearConnectingTimer(e),i.clearMissedCallTimeout(e),clearTimeout(this.timeout[e]),n.remove(a.isAlreadySharing),i.getActiveCallData()&&i.getActiveCallData()==r&&i.removeActiveCallData(),i.removeIncomingRequestData({id:e,chatid:r}),o.isEmbed()&&o.checkIsChatEndTimerAlive(r)||i.stopNotificationSound(),i.checkAndPlayNotification(),i.deleteScreenShareRequestData(r),i.clearConnectedStatsDetail(e),i.removeMediaCallDetails(e),i.removeMediaCache(w.siq_unifiedMedia),i.getCallStatusData(e)||i.removeActiveTab()}catch(e){}},i.prototype.closePeerConn=function(e){var t=this.container,i=t.commonImpl,t=t.dataHandler,n=i.getWmsPushData(e),a=n.chatid,n=n.type;try{var o=t.get(a+"_peer");if(!o)return void this.clearMediaPermision(n);var s=o[e];i.clearNetworkTimer(s),s.closeConnection(),delete o[e],this.clearMediaPermision(n)}catch(e){}},i.prototype.clearMediaPermision=function(e){"audio_unified_mix"==e?e="audio":"screen_share_smart"!=e&&"screen_view_smart"!=e||(e="screen_share"),this.container.MediaPermission.closeStreamByType(e)},i.prototype.handleUIEnd=function(e){var t=this.container,i=t.mediaUIHandler,n=t.detailsHandler,a=t.commonImpl,t=t.constants,o=a.getWmsPushData(e),s=o.type,o=o.chatid,r=a.getPeerObject(e);r.curr_connection.audio&&r.audioRtpSenders||i.getUIState().states[o].audio?i.getUIState().states[o].screen_share.type==w.viewing?this.endViewingScreenShare(e):this.handleStopScreenShare(e):(r={action:t.end,success_cbk:null,failure_cbk:null,extraData:{}},a.setApiData(e,r),a.makeApiCall(e),i.updateCallInvitationState(s,{chid:o,media_id:e},t.ended),n.clearChatWindow(),n.clearPlayer()&&a.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:n.getMediaActivityAddInfo()},mid:e}),this.clearData(e),a.removeMediaCache(w.siq_unifiedMedia),n.handleCallEnded({type:s,chid:o}))},i.prototype.callConnected=function(e){this.screenShareConnectedUI(e)},i.prototype.screenShareConnectedUI=function(e){var t=this,i=this.container,n=i.commonImpl,a=i.mediaUIHandler,o=i.constants,i=i.detailsHandler,s=e.chid,r=(e.type,e.mid),c=e.isUpStream,e=e.isReconnecting,d=n.getCallStatusData(r).mediarequest,c={chid:s,isViewing:c&&d||!c&&!d,media_id:r,ss_type:a.getCurrentScreenshareType(s),muteCbk:function(){return function(){}},callEndCbk:function(){return t.handleUIEnd(r)}},d=(n.updateMediaCache(w.siq_unifiedMedia,w.status,w.connected),n.getCallStatusData(r));d?(d.callStatus=o.connected,d.active_participants=[i.getCurrentUserId()]):d={callStatus:o.connected,active_participants:[i.getCurrentUserId()]},n.setCallStatusData(r,d),a.updateCallInvitationState(o.screen_share,c,o.connected),n.updateMediaStatsDetail({connectedTime:Date.now(),isreconnected:e,mediaid:r}),n.getConnectedStatsDetail(r),n.makeApiCall(r)},i.prototype.callBackAction=function(e,t){({postDebugLog:this.postDebugLog.bind(this)})[e](t)},i.prototype.init=function(){this.implConstants={postDebugLog:"postDebugLog"}},i.prototype.postDebugLog=function(e){this.container.detailsHandler.sendDebugLogger(e,null,null,!0)},i.prototype.handleUICancel=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.detailsHandler,t=t.constants,o=i.getWmsPushData(e),s=o.type,o=o.chatid,n=(n.updateCallInvitationState(t.screen_share,{type:s,chid:o,media_id:e},t.cancelled),{}),t=(a.isOldUI()&&(n.is_old_ui=a.isOldUI()),{action:t.cancel,success_cbk:null,failure_cbk:null,extraData:n});i.setApiData(e,t),i.makeApiCall(e),this.clearData(e),i.removeMediaCache(w.siq_unifiedMedia),a.handleCallCancelled({type:s,chid:o})},i.prototype.handleUIRequestCancel=function(e,t,i){var n=this.container,a=n.commonImpl,o=n.mediaUIHandler,s=n.detailsHandler,r=n.constants,n=(n.dataHandler,{type:e,chid:t,media_id:i}),o=(a.getRequestingWhileViewingState()?this.handleRequestingWhileViewingCloseState(t,i):a.getSwapRequestCallbackState()?this.handlingRequestStateOnSwap(t,i,r.requestCancelled):o.updateCallInvitationState(r.screen_share,n,r.cancelled),{process_type:r.negotiation,negotiation_type:e}),n=(s.isOldUI()&&(o.is_old_ui=s.isOldUI()),{action:r.cancel,success_cbk:null,failure_cbk:null,extraData:o});a.setApiData(i,n),a.makeApiCall(i),a.clearConnectingTimer(i),a.clearMissedCallTimeout(i),s.handleCallCancelled({type:e,chid:t})},i.prototype.handlingRequestStateOnSwap=function(e,t,i){var n=this.container,a=n.commonImpl,o=n.mediaUIHandler,n=n.constants,s={chid:e,id:t};o.updateCallInvitationState(n.screen_share,{chid:e,status:i,media_id:t},i),this.setSharingState(s),a.deleteSwapRequestCallbackState()},i.prototype.swapScreenShare=function(e,t){var i=this,n=this.container,a=n.audioImpl,o=n.MediaPermission,s=n.constants,r=n.mediaUIHandler,n=n.commonImpl,c=e.id,d=e.chatid||e.chid;n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SWAP},mid:c}),o.getStreamByType(s.screen_share)?((e=r.getUIState().states[d])&&e.screen_share&&e.screen_share.type==s.sharing&&(n.setSwapRequestCallbackState(),e.screen_share.type=s.viewing,e.screen_share.status=s.requested,e.screen_share.reject_cbk=function(){return i.handleUIRequestCancel(s.screen_share,d,c)}),a.initCallRequest({chid:d,mid:c,negotiationType:s.screen_share})):a.addScreenShareTrack({id:c,chid:d})},i.prototype.getScreenShareType=function(e,t){try{var i=this.container,n=i.commonImpl,a=i.constants,o=n.getCallStatusData(t),s=n.getPeerObject(t);if(!o)return-1;if(s&&s.curr_connection&&s.curr_connection.audio)return-1;var r=o.mediarequest,c=o.host==a.upstream;if(c&&r)return 1;if(c&&!r)return 0;if(!c&&r)return 0;if(!c&&!r)return 1}catch(e){}},i.prototype.endOngoingCall=function(e,t,i){var n=this.container,a=n.dataHandler,o=n.mediaUIHandler,s=n.commonImpl,r=n.audioImpl,c=n.constants,d=a.get(e+"_peer");if(r.handleAudioCallEnd(t),d)for(var l in d){var u=d[l],p=u.mid,u=u.type,u=(o.updateCallInvitationState(u,{chid:e,media_id:p},c.ended),{action:c.end,success_cbk:i,failure_cbk:null,extraData:{}});s.setApiData(p,u),s.makeApiCall(p),this.clearData(l),delete d[l]}else{n={action:c.end,success_cbk:i,failure_cbk:null,extraData:{}};s.setApiData(t,n),s.makeApiCall(t),this.clearData(t)}s.stopNotificationSound(),s.removeActiveCallData(e)},i.prototype.endFailedCall=function(e){try{var t=this.container,i=t.dataHandler,n=t.mediaUIHandler,a=t.commonImpl,o=t.constants,s=(t.detailsHandler,a.getWmsPushData(e)),r=s.chatid,c=s.type,d=i.get(r+"_peer");a.updateFailedTimeForMediaStats({failedTime:Date.now(),isreconnected:!1,mediaid:e}),a.getFailedStatsDetail(e),a.makeApiCall(e),n.updateCallInvitationState(c,{chid:r,media_id:e},o.failed),this.clearData(e),delete d[e]}catch(e){}},i.prototype.isScreenShareSupported=function(){},i.prototype.handleCallRequest=function(t){var i=this,e=this.container,n=e.mediaUIHandler,a=e.constants,o=e.MediaPermission,s=e.commonImpl,r=e.dataHandler,c=e.detailsHandler,e=s.getWmsPushData(t),d=e.chatid,l=(e.type,e.processType);e.negotiationType;if(l&&l==a.reinit)return o.getStreamByType(a.screen_share)&&r.set(a.isAlreadySharing,!0),void s.getPeerObject(t).screenShareRenegotiation();n.showScreenShareInvitation({chid:d,media_id:t,acceptCbk:function(){s.isSmartFlow(t)&&c.isScreenRecordingEnabled()&&c.isScreenRecordAllowed()&&!i.isConsentBannerAccepted()&&i.setConsentBannerAccepted(),i.container.MediaPermission.getScreenShareStream(function(){i.handleUiRequestAccept(t),i.setSharingState({id:t,chid:d});var e=n.getUIState().states[d];e&&e.screen_share&&e.screen_share.stream&&delete e.screen_share.stream,o.screenEndFromBrowserUI(function(){return i.handleUIEnd(t)}),s.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_ALLOWED},mid:t})},function(){i.handleUiRequestReject(t),s.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SCREEN_PERMISSION_BLOCKED},mid:t})})},rejectCbk:function(){i.handleUiRequestReject(t)}})},i.prototype.setSharingState=function(e){var t=this,i=e.chid,n=e.id,e=this.container,a=e.constants,o=e.mediaUIHandler,e=(e.screenShareImpl,e.commonImpl.getWmsPushData(n)),s=e.negotiationType,r=e.type,e=o.getUIState().states[i];e.screen_share=e.screen_share||{},e.screen_share.type=a.sharing,e.screen_share.status=a.connected;e.screen_share.reject_cbk=function(){s==w.screen_share_smart||r==w.screen_share_smart?t.handleUiunifiedEnd(n):t.handleUIEnd(n)}},i.prototype.handleUiRequestAccept=function(e){var t=this.container,i=t.commonImpl,t=t.constants,n=i.getWmsPushData(e).negotiationType,a={process_type:t.negotiation,negotiation_type:n},t={action:t.accept,success_cbk:n==w.screen_share_smart?this.handleUiSmartRequestAcceptSuccessCBK(e):this.handleUiRequestAcceptSuccessCbk(e),failure_cbk:null,extraData:a};i.setApiData(e,t),i.makeApiCall(e)},i.prototype.handleUiRequestAcceptSuccessCbk=function(e){var t=this.container,i=t.dataHandler,t=t.commonImpl,n=t.getWmsPushData(e).chatid;i.get(n+"_peer")[e].addScreenTrackInConnection()||this.handleInitReNegotiation(e),t.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_RENEGOTIATION_TRACKADDED}})},i.prototype.handleUiRequestReject=function(e){var t=this.container,i=t.commonImpl,t=t.constants,n=i.getWmsPushData(e).negotiationType,n={process_type:t.negotiation,negotiation_type:n},t={action:t.reject,success_cbk:null,failure_cbk:null,extraData:n};i.setApiData(e,t),i.makeApiCall(e)},i.prototype.handleStopScreenShare=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.detailsHandler,t=(t.constants,i.getWmsPushData(e).chatid);i.getPeerObject(e).removeScreenTrackInConnection()||(this.removeTrackOnReNegotiation=!0,this.handleInitReNegotiation(e)),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_RENEGOTIATION_TRACKREMOVED},mid:e}),n.deleteScreenShareState(t),n.deletePlayer(t),a.clearChatWindow(),a.clearPlayer()&&i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:a.getMediaActivityAddInfo()},mid:e})},i.prototype.handleCallMissed=function(e){var t=this.container,i=t.mediaUIHandler,n=t.detailsHandler,a=t.commonImpl,t=t.constants,o=a.getWmsPushData(e),s=o.type,r=o.processType,o=o.chatid,c=i.getUIState().states[o];c&&c.screen_share&&c.screen_share.type!=t.viewing&&uiHandler.deleteScreenShareState(o),n.isEmbed()&&n.clearConformBox()&&a.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:n.getMediaActivityAddInfo()}}),a.deleteScreenShareRequestData(o),r&&r==t.negotiation||(i.clearAllStates(o),this.clearData(e),a.removeMediaCache(w.siq_unifiedMedia),n.handleCallMissed({type:s,chid:o}))},i.prototype.handleAudioCallEnd=function(e){var t=this.container,i=t.mediaUIHandler,n=t.MediaPermission,a=t.detailsHandler,o=t.commonImpl,t=t.constants;n.closeStreamByType(t.screen_share),a.isEmbed()&&a.clearConformBox()&&o.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:a.getMediaActivityAddInfo()}}),i.deleteScreenShareState(e),i.deletePlayer(e),a.clearChatWindow(),a.clearPlayer()&&o.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:a.getMediaActivityAddInfo()}}),a.clearPopup()&&o.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:a.getMediaActivityAddInfo()}})},i.prototype.checkOngoingCall=function(e){for(var t=this.container,i=t.dataHandler,n=t.detailsHandler,t=t.constants,a=i.get(t.media_inv),o=0;a&&a.length>o;o++)if(a[o][e=n.isembed?n.getChatWinObjById(e,!0).RCHID:e])return!1;return!0},i.prototype.handleInitReNegotiation=function(e){var t=this.container,i=t.commonImpl,t=t.constants,n=(this.reinit=!0,{process_type:t.reinit,negotiation_type:t.screen_share}),t={action:t.request,success_cbk:null,failure_cbk:null,extraData:n};i.setApiData(e,t),i.makeApiCall(e)},i.prototype.endViewingScreenShare=function(e){var t=this.container,i=t.commonImpl,t=t.constants,n={process_type:t.negotiation,negotiation_type:t.screen_share},t={action:t.end,success_cbk:null,failure_cbk:null,extraData:n};i.setApiData(e,t),i.makeApiCall(e)},i.prototype.showConsentUI=function(e,t){var i=this,n=(void 0===t&&(t=!1),this.container),a=n.mediaUIHandler,o=n.commonImpl.getWmsPushData(e).chatid,n=(t&&(a.getUIState().states[o].screen_share.type=w.sharing,a.getUIState().states[o].screen_share.status=w.connecting),{acceptCbk:function(){t&&(a.getUIState().states[o].screen_share.type=w.viewing,a.getUIState().states[o].screen_share.status=w.connected),i.hideConsentUI(e),i.setConsentBannerAccepted(),i.addScreenTrackInConference()},rejectCbk:function(){t?(a.getUIState().states[o].screen_share.type=w.viewing,a.getUIState().states[o].screen_share.status=w.connected,i.hideConsentUI(e)):i.handleUIConsentReject(e)},chid:o});a.updateCallInvitationState(w.screen_share,n,w.showConstent)},i.prototype.handleUIConsentReject=function(e){this.hideConsentUI(e),this.handleUiunifiedEnd(e)},i.prototype.hideConsentUI=function(e){var t=this.container,i=t.mediaUIHandler,t=t.commonImpl.getWmsPushData(e),e=t.chatid,t=t.chid;i.clearConsentUIState(e||t)},i.prototype.isConsentBannerAccepted=function(){var e=this.container.detailsHandler,t=this.getConsentCookieKey();return!!e.getValueInSession(t)},i.prototype.setConsentBannerAccepted=function(){var e=this.container.detailsHandler,t=this.getConsentCookieKey();e.setValueInSession(t,!0)},i.prototype.getConsentCookieKey=function(){var e=this.container.detailsHandler,t=e.getAppName(),i=e.getApiVisitorId(),e=e.getAVUID();return i?i+"_"+t+"_screen_consent":e+"_"+t+"_screen_consent"};s.prototype.setCredential=function(e){var e=this.getWmsPushData(e),t=e.id,i=e.type,n=e.credentials,e=e.chatid;this.container.dataHandler.set(t+"_credential",{mid:t,credential:n,chid:e,type:i}),this.container.dataHandler.set(t+"_nextTurnServer",w.TURN_URL[0])},s.prototype.removeCredential=function(e){this.container.dataHandler.remove(e+"_credential"),this.container.dataHandler.remove(e+"_nextTurnServer")},s.prototype.constructURL=function(e,t){var i="media",n=this.getVersion(t);return"v2"==n&&e?i+="/"+t+"/"+e:"v3"==n&&(i=t?i+"/"+t:i),i},s.prototype.setActiveCallData=function(e){this.container.dataHandler.set("active_call",e,!0)},s.prototype.getActiveCallData=function(){return this.container.dataHandler.get("active_call",!0)},s.prototype.removeActiveCallData=function(){this.container.dataHandler.remove("active_call",!0)},s.prototype.getAcitveMediaTypes=function(){var e=this.container.dataHandler.get("active_call",!0),e=this.getCallStatusData(this.getMediaIdByChid(e));return v(e)?e.type:[]},s.prototype.checkAVIcon=function(e){var t=this.container,i=t.dataHandler,t=t.mediaUIHandler;i.get("active_call",!0)==e&&t.enableOutingCallUI()},s.prototype.callFailed=function(e,t){var i=this.container.dataHandler.get(e+"_peer")[t].type;this.setWmsPushData(t,{type:i,chatid:e,id:t}),this.container[i+"Impl"].endFailedCall(t)},s.prototype.checkNetwork=function(t,i,e){var n=this,a=(void 0===e&&(e=!1),this.container),o=a.dataHandler,a=a.mediaUIHandler,s=o.get(t+"_peer")[i],r=s.type,c="undefined"==typeof _MEDIASERVERURL?_MEDIASTATICURL:_MEDIASERVERURL;s.reconnectInterval=setTimeout(function(){var e=document.createElement("IMG");e.src=c+"/salesiq/images/spacer_592ebefc7104d681d57852665e9ad514_.gif?nocache="+(new Date).getTime(),e.onload=function(){s.iceRestart=!0,s.isUpStream&&s.createOffer(),n.updateAcceptedTimeForMediaStats(Date.now(),i)},e.onerror=function(){return n.checkNetwork(t,i,!0)}},5e3),s.reconnectEndTimer||(s.reconnectEndTimer=setTimeout(function(){n.container[r+"Impl"].endOngoingCall(t,i),clearTimeout(s.reconnectInterval),s.reconnectEndTimer=null},3e4)),e||a.updateCallInvitationState(r,{chid:t,media_id:i},"reconnecting")},s.prototype.clearNetworkTimer=function(e){clearTimeout(e.reconnectEndTimer),clearTimeout(e.reconnectInterval)},s.prototype.clearCallDetails=function(e,t){this.container.dataHandler.remove(t+"_credential")},s.prototype.updateCommonData=function(){},s.prototype.getCommonData=function(){},s.prototype.callMonitorApiHelper=function(){return{subresource:{init_monitor:"monitors",leave_monitor:"monitors",monitor_join:"participants",monitor_end:"participants"},method:{init_monitor:"post",leave_monitor:"delete",monitor_join:"put",monitor_end:"delete"}}},s.prototype.makeApiCall=function(e){var t=this.getApiData(e),i=t.action,n=t.success_cbk,a=t.failure_cbk,o=t.extraData,t=t.isMonitor,o=Object.assign({},o),s=this.container,r=s.ajaxHandler,s=s.constants,c="";t?(c=this.constructV3URL(e)+"/"+this.callMonitorApiHelper().subresource[i],r[t=this.callMonitorApiHelper().method[i]](c,o,n,a,!0,"post"!=t&&"v3","v3")):(c=this.constructURL(i,e),"v3"==this.getVersion(e)&&-1!=[s.cancel,s.restart,s.miss,s.reject,s.request,s.end,s.accept,s.invite,s.offer,s.answer,s.candidates,s.connected].indexOf(i)?(o.action=i,r.put(c,o,n,null,!0,"v3")):r.post(c,o,n))},s.prototype.updateIncomingRequestData=function(e){var t=this.container,i=t.dataHandler,t=t.constants,n={},a=this.getWmsPushData(e),o=a.chatid,s=a.type,a=a.negotiationType,r=i.get(t.media_inv)||[];n[o]={id:e,type:a||s},r.push(n),i.set(t.media_inv,r,!0)},s.prototype.removeIncomingRequestData=function(e){var t,i=e.id,n=e.chatid,e=this.container,a=e.dataHandler,e=e.constants,o=a.get(e.media_inv,!0);for(t in o){var s=o[t],r=Object.keys(s)[0],s=s[r].id;r==n&&s==i&&o.splice(t,1)}o&&(0==o.length?this.deleteIncomingRequestKey():a.set(e.media_inv,o,!0))},s.prototype.getIncomingRequest=function(){var e=this.container,t=e.dataHandler,e=e.constants;return t.get(e.media_inv,!0)},s.prototype.deleteIncomingRequestKey=function(){var e=this.container,t=e.dataHandler,e=e.constants;t.remove(e.media_inv,!0)},s.prototype.getMediaDataByChidAndType=function(e){var t=e.chatid,e=e.type,t=this.getMediaIdByChid(t),t=t?this.getCallStatusData(t):{};return v(t)&&t.type==e?t:null},s.prototype.endCallByChid=function(e,t){try{var i,n,a,o,s,r,c,d,l,u=this.container,p=u.detailsHandler,h=u.mediaUIHandler,m=u.dataHandler,_=u.constants,g=this.getMediaIdByChid(e),f=g?this.getCallStatusData(g):{};v(f)&&(i=f.type,n=f.callStatus,a=f.isdirectcall,o=f.callType,s=this.container[i+"Impl"],r={type:i,chid:e,media_id:g},c={},p.isOldUI()&&(c.is_old_ui=p.isOldUI()),n==_.connected?(this.isSmartFlow(g)?this.endOngoingUnifiedCall(g,e,t):s.endOngoingCall(e,g,t||function(){return a&&p.endSession(e)}),h.updateCallInvitationState(i,r,_.ended)):n!=_.connected&&o==_.incoming?(this.clearConnectingTimer(g),d={action:_.reject,success_cbk:t,failure_cbk:null,extraData:c},this.setApiData(g,d),a||this.makeApiCall(g),h.updateCallInvitationState(i,r,_.rejected),a&&s.handleUIApiReject(g)):n!=_.connected&&o==_.outgoing&&(clearTimeout(m.get(g+"_waiting_timer")),l={action:_.cancel,success_cbk:t,failure_cbk:null,extraData:c},this.setApiData(g,l),this.makeApiCall(g),h.updateCallInvitationState(i,r,_.cancelled)),s.clearData(g))}catch(e){}},s.prototype.checkOnGoingCall=function(){try{this.checkAndClearDataOnRefresh()}catch(e){}},s.prototype.checkAndClearDataOnRefresh=function(){var t=this;Object.keys(localStorage).forEach(function(e){return e.match(/SiqMedia_/g)&&t.container.dataHandler.remove(e.replace("SiqMedia_",""),!0)})},s.prototype.setActiveTab=function(){var e=this.container,t=e.dataHandler,e=e.constants;t.set(e.media_active,!0)},s.prototype.getActiveTab=function(){var e=this.container,t=e.dataHandler,e=e.constants;return t.get(e.media_active)||!1},s.prototype.removeActiveTab=function(){var e=this.container,t=e.dataHandler,e=e.constants;t.remove(e.media_active)},s.prototype.currentUserBrowserSupportSS=function(){var e=this.container.MediaDetails,t=e.getPlatform();return!!/linux|Microsoft Windows|Mac OS|MacIntel|Win32|Win64/i.test(t)&&e.checkBrowserSupported(w.screen_share)},s.prototype.checkIncomingCallAllowed=function(e){var t=this.container,i=t.constants,t=t.dataHandler,e=this.getWmsPushData(e),n=e.chatid,a=e.type,e=e.negotiationType;if(this.getMediaDataByChidAndType({chatid:n,type:e||a}))for(var o=t.get(n+"_peer"),s=o&&Object.keys(o).length||0,r=0;r<s;r++)return o[Object.keys(o)[r]].connectionStatus!=i.connected?(this.endCallByChid(n),!1):!0;return!1},s.prototype.setMediaStatsDetail=function(e){var t=e.acceptedTime,i=e.type,n=e.mediaid,a=e.reconnectCount,e=e.callerType;this.container.dataHandler.set(n+"_connectionstats",{acceptedTime:t,type:i,mediaid:n,reconnectCount:a,callerType:e})},s.prototype.updateMediaStatsDetail=function(e){var t=e.connectedTime,i=e.isreconnected,e=e.mediaid,n=this.container.dataHandler,a=n.get(e+"_connectionstats");a.connectedTime=t,a.reconnectCount=i?a.reconnectCount+1:a.reconnectCount,n.set(e+"_connectionstats",a)},s.prototype.updateAcceptedTimeForMediaStats=function(e,t){var i=this.container.dataHandler,n=i.get(t+"_connectionstats");n&&(n.acceptedTime=e,i.set(t+"_connectionstats",n))},s.prototype.updateFailedTimeForMediaStats=function(e){var t=e.failedTime,i=e.isreconnected,e=e.mediaid,n=this.container.dataHandler,a=n.get(e+"_connectionstats");a.failedTime=t,a.reconnectCount=i?a.reconnectCount+1:a.reconnectCount,n.set(e+"_connectionstats",a)},s.prototype.getConnectedStatsDetail=function(e){var t=this.container,i=t.dataHandler,t=(t.detailsHandler,t.constants),i=i.get(e+"_connectionstats"),i={latency:i.connectedTime-i.acceptedTime,reconcount:i.reconnectCount,callerType:i.callerType},t={action:t.connected,success_cbk:null,failure_cbk:null,extraData:i};this.setApiData(e,t)},s.prototype.getFailedStatsDetail=function(e){var t=this.container,i=t.dataHandler,t=(t.detailsHandler,t.constants),i=i.get(e+"_connectionstats"),i={latency:i.failedTime-i.acceptedTime,reconcount:i.reconnectCount,callerType:i.callerType},t={action:t.failed,success_cbk:null,failure_cbk:null,extraData:i};this.setApiData(e,t)},s.prototype.clearConnectedStatsDetail=function(e){this.container.dataHandler.remove(e+"_connectionstats")},s.prototype.getPeerObject=function(e){var t=this.container.dataHandler,i=this.getWmsPushData(e).chatid;try{return t.get(i+"_peer")[e]||null}catch(e){return null}},s.prototype.handleScreenTrackEnd=function(){var e=this.container,t=e.detailsHandler,i=e.mediaUIHandler,n=e.MediaPermission,a=e.screenShareImpl,e=e.constants,o=this.getActiveCallData(),s=this.getActiveMediaID(o);i.deleteScreenShareState(o),i.deletePlayer(o),t.clearChatWindow(),t.clearPlayer()&&this.sendMediaActivity({param:{action_type:e.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:t.getMediaActivityAddInfo()},mid:s}),n.getStreamByType(e.screen_share)&&i.updateCallInvitationState(e.screen_share,{chid:o,id:s,callEndCbk:function(){a.handleUIEnd(s)},ss_type:e.sharing},e.connected)},s.prototype.getActiveMediaID=function(e){e=this.getMediaIdByChid(e);return e||""},s.prototype.setScreenShareRequestData=function(e){this.container.dataHandler.set(e+"_screenRequest",!0)},s.prototype.deleteScreenShareRequestData=function(e){this.container.dataHandler.remove(e+"_screenRequest")},s.prototype.isScreenRequestPending=function(e){return!!this.container.dataHandler.get(e+"_screenRequest")},s.prototype.setCallUIPosition=function(e,t){this.container.dataHandler.set("callUIposition",{top:e,left:t})},s.prototype.getCallUIPosition=function(){return this.container.dataHandler.get("callUIposition")},s.prototype.removeCallUIPosition=function(){this.container.dataHandler.remove("callUIposition")},s.prototype.clearMissedCallTimeout=function(e){var t=this.container.dataHandler;clearTimeout(t.get(e+"_waiting_timer")),t.remove(e+"_waiting_timer")},s.prototype.setSwapRequestCallbackState=function(){this.container.dataHandler.set("isScreenShareOngoing",!0)},s.prototype.getSwapRequestCallbackState=function(){return this.container.dataHandler.get("isScreenShareOngoing")},s.prototype.deleteSwapRequestCallbackState=function(){this.container.dataHandler.remove("isScreenShareOngoing")},s.prototype.setRequestingWhileViewingState=function(){this.container.dataHandler.set("requestingWhileViewing",!0)},s.prototype.getRequestingWhileViewingState=function(){return this.container.dataHandler.get("requestingWhileViewing")},s.prototype.deleteRequestingWhileViewingState=function(){this.container.dataHandler.remove("requestingWhileViewing")},s.prototype.clearConnectingTimer=function(e){var t=this.container.dataHandler;clearTimeout(t.get(e+"_connecting_timer")),t.remove(e+"_connecting_timer")},s.prototype.onGoingMediaType=function(e){var t={audio:!1,screenshare:!1},e=this.container.mediaUIHandler.getUIState().states[e];return e&&e.audio?t.audio=!0:t.audio,e&&e.screen_share?t.screenshare=!0:t.screenshare,t},s.prototype.setRemotePerfectReNegotiation=function(e,t,i){t=this.getCallStatusData(t);t&&null!=t.isPerfectRenegotiation&&(e.remotePerfectRenegotiation=t.isPerfectRenegotiation)},s.prototype.endCallFromSameChat=function(e){var t,i=this.container.constants,n=this.getWmsPushData(e).chatid,a=this.getCallStatusData(e);a&&a.id!=e&&(t=(e=a[mid]).type+"Impl",(e=e.callStatus)==i.connected?this.container[t].endOngoingCall(n,mid):e!=i.ringing&&e!=i.connecting||(a.host==i.upstream?this.container[t].handleUICancel(mid):this.container[t].handleUIReject(mid),this.removeActiveCallData()))},s.prototype.sendMediaActivity=function(e){var t=e.param,e=e.mid,i=this.container,n=i.ajaxHandler,i=i.detailsHandler,a=this.getActiveCallData(),a=this.getActiveMediaID(a)||e,e="stats/"+a+"/media/activity";i.isEmbed()&&(t.vwmsid=i.getVisitorWMSID()),a&&n.post(e,t,function(){},function(){},!0,!1,"v2")},s.prototype.checkCallHostType=function(e){e.chid;var t=e.mid,e=e.hostType,t=this.getCallStatusData(t);return!(!t||t.host!=e)},s.prototype.isInvitationPending=function(){var e=this.getIncomingRequest();return!!(e&&0<e.length)},s.prototype.sendRTCNetworkStats=function(e,t){var i=this.container,n=i.ajaxHandler,i=i.detailsHandler,e="stats/"+e+"/media/nrs",a={};i.isEmbed()&&(a.vwmsid=i.getVisitorWMSID()),a.networkstats=t,n.post(e,a,function(){},function(){},!0,!1)},s.prototype.sendRTCConnectionStats=function(e,t){var i=this.container,n=i.ajaxHandler,i=i.detailsHandler,e="stats/"+e+"/media/nrs",a={};i.isEmbed()&&(a.vwmsid=i.getVisitorWMSID()),a.stats=t,n.post(e,a,function(){},function(){},!0,!1)},s.prototype.pushVoiceMessage=function(e){var t=this.container,i=t.ajaxHandler,t=t.detailsHandler,t={action:w.voicemessage,wmsid:t.getVisitorWMSID()},e=this.constructURL(w.voicemessage,e);i.put(e,t,function(){},function(){},!0,"v3")},s.prototype.setMediaCallDetails=function(e){var t=this.container,i=t.constants,t=t.dataHandler;e&&t.set(i.mediaCallDetails,e)},s.prototype.updateMediaCallDetails=function(e,t,i){var n=this.getMediaCallDetails();n&&0<Object.keys(n).length?n[e]||(n[e]={}):(n={})[e]={},n[e][t]=i,this.setMediaCallDetails(n)},s.prototype.updateChidMapList=function(e,t){var i=this.getChidMapList();i&&0<Object.keys(i).length?i[t.chid]=e:(i={})[t.chid]=e,this.setChidMapList(i)},s.prototype.setWmsPushData=function(e,t){this.updateMediaCallDetails(e,w.mediaDetailsKeys.wmsPushData,t),this.updateChidMapList(e,t)},s.prototype.setApiData=function(e,t){this.updateMediaCallDetails(e,w.mediaDetailsKeys.apiData,t)},s.prototype.setCallStatusData=function(e,t){this.updateMediaCallDetails(e,w.mediaDetailsKeys.callStatus,t)},s.prototype.setChidMapList=function(e){var t=this.container,i=t.constants,t=t.dataHandler;e&&t.set(i.chidMapList,e)},s.prototype.getMediaCallDetails=function(){var e=this.container,t=e.constants;return e.dataHandler.get(t.mediaCallDetails)},s.prototype.getWmsPushData=function(e){var t=this.getMediaCallDetails();return t&&t[e]&&t[e].wmsPushData},s.prototype.getApiData=function(e){var t=this.getMediaCallDetails();return t&&t[e]&&t[e].apiData},s.prototype.getCallStatusData=function(e){var t=this.getMediaCallDetails();return t&&t[e]&&t[e].callStatus},s.prototype.getChidMapList=function(){var e=this.container,t=e.constants;return e.dataHandler.get(t.chidMapList)},s.prototype.getMediaIdByChid=function(e){var t=this.getChidMapList();return v(t)&&t[e]},s.prototype.removeMediaCallDetails=function(e){var t=this.container,i=t.constants,t=t.dataHandler,n=this.getMediaCallDetails();n&&1<Object.keys(n).length&&n[e]?(delete n[e],this.setMediaCallDetails(n)):t.remove(i.mediaCallDetails)},s.prototype.removeChidMapList=function(e){var t=this.container,i=t.constants,t=t.dataHandler,n=this.getChidMapList();n&&1<Object.keys(n).length?(delete n[e],this.setChidMapList(n)):t.remove(i.chidMapList)},s.prototype.setIsCallInitiatedFromOldUI=function(e,t){this.updateMediaCallDetails(t,w.mediaDetailsKeys.isCallInitiatedFromOldUI,e)},s.prototype.getIsCallInitiatedFromOldUI=function(e){var t=this.getMediaCallDetails();return t&&t[e]&&t[e].isCallInitiatedFromOldUI},s.prototype.setIsMobileOperator=function(e,t){this.updateMediaCallDetails(t,w.mediaDetailsKeys.isMobileOperator,e)},s.prototype.getIsMobileOperator=function(e){var t=this.getMediaCallDetails();return t&&t[e]&&t[e].isMobileOperator},s.prototype.stopNotificationSound=function(){this.container.detailsHandler.stopNotifSound()},s.prototype.playMediaNotificationSound=function(e){this.container.detailsHandler.playNotifSound(e)},s.prototype.getVersion=function(e){return"v3"},s.prototype.getType=function(e){var t=this.container.constants;return-1!=[t.audio_unified_mix,t.audio_smart].indexOf(e)?t.audio:-1!=[t.screen_share_smart,t.screen_view_smart,t.screen_view].indexOf(e)?t.screen_share:e},s.prototype.setMediaCache=function(e,t){sessionStorage.setItem(e,D(t))},s.prototype.getMediaCache=function(e){e=sessionStorage.getItem(e);return e=e&&JSON.parse(e)},s.prototype.updateMediaCache=function(e,t,i){var n=this.getMediaCache(e);n&&(n[t]=i,sessionStorage.setItem(e,JSON.stringify(n)))},s.prototype.removeMediaCache=function(e){sessionStorage.removeItem(e)},s.prototype.handleMediaOnRefresh=function(e){var t=e.media_id,e=e.status,i=this.container.detailsHandler,n={},i=(i.isOldUI()&&(n.is_old_ui=i.isOldUI()),{success_cbk:function(){},failure_cbk:function(){},extraData:n});e==w.connected?i.action=w.end:e==w.accept||e==w.outgoing?i.action=w.cancel:e==w.incoming&&(i.action=w.reject),this.setApiData(t,i),this.makeApiCall(t)},s.prototype.getImplType=function(e){return e?-1!=e.indexOf("audio")?"audio":-1!=e.indexOf("screen_share")?"screen_share":"":""};var x=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.setUnifiedCredential=function(e){this.container.commonImpl.setCredential(e)},t.prototype.__initUnifiedConnection=function(e){var t=this.container.commonImpl,i=new n(e,this.container);return t.setUnifiedPeerObj({peerObj:i,data:e}),i},t.prototype.handleUnifiedCallCredentail=function(e){var t=this.container,i=t.commonImpl,t=t.detailsHandler,i=i.getWmsPushData(e);t.isEmbed()&&t.isScreenRecordingEnabled()?this.__handleunifiedcallcredentail(e):(this.setUnifiedCredential(e),i.isUpStream=!0,this.__initUnifiedConnection(i),i.audio_offer&&this.handleUnifiedCallOffer(e),this.__createDataChannelCon(e))},t.prototype.__handleunifiedcallcredentail=function(e){var t=this,i=this.container,n=i.commonImpl,a=i.dataHandler,i=i.constants,n=n.getWmsPushData(e);this.isConsentBannerAccepted()?(clearTimeout(a.get(e+"_consent_connecting_timer")),this.__handleUnifiedCallAccept(e),this.setUnifiedCredential(e),n.isUpStream=!0,this.__initUnifiedConnection(n),n.audio_offer&&this.handleUnifiedCallOffer(e),this.__createDataChannelCon(e)):(this.showConsentUI(e,!1),a.set(e+"_consent_connecting_timer",setTimeout(function(){t.handleUICancel(e)},i.WAITING_TIME_30)))},t.prototype.__createDataChannelCon=function(e){e=this.container.commonImpl.getWmsPushData(e);e.type=w.data_channel,e.isDataChannel=!0,e.isUpStream=!0,e.datatype=w.data_channel,this.__initUnifiedConnection(e)},t.prototype.handleUnifiedCallAnswer=function(e){var t=this.container,t=(t.dataHandler,t.commonImpl),i=t.getWmsPushData(e),n=(i.chid,i.session),a=i.tracksId,o=i.negotiationType,s=(i.candidates,i.type),r=i.datatype,t=t.getUnifiedPeerObjByStreamType({id:e,type:r||s,streamType:w.upstream});t.remoteTracksId=a?R(a):null,t.negotiationType=o||null,t.setAnswerRemoteDesription(n),t.setIceCandidatesArray(i),t.sendCandidates()},t.prototype.handleUnifiedCallOffer=function(e){var t=this.container.commonImpl,i=t.getWmsPushData(e),n=i.session,a=i.tracksId,o=i.negotiationType,s=i.type,r=i.credentials,c=i.datatype,d=i.audio_offer,r=(r&&this.setUnifiedCredential(e),d&&(n=i.audio_offer,i.candidates=i.audio_candidate,i.type=w.audio_smart),t.getUnifiedPeerObjByStreamType({id:e,type:c||s,streamType:w.downstream}));r||(i.isUpStream=!1,r=this.__initUnifiedConnection(i),t.getCallStatusData(e).isMonitor?[w.audio_unified_mix,w.audio_smart].includes(c)&&this.__createDataChannelCon(e):this.__initUpStreamUnifiedConnection(i)),r.remoteTracksId=a?R(a):null,r.negotiationType=o||null,r.setOfferRemoteDescription(n),r.setIceCandidatesArray(i),t.setUserTrackDetails(i)},t.prototype.__initUpStreamUnifiedConnection=function(e){var t=this.container.commonImpl,i=(e.chid,e.id),n=e.type;t.getUnifiedPeerObjByStreamType({id:i,type:n,streamType:w.upstream})||(e.isUpStream=!0,this.__initUnifiedConnection(e),this.__createDataChannelCon(i))},t.prototype.addAudioCallInConnection=function(){var i=this;this.container.MediaPermission.getAudioStream(function(){var e=i.container.commonImpl,t=e.getActiveCallData(),e={id:e.getActiveMediaID(t),chid:t,isUpStream:!0,type:w.audio_smart,mediaRequest:!0};i.__initUnifiedConnection(e)},function(){})},t.prototype.handleUnifiedInvitation=function(e){var t=this.container,i=t.commonImpl,n=t.MediaPermission,t=t.detailsHandler,a=i.getWmsPushData(e).chid,n=(n.getAudioStream(null,null),{action:w.accept,session_id:t.getSessionID()});this.container.commonImpl.makeUnifiedCallAccept({dataval:n,id:e}),i.setActiveCallData(a),i.setActiveTab()},t.prototype.unifiedcallConnected=function(e){var t=e.chid,i=e.type,n=e.mid,e=e.isUpStream,a=this.container,o=a.commonImpl,s=a.constants,r=a.dataHandler,a=a.detailsHandler,c=o.getCallStatusData(n);c.host==s.downstream&&(c?(c.callStatus=w.connected,c.active_participants=[a.getCurrentUserId()]):c={callStatus:w.connected,active_participants:[a.getCurrentUserId()]},o.setCallStatusData(n,c),o.updateMediaCache(w.siq_unifiedMedia,w.status,w.connected),this.__updatecallConnectedUi(n)),c.type==w.screen_share_smart&&i==w.audio_smart&&this.__updatecallConnectedUi(n),c.isMonitor&&(s={chid:t,media_id:n},e?o.handleJoinMonitorConnected(i,s):o.handleInitMonitorConnected(s)),o.sendUnifiedConnected({mid:n,isUpStream:e,type:i}),clearTimeout(r.get(n+"_connecting_timer")),r.remove(n+"_connecting_timer")},t.prototype.sendUnifiedCandidates=function(e){this.container.commonImpl.sendUnifiedCandidates(e)},t.prototype.sendUnifiedOffer=function(e){this.container.commonImpl.sendUnifiedOffer(e)},t.prototype.sendUnifiedAnswer=function(e){this.container.commonImpl.sendUnifiedAnswer(e)},t.prototype.notifyUser=function(e){var t=e.mid,i=e.type,n=this.container.commonImpl,a=n.getCallStatusData(t),o=n.getTypeFromConnectionType(a.connection_type,a.type);a.host==w.upstream&&o==i&&(a={action:w.invite,mediainvitation:!0},n.inviteUser({dataval:a,id:t}),e.isNotified=!0)},t.prototype.handleCallAnswerReceived=function(e){var t=this.container,t=(t.dataHandler,t.commonImpl),i=(t.getWmsPushData(e),t.getWmsPushData(e)),n=(i.chid,i.session,i.tracksId,i.negotiationType,i.candidates,i.type),i=i.datatype;t.getUnifiedPeerObjByStreamType({id:e,type:i||n,streamType:w.downstream}).sendCandidates()},t.prototype.handleUnifiedCallAccept=function(e){this.__handleUnifiedCallAccept(e)},t.prototype.__handleUnifiedCallAccept=function(e){var t=this,i=this.container,n=i.dataHandler,a=i.constants,o=i.commonImpl,s=i.mediaUIHandler,i=i.detailsHandler,r=o.getWmsPushData(e),c=r.chatid,d=r.type,l=r.processType,u=r.negotiationType,r=r.connection_type,p=o.getCallStatusData(e);p.isMonitor||(clearTimeout(n.get(e+"_waiting_timer")),n.remove(e+"_waiting_timer"),i.isEmbed()&&!i.isScreenRecordingEnabled()&&i.showEmbedBanner("av.info.recording.disclaimer",5e3,c),i.handleOutgoingAccept({type:d,chid:c}),l&&l==w.negotiation&&u==w.audio?this.addAudioCallInConnection():(p?(p.callStatus=a.connecting,p.type=d,p.connection_type=r):p={callStatus:a.connecting,connection_type:r,type:d},o.setCallStatusData(e,p),n={chid:c,media_id:e,isDirectCall:p.isdirectcall,muteCbk:function(){return t.toggleMute()},rejectCbk:function(){return p.host==a.upstream?t.handleUICancel(e):t.handleUIReject(e)}},o.updateMediaCache(w.siq_directcall,w.status,w.accept),s.updateCallInvitationState(a.audio_unified_mix,n,a.connecting),o.stopNotificationSound()))},t.prototype.handleUnifiedCallConnected=function(e){var t=this.container,i=t.dataHandler,n=t.commonImpl,t=t.detailsHandler,a=n.getCallStatusData(e);a?(a.callStatus=w.connected,a.active_participants=[t.getCurrentUserId()]):a={callStatus:w.connected,active_participants:[t.getCurrentUserId()]},n.setCallStatusData(e,a),n.updateMediaCache(w.siq_unifiedMedia,w.status,w.connected),this.__updatecallConnectedUi(e),clearTimeout(i.get(e+"_waiting_timer")),clearTimeout(i.get(e+"_connecting_timer")),i.remove(e+"_waiting_timer")},t.prototype.__updatecallConnectedUi=function(e){var t=this,i=this.container,n=(i.dataHandler,i.commonImpl),a=i.mediaUIHandler,i=i.constants,o=n.getWmsPushData(e),s=(o.chatid,o.chid),o=(o.mode,o.type,o.mediaRequest,o.isOldUI,o.perfectReNegotiation,n.getCallStatusData(e).isdirectcall);a.updateCallInvitationState(i.audio,{chid:s,id:e,media_id:e,callEndCbk:o?function(){t.handleUIApiCallEnd(e)}:function(){t.closeAllPeerConn(e),t.handleUIEnd(e)},isDirectCall:o},i.connected)},t.prototype.closeAllPeerConn=function(t){var e=[w.screen_view_smart,w.screen_share_smart,w.audio_unified_mix,w.audio_smart,w.data_channel],i=this;e.forEach(function(e){i.container.commonImpl.closeUnifiedPeerConnByType({id:t,type:e})})},t.prototype.handleUnifiedCallEnd=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.screen_shareImpl,t=t.detailsHandler,o=i.getWmsPushData(e).chid,s=i.getCallStatusData(e),r={chid:o,media_id:e,isDirectCall:s.isdirectcall};n.updateCallInvitationState(w.audio,r,w.ended),s.isdirectcall&&i.removeMediaCache(w.siq_directcall),i.removeMediaCache(w.siq_unifiedMedia),a.handleUnifiedCallEnd(e),this.clearData(e),t.handleCallEnded({type:w.audio,chid:o})},t.prototype.updateMuteState=function(e){var t=e.id,e=e.state,i=this.container.commonImpl,n=i.getActiveCallData(),n=i.getActiveMediaID(n)||t;i.sendUnifiedState({id:n,dataval:{action:"state",audio:{mute:e}}})},t.prototype.addUnifiedRemoteStream=function(e,t){var i=this.container,n=i.detailsHandler,a=i.commonImpl,i=(i.mediaUIHandler,i.constants),o=t.chid,s=t.mid,r=t.type,t=t.negotiationType;try{var c,d="",l=e.stream;r!=this.audio&&t!=this.audio&&r!=i.audio_unified_mix&&r!=i.audio_smart||(d=this.addUnifiedAudioPlayer()),e.streams&&(l=e.streams[0]);try{d.srcObject=l,this.getAudioOutputDevice()&&!n.isOldUI()&&(c=this.getAudioOutputDevice(),this.changeAudioPlayer(c,o))}catch(e){d.src=window.URL.createObjectURL(l)}a.checkAndUpdateUIForApi()}catch(e){t="siqMedia: adding remote stream  | chid :"+o+" | mediaid : "+s+" | lsuid : "+n.getCurrentUserId();this.callBackAction(this.implConstants.postDebugLog,t)}},t.prototype.addUnifiedAudioPlayer=function(){try{document.querySelector("#remoteaudio");var e=document.createElement("audio");return e.id="remoteaudio",e.className="siqmediaaudioplayer",e.autoplay=!0,document.querySelector("body").appendChild(e),e}catch(e){}},t.prototype.changeUnifiedAudioInputDevice=function(e,t,i){var n=this,a=this.container,o=a.MediaPermission,s=a.commonImpl,a=s.getCallStatusData(t).connection_type==w.connectionType.SMART?w.audio_smart:w.audio_unified_mix,r=s.getUnifiedPeerObjByStreamType({id:t,type:a,streamType:w.upstream});r&&r.removeAudioTrackInConnection(),o.updatePreferredDeviceByDeviceId(e,"audioInput"),o.getAudioStream(function(){r.audioRenegotiation(),i&&n.toggleMute(),n.setAudioIputDevice(e),s.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_INPUT_DEVICE_CHANGED}})},function(){})},t.prototype.changeUnifiedAudioPlayer=function(e,t){var i=document.getElementsByClassName("siqmediaaudioplayer"),n=i.length;if(0<n){this.setAudioOutputDevice(e);for(var a=0;a<n;a++)void 0!==i[a].sinkId&&i[a].setSinkId(e);this.container.commonImpl.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_OUTPUT_DEVICE_CHANGED}})}},t}(e),B=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.handleUnifiedCallCredentail=function(e){var t=this.container.commonImpl.getWmsPushData(e);this.setUnifiedCredential(e),t.isUpStream=!0,t.type==w.screen_share_smart?this.__initUnifiedConnection(t):this.notifyUser({mid:t.id,type:w.screen_view_smart}),t.audio_offer&&this.handleUnifiedCallOffer(e)},t.prototype.__makeCallAccept=function(e){var t={action:w.accept,session_id:this.container.detailsHandler.getSessionID()};this.container.commonImpl.makeUnifiedCallAccept({dataval:t,id:e})},t.prototype.setUnifiedCredential=function(e){this.container.commonImpl.getWmsPushData(e);this.container.commonImpl.setCredential(e)},t.prototype.__initUnifiedConnection=function(e){var t=this.container.commonImpl,i=new n(e,this.container);return e.type==w.screen_view_smart&&(e.type=w.screen_share_smart),t.setUnifiedPeerObj({peerObj:i,data:e}),i},t.prototype.addScreenTrackInConference=function(e){var i=this,t=this.container,n=t.MediaPermission,a=t.mediaUIHandler,o=t.detailsHandler,t=this.container.commonImpl,e=(e=void 0===e?{}:e).isInvite,s=t.getActiveCallData(),r=t.getActiveMediaID(s);n.getScreenShareStream(function(){function e(){return i.handleUiunifiedEnd(r)}var t=a.getUIState().states[s];t&&t.screen_share?(i.__endUnifiedSreenShare(r),a.deletePlayer(s),o.clearPlayer(),o.clearConformBox()&&clearTimeout(i.timeout[r])):(t=null,t=o.isEmbed()?o.getVisitorWMSID():o.getCurrentUserId(),t={id:r,chid:s,isUpStream:!0,type:w.screen_share_smart,mediaRequest:!1,creatorid:t},i.__initUnifiedConnection(t),a.makeScreenShareConnected(w.screen_share,{chid:s,media_id:r,callEndCbk:e,ss_type:w.sharing}),n.screenEndFromBrowserUI(e))},e?this.onMediaPermissionFailure(s,r):function(){})},t.prototype.sendUnifiedOffer=function(e){this.container.commonImpl.sendUnifiedOffer(e)},t.prototype.sendUnifiedAnswer=function(e){this.container.commonImpl.sendUnifiedAnswer(e)},t.prototype.sendUnifiedCandidates=function(e){this.container.commonImpl.sendUnifiedCandidates(e)},t.prototype.handleUnifiedCallOffer=function(e){var t=this.container,t=(t.dataHandler,t.commonImpl),i=t.getWmsPushData(e),n=(i.chid,i.session),a=i.tracksId,o=i.negotiationType,s=(i.candidates,i.type),r=i.credentials,c=i.datatype,r=(i.audio_offer&&(n=i.audio_offer,i.candidates=i.audio_candidate,i.type=w.audio_smart),r&&this.setUnifiedCredential(e),t.getUnifiedPeerObjByStreamType({id:e,type:c||s,streamType:w.downstream}));r||(i.isUpStream=!1,r=this.__initUnifiedConnection(i)),r.remoteTracksId=a?R(a):null,r.negotiationType=o||null,r.setOfferRemoteDescription(n),r.setIceCandidatesArray(i),t.setUserTrackDetails(i)},t.prototype.handleUnifiedCallAnswer=function(e){var t=this.container,t=(t.dataHandler,t.commonImpl),i=t.getWmsPushData(e),n=(i.chid,i.session),a=i.tracksId,o=i.negotiationType,s=(i.candidates,i.type),r=i.datatype,t=t.getUnifiedPeerObjByStreamType({id:e,type:r||s,streamType:w.upstream});t.remoteTracksId=a?R(a):null,t.negotiationType=o||null,t.setAnswerRemoteDesription(n),t.setIceCandidatesArray(i),t.sendCandidates()},t.prototype.notifyUser=function(e){var t=e.mid,i=e.type,n=this.container.commonImpl,a=n.getCallStatusData(t),o=n.getTypeFromConnectionType(a.connection_type,a.type);a.host==w.upstream&&o==i&&(a={action:w.invite,mediainvitation:i!=w.screen_share_smart,mediarequest:i!=w.screen_share_smart},n.inviteUser({dataval:a,id:t}),e.isNotified=!0)},t.prototype.unifiedcallConnected=function(e){e.chid;var t=e.type,i=e.mid,e=(e.isReconnecting,e.isUpStream);this.container.commonImpl.sendUnifiedConnected({mid:i,isUpStream:e,type:t})},t.prototype.handleUnifiedInvitation=function(e){var t=this.container,i=t.commonImpl,t=t.detailsHandler,n=i.getWmsPushData(e).chid,t={action:w.accept,session_id:t.getSessionID()};this.container.commonImpl.makeUnifiedCallAccept({dataval:t,id:e}),i.setActiveCallData(n),i.setActiveTab()},t.prototype.handleCallAnswerReceived=function(e){var t=this.container,t=(t.dataHandler,t.commonImpl),i=t.getWmsPushData(e),n=(i.chid,i.session,i.tracksId,i.negotiationType,i.candidates,i.type),i=i.datatype;t.getUnifiedPeerObjByStreamType({id:e,type:i||n,streamType:w.downstream}).sendCandidates()},t.prototype.handleUnifiedCallConnected=function(e){var t=this,i=this.container,n=i.audioImpl,a=i.commonImpl,o=i.mediaUIHandler,s=i.detailsHandler,i=i.MediaPermission,r=a.getWmsPushData(e),c=r.chid,d=r.datatype,r=r.isupstream,l=a.getCallStatusData(e).isdirectcall;d==w.audio_unified_mix||d==w.audio_smart&&1==r?n.handleUnifiedCallConnected(e):d!=w.audio_unified_mix&&d!=w.audio_smart&&((r=a.getCallStatusData(e))?(r.callStatus=w.connected,r.active_participants=[s.getCurrentUserId()]):r={callStatus:w.connected,active_participants:[s.getCurrentUserId()]},a.setCallStatusData(e,r),o.updateCallInvitationState(w.screen_share_smart,{chid:c,media_id:e,isDirectCall:l,callEndCbk:l?function(){t.handleUIApiCallEnd(e)}:function(){t.handleUiunifiedEnd(e)},ss_type:i.getStreamByType(w.screen_share)?w.sharing:w.viewing},w.connected))},t.prototype.swapUnifiedScreenShare=function(e){var t=e.chid||e.chatid,i=e.id,e=this.container,n=e.audioImpl,a=e.mediaUIHandler,o=e.uiHandler,s=e.commonImpl,e=e.detailsHandler,r=a.getUIState().states[t];r&&r.screen_share&&(r.screen_share.type==w.viewing?(e.clearChatWindow(),!e.isEmbed()||!e.isScreenRecordingEnabled()||!e.isScreenRecordAllowed()||this.isConsentBannerAccepted()?this.addScreenTrackInConference():this.showConsentUI(i,!0)):r.screen_share.type==w.sharing&&(s.setSwapRequestCallbackState(),e={chid:t,media_id:i,cancelCbk:function(){return a.handleUIRequestCancel(w.screen_share,t,i)},ss_type:w.viewing},o.showScreenShareMaking(w.screen_share,e),r={chid:t,mid:i,negotiationType:w.screen_share_smart},n.initCallRequest(r)))},t.prototype.__endUnifiedSreenShare=function(i){var e,t,n=this,a=this.container,o=a.commonImpl,s=a.detailsHandler,r=a.mediaUIHandler,c=a.MediaPermission,a=o.getWmsPushData(i),d=(a.type,a.chid),l=[w.upstream,w.downstream];for(t in l){var u=o.getUnifiedPeerObjByStreamType({id:i,type:w.screen_share_smart,streamType:l[t]});u&&(e=u.creatorid)}var a={negotiation_type:w.screen_share_smart,process_type:w.negotiation,creator_id:e},p=o.getCallStatusData(i),p=(p.isdirectcall,{id:i,chid:d,type:w.screen_share_smart}),p=(o.setWmsPushData(i,p),this.closeUnifiedPeerConn(i),succescbk=function(){function e(){return n.handleUiunifiedEnd(i)}var t=null,t=s.isEmbed()?s.getVisitorWMSID():s.getCurrentUserId(),t={id:i,chid:d,isUpStream:!0,type:w.screen_share_smart,mediaRequest:!1,creatorid:t};setTimeout(function(){r.makeScreenShareConnected(w.screen_share,{chid:d,media_id:i,callEndCbk:e,ss_type:w.sharing})},500),c.screenEndFromBrowserUI(e),n.__initUnifiedConnection(t)},{action:w.end,success_cbk:succescbk,failure_cbk:null,extraData:a});o.setApiData(i,p),o.makeApiCall(i)},t.prototype.handleUnifiedCallEnd=function(e){var t=this.container,i=t.commonImpl,n=t.mediaUIHandler,a=t.MediaPermission,t=t.detailsHandler,o=i.getWmsPushData(e),s=o.chid,r=o.processType;o.negotiationType;n.deleteScreenShareState(s),n.deletePlayer(s),t.clearPlayer()&&i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:t.getMediaActivityAddInfo()},mid:e}),t.clearChatWindow(),a.closeStreamByType(w.screen_share),r&&r==w.negotiation?this.closeUnifiedPeerConn(e):(this.closeAllPeerConn(e),n.updateCallInvitationState(w.audio,{chid:s,media_id:e},w.ended),this.clearData(e),t.handleCallEnded({type:w.screen_share,chid:s}),t.clearPopup()&&i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:t.getMediaActivityAddInfo()},mid:e}),n.clearConformBox()&&n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:n.getMediaActivityAddInfo()},mid:media_id}),n.stopTimer(s),n.clearAllStates(s),t.clearAudioUI())},t.prototype.closeUnifiedPeerConn=function(e){var t,i=this.container,n=(i.dataHandler,i.commonImpl),i=(i.mediaUIHandler,i.constants,i.MediaPermission,n.getWmsPushData(e)),a=(i.chatid,i.chid,i.mode,i.type),o=(i.mediaRequest,i.isOldUI,i.perfectReNegotiation,i.negotiationType),o=(i.processType,o&&o==w.screen_view_smart?w.screen_share_smart:o),s=[w.upstream,w.downstream];for(t in s){var r=n.getUnifiedPeerObjByStreamType({id:e,type:o||a,streamType:s[t]});r&&(r.closeConnection(),n.removeUnifiedPeerObjByStreamType({id:e,type:o||a,streamType:s[t]}))}},t.prototype.closeAllPeerConn=function(t){var e=[w.screen_view_smart,w.screen_share_smart,w.audio_unified_mix,w.audio_smart,w.data_channel],i=this;e.forEach(function(e){i.container.commonImpl.closeUnifiedPeerConnByType({id:t,type:e})})},t.prototype.handleUiSmartRequestAcceptSuccessCBK=function(e){var t=this.container.detailsHandler;this.__endUnifiedSreenShare(e),t.clearPlayer()},t.prototype.handleUiunifiedEnd=function(e){try{var t=this.container,i=t.mediaUIHandler,n=t.detailsHandler,a=t.commonImpl.getWmsPushData(e).chid;i.getUIState().states[a].audio?i.getUIState().states[a].screen_share.type==w.viewing?(this.__makeUnifiedScreenEnd(e,w.screen_view_smart),this.__closeUnifiedPeerConnByType({id:e,type:w.screen_share_smart}),i.deleteScreenShareState(a),i.deletePlayer(a),n.clearPlayer(),n.clearChatWindow()):(this.__makeUnifiedScreenEnd(e,w.screen_share_smart),this.__endUnifiedScreenSharing(e)):(i.updateCallInvitationState(w.screen_share_smart,{chid:a,media_id:e},w.ended),this.__closeUnifiedPeerConnByType({id:e,type:w.data_channel}),this.__makeUnifiedScreenEnd(e),this.__endUnifiedScreenSharing(e),this.clearData(e),n.handleCallEnded({type:w.screen_share,chid:a}))}catch(e){}},t.prototype.__closeUnifiedPeerConnByType=function(e){var t,i=e.id,n=e.type,a=this.container.commonImpl,o=[w.upstream,w.downstream];for(t in o){var s=a.getUnifiedPeerObjByStreamType({id:i,type:n,streamType:o[t]});s&&(s.closeConnection(),a.removeUnifiedPeerObjByStreamType({id:i,type:n,streamType:o[t]}))}},t.prototype.__endUnifiedScreenSharing=function(e){var t=this.container,i=t.MediaPermission,n=t.commonImpl,a=t.detailsHandler,t=t.mediaUIHandler,n=n.getWmsPushData(e).chid;i.closeStreamByType(w.screen_share),t.deleteScreenShareState(n),t.deletePlayer(n),a.clearPlayer(),a.clearChatWindow(),this.__closeUnifiedPeerConnByType({id:e,type:w.screen_share_smart})},t.prototype.__makeUnifiedScreenEnd=function(e,t){var i,n=this.container,a=n.commonImpl,n=n.constants,o=a.getWmsPushData(e),s=(o.type,o.chid,null),r=[w.upstream,w.downstream];for(i in r){var c=a.getUnifiedPeerObjByStreamType({id:e,type:w.screen_share_smart,streamType:r[i]});c&&(s=c.creatorid)}o={creator_id:s},t&&(o.process_type=n.negotiation,o.negotiation_type=t),t={action:n.end,success_cbk:null,failure_cbk:null,extraData:o};a.setApiData(e,t),a.makeApiCall(e)},t.prototype.handleUnifiedCallAccept=function(t){var i=this,e=this.container,n=(e.dataHandler,e.constants),a=e.commonImpl,o=e.mediaUIHandler,e=(e.detailsHandler,a.getWmsPushData(t)),s=e.chid,r=e.type,e=(e.processType,e.isOldUI,e.isMobileOperator,a.getCallStatusData(t)),e=(e?(e.type=r,e.callStatus=n.connecting):e={callStatus:n.connecting},a.setCallStatusData(t,e),a.clearMissedCallTimeout(t),a.clearConnectingTimer(t),a.deleteSwapRequestCallbackState(),{chid:s,media_id:t,muteCbk:function(){},rejectCbk:function(){var e={action:n.cancel,success_cbk:null,failure_cbk:null};a.setApiData(t,e),a.makeApiCall(t),o.updateCallInvitationState(r,{chid:s,media_id:t},n.cancelled),i.clearData(t)}});o.updateCallInvitationState(n.screen_share,e,n.connecting)},t.prototype.addUnifiedRemoteStream=function(e,t){var i=this;try{t.type;var n=t.mid,a=t.chid,o=t.negotiationType,s=this.container,r=s.constants,c=s.mediaUIHandler,d=s.dataHandler,l=s.commonImpl,u=e.stream;if(e.streams&&(u=e.streams[0]),o==r.audio)return;function p(){i.handleUiunifiedEnd(n)}d.get(r.isAlreadySharing)&&(d.set(r.isAlreadySharing,!1),setTimeout(function(){i.handleStopScreenShare(n)},2e3));var h=this.container.uiHandler.states[a],m=(l.getUnifiedPeerObjByStreamType({id:n,type:r.screen_share_smart,streamType:r.downstream})&&h&&h.screen_share&&h.screen_share.type&&(this.container.uiHandler.states[a].screen_share.type=r.viewing),c.getUIState().states&&c.getUIState().states[a]&&c.getUIState().states[a].screen_share);if(m&&m.type==r.sharing)return;c.updateCallInvitationState(r.screen_share,{isMonitor:l.isCurrentUserMonitor(n),chid:a,id:n,media_id:n,callEndCbk:p},r.connected),c.playScreenShareStream({stream:u,chid:a,mid:n,endCbk:p})}catch(e){}},t}(i),z=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.setUnifiedCredential=function(e){},t.prototype.setUnifiedPeerObj=function(e){var t=e.peerObj,e=e.data,i=this.container.dataHandler,n=e.id,a=e.isUpStream,o=e.type,e=e.datatype,a=a?w.upstream:w.downstream,s={},r=(s[a]=t,this.getUnifiedPeerObj({id:n}));(r=r||{})[e||o]?r[e||o][a]=t:r[e||o]=s,i.set(n+"_unifiedconnection",r)},t.prototype.getUnifiedPeerObjByStreamType=function(e){var t=e.id,i=e.type,e=e.streamType,t=this.container.dataHandler.get(t+"_unifiedconnection");if(!t)return null;t=t[i];return t?t[e]:null},t.prototype.removeUnifiedPeerObjByStreamType=function(e){var t=e.id,i=e.type,e=e.streamType,t=this.container.dataHandler.get(t+"_unifiedconnection");return(t=t&&t[i])?void delete t[e]:null},t.prototype.getUnifiedPeerObj=function(e){e=e.id,e=this.container.dataHandler.get(e+"_unifiedconnection");return e||null},t.prototype.setUserTrackDetails=function(e){var t=this.container.dataHandler,i=e.id,n=e.userDetails;(this.getUnifiedTrackDetails(e)||{})[n],t.set(i+"_unifiedtrackdetails",n)},t.prototype.getUnifiedTrackDetails=function(e){e=e.id,e=this.container.dataHandler.get(e+"_unifiedtrackdetails");return e||null},t.prototype.sendUnifiedOffer=function(e){e.chid;var t=e.description,i=e.mid,n=(e.type,e.tracksId),a=e.negotiationType,o=e.processType,s=e.candidate,e=e.dataType,r=this.container,r=(r.detailsHandler,r.ajaxHandler),i=this.constructV3URL(i),c={};c.offer_sdp=t,c.tracks_id=R(n),c.negotiation_type=a,c.process_type=o,c.action="offer",c.candidate=s,c.data_type=e,r.put(i,c,null,null,!0,"v3")},t.prototype.sendUnifiedAnswer=function(e){e.chid;var t=e.description,i=e.mid,n=(e.type,e.tracksId),a=e.negotiationType,o=e.processType,s=e.candidate,r=e.dataType,e=e.creatorid,c=this.container,c=(c.detailsHandler,c.ajaxHandler),i=this.constructV3URL(i),d={};d.tracks_id=R(n),d.negotiation_type=a,d.process_type=o,d.answer_sdp=t,d.data_type=r,d.candidate=s,d.action="answer",d.creator_id=e,c.put(i,d,null,null,!0,"v3")},t.prototype.sendUnifiedCandidates=function(e){var t=e.candidates,i=(e.chid,e.mid),n=(e.type,e.isupstream),a=e.dataType,e=e.creatorid,i=this.constructV3URL(i),o={};o.ice_candidates=t,o.action="candidates",o.isupstream=n,o.data_type=a,o.creator_id=e,this.container.ajaxHandler.put(i,o,null,null,!0,"v3")},t.prototype.inviteUser=function(e){var t=e.dataval,e=e.id,e=this.constructV3URL(e);this.container.ajaxHandler.put(e,t,null,null,!0,"v3")},t.prototype.makeUnifiedCallAccept=function(e){var t=e.dataval,e=e.id,e=this.constructV3URL(e);this.container.ajaxHandler.put(e,t,null,null,!0,"v3")},t.prototype.sendUnifiedConnected=function(e){var t=e.mid,i=e.isUpStream,e=e.type,t=this.constructV3URL(t),n={action:"connected"};n.isupstream=i,n.data_type=e,this.container.ajaxHandler.put(t,n,null,null,!0,"v3")},t.prototype.sendUnifiedState=function(e){var t=e.dataval,e=e.id,e=this.constructV3URL(e);this.container.ajaxHandler.put(e,t,null,null,!0,"v3")},t.prototype.constructV3URL=function(e){var t="media";return e&&(t+="/"+e),t},t.prototype.isSmartFlow=function(e){e=this.getCallStatusData(e);return!(!e||!e.type||!e.type.includes("unified")&&!e.type.includes("smart"))},t.prototype.checkUnifiedNetwork=function(t,e){var i=this,n=(void 0===e&&(e=!1),t.chid),a=t.mid,o=this.container.mediaUIHandler,s=t.type,r="undefined"==typeof _MEDIASERVERURL?_MEDIASTATICURL:_MEDIASERVERURL;t.reconnectInterval=setTimeout(function(){var e=document.createElement("IMG");e.src=r+"/salesiq/images/spacer_592ebefc7104d681d57852665e9ad514_.gif?nocache="+(new Date).getTime(),e.onload=function(){clearTimeout(t.reconnectInterval),t.reconnectEndTimer=null,t.iceRestart=!0,t.isUpStream?t.createOffer():t.isUpStream||i.__initRegenerateOffer(t),t.isReconnecting=!0,t.iceRestart=!0,i.updateAcceptedTimeForMediaStats(Date.now(),a)},e.onerror=function(){return i.checkUnifiedNetwork(t,!0)}},5e3),t.reconnectEndTimer||(t.reconnectEndTimer=setTimeout(function(){i.container[s+"Impl"].endOngoingCall(n,a),clearTimeout(t.reconnectInterval),t.reconnectEndTimer=null},3e4)),e||o.updateCallInvitationState(s,{chid:n,media_id:a},"reconnecting")},t.prototype.__initRegenerateOffer=function(e){var t=this.container.detailsHandler,i=e.mid,n=this.constructV3URL(i),t={action:w.restart,data_type:e.type,session_id:t.getSessionID()};this.container.ajaxHandler.put(n,t,null,null,!0,"v3"),e.closeConnection(),this.removeUnifiedPeerObjByStreamType({id:i,type:e.type,streamType:w.downstream})},t.prototype.closeUnifiedPeerConnByType=function(e){var t,i=e.id,n=e.type,a=[w.upstream,w.downstream];for(t in a){var o=this.getUnifiedPeerObjByStreamType({id:i,type:n,streamType:a[t]});o&&(o.closeConnection(),this.clearNetworkTimer(o),this.removeUnifiedPeerObjByStreamType({id:i,type:n,streamType:a[t]}),this.clearMediaPermision(n))}},t.prototype.endOngoingUnifiedCall=function(t,e,i){var n=this.container,a=n.detailsHandler,n=n.mediaUIHandler,o=Boolean(this.getCallStatusData(t)&&this.getCallStatusData(t).isMonitor),s=[w.screen_view_smart,w.screen_share_smart,w.audio_unified_mix,w.audio_smart,w.data_channel],r=this;s.forEach(function(e){r.closeUnifiedPeerConnByType({id:t,type:e})}),a.isEmbed()&&a.clearConformBox()&&this.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:a.getMediaActivityAddInfo()}}),n.deleteScreenShareState(e),a.clearChatWindow(),n.deletePlayer(e),a.clearPlayer()&&this.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_CLEARED,add_info:a.getMediaActivityAddInfo()}}),a.clearPopup()&&this.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:a.getMediaActivityAddInfo()}}),o?(SiqAVRouter.container.uiHandler.handleStopMonitor(e),i()):(s={action:w.end,success_cbk:i,failure_cbk:function(){},extraData:{}},this.setApiData(t,s),this.makeApiCall(t))},t.prototype.getTypeFromConnectionType=function(e,t){if(this.container.detailsHandler.isOldUI())return t;var i={audio:{unified:w.audio_unified_mix,smart:w.audio_smart},screen_share:{unified:w.screen_share_smart,smart:w.screen_share_smart},screen_view:{unified:w.screen_view_smart,smart:w.screen_view_smart}};return i[t]&&null!=i[t][e]?i[t][e]:t},t.prototype.clearMediaPermision=function(e){var t={audio_unified_mix:w.audio,audio_smart:w.audio,screen_share_smart:w.screen_share,screen_view_smart:w.screen_share};this.container.MediaPermission.closeStreamByType(e=null!=t[e]?t[e]:e)},t.prototype.handleMonitorAction=function(e){var t,i,n,a,o,s,r=e.id,c=e.participants,d=e.chid,e=e.operation,l=this.container,u=l.mediaUIHandler,l=l.detailsHandler,c=c[0],p=c.id;p!=l.getCurrentUserId()||this.getActiveTab()?(e==w.monitor_end&&(t=this.getUnifiedPeerObjByStreamType({id:r,type:w.screen_share_smart,streamType:w.downstream}))&&t.creatorid==p&&(this.closeUnifiedPeerConnByType({id:r,type:w.screen_share_smart}),u.deleteScreenShareState(d),u.deletePlayer(d),l.clearPlayer(),l.clearChatWindow()),t=this.getCallStatusData(r),i=t.active_participants||[],i=e==w.monitor_join?(s=p,-1==(o=i).indexOf(s)&&o.push(s),o):(a=p,i.filter(function(e){return e!=a})),t.active_participants=i,this.setCallStatusData(r,t),u.updateMonitorData(d,{participants:i})):(e==w.init_monitor?n=c.role:e==w.monitor_end&&(n=w.mediaUserTypes.available_monitor),MediaLib.UIHandler("updateMonitorRole",{user_id:l.getCurrentUserId(),role:n,cu_id:l.getVisitorID(d)}))},t.prototype.isCurrentUserMonitor=function(e){e=this.getCallStatusData(e);return v(e)&&e.isMonitor||!1},t.prototype._startMonitor=function(e){var e=e.media_id,t=this.container.detailsHandler;this.setApiData(e,{action:w.init_monitor,success_cbk:this.handleInitMonitorSuccess.bind(this),failure_cbk:null,extraData:{session_id:t.getSessionID()},isMonitor:!0}),this.makeApiCall(e)},t.prototype.handleUIMonitor=function(e){var t=this,i=e.chid,n=this.getActiveCallData();n&&n!=i?MediaLib.UIHandler("showAlert",{title:"call.monitordialog.title",subTitle:"call.monitordialog.subtitle",iconType:"Monitor",buttons:{ok:{name:"call.monitordialog.clashaccept",callback:function(){t.endCallByChid(n),t._startMonitor(e)}},cancel:{name:"common.stay",callback:function(){}}}}):this._startMonitor(e)},t.prototype.handleInitMonitorSuccess=function(e){var t=this,i=this.container,n=i.constants,i=i.mediaUIHandler,e=e.data||{},a=e.id,o=e.type,s=e.media_request,r=e.connection_type,c=e.recording_type,d=e.chid,l=e.connected_time,u=e.participants,e=e.isaudiopresent,o=this.getTypeFromConnectionType(r,o),p=[],u=(u.forEach(function(e){return["owner","active_monitor"].includes(e.role)?p.push(e.id):""}),{callType:n.outgoing,callStatus:n.init_monitor,mediarequest:s,host:n.upstream,isdirectcall:!1,isPerfectRenegotiation:!1,type:o,connection_type:r,recording_type:c,isMonitor:!0,connected_time:l,active_participants:p}),h=(this.setCallStatusData(a,u),this.setActiveCallData(d),this.setActiveTab(),{media_id:a,chid:d,action:w.leave_monitor,isMonitor:!0,role:w.mediaUserTypes.silent_monitor,isaudiopresent:e});h.joinCbk=function(){return t.handleUIJoinMonitor(h)},h.rejectCbk=function(){return t.handleUICancelMonitor(h)},i.handleCallMonitorUIInitiate(o,h)},t.prototype.handleInitMonitorConnected=function(e){var t=this,i=e.media_id,e=e.chid,n=this.container,a=n.mediaUIHandler,n=n.detailsHandler,o=this.getCallStatusData(i),s={chid:e,media_id:i,action:w.leave_monitor};o.callStatus=w.monitoring,this.setCallStatusData(o),a.handleCallMonitorConnected(w.monitor,{chid:e,media_id:i,connected_time:o.connected_time,active_participants:o.active_participants||[],rejectCbk:function(){return t.handleUIEndMonitor(s)}}),MediaLib.UIHandler("updateMonitorRole",{user_id:n.getCurrentUserId(),role:w.mediaUserTypes.silent_monitor,cu_id:n.getVisitorID(e)})},t.prototype.handleJoinMonitorConnected=function(e,t){var i=this,n=(void 0===e&&(e=w.audio),t.media_id),t=t.chid,a=this.container,o=a.audioImpl,s=a.mediaUIHandler,a=a.detailsHandler,r=this.getCallStatusData(n),c={chid:t,media_id:n,action:w.monitor_end};r.callStatus=w.connected,this.setCallStatusData(r),s.handleCallMonitorJoinConnected(e,{chid:t,media_id:n,rejectCbk:function(){return i.handleUIEndMonitor(c)},muteCbk:function(){return o.toggleMute()}}),MediaLib.UIHandler("updateMonitorRole",{user_id:a.getCurrentUserId(),role:w.mediaUserTypes.active_monitor,cu_id:a.getVisitorID(t)})},t.prototype.handleUIJoinMonitor=function(e){var t=this,i=this.container.mediaUIHandler,n=e.media_id;this.setApiData(n,{action:w.monitor_join,success_cbk:this.handleJoinMonitorSuccess.bind(this),failure_cbk:function(){},extraData:{},isMonitor:!0}),this.makeApiCall(n),e.action=w.leave_monitor,e.rejectCbk=function(){return t.handleUICancelMonitor(e)},e.role=w.mediaUserTypes.active_monitor,i.handleCallMonitorUIJoin(w.monitor,e)},t.prototype.handleJoinMonitorSuccess=function(e){var t,i,e=e.data||{},n=e.participants,a=e.id,o=e.chid,e=e.isaudiopresent,s=this.container,r=s.mediaUIHandler,s=s.audioImpl,c=this.getCallStatusData(a),d=[];n.forEach(function(e){return["owner","active_monitor"].includes(e.role)?d.push(e.id):""}),n=d,t=c.active_participants||[],i=n.concat(t),d=i.filter(function(e,t){return i.indexOf(e)===t}),c.active_participants=d,this.setCallStatusData(a,c),r.updateMonitorData(o,{participants:d}),e?s.addAudioCallInConnection():this.handleJoinMonitorConnected(w.screen_share,{chid:o,media_id:a})},t.prototype.handleUICancelMonitor=function(e){var t=this.container,i=t.mediaUIHandler,n=t.detailsHandler,a=t.commonImpl,t=t.audioImpl,o=e.media_id;a.setApiData(o,{action:e.action,success_cbk:null,failure_cbk:null,isMonitor:!0}),a.makeApiCall(o),t.clearData(o),n.removeAudioPlayers(),i.updateCallInvitationState(w.monitor,e,e.action)},t.prototype.handleUIEndMonitor=function(e){var t=this.container,i=t.mediaUIHandler,n=t.detailsHandler,a=t.commonImpl,o=t.audioImpl,t=t.screenShareImpl,s=e.media_id;a.setApiData(s,{action:e.action,success_cbk:null,failure_cbk:null,isMonitor:!0}),a.makeApiCall(s),t.__endUnifiedScreenSharing(s),o.clearData(s),t.clearData(s),n.removeAudioPlayers(),i.updateCallInvitationState(w.monitor,e,e.action),MediaLib.UIHandler("updateMonitorRole",{user_id:n.getCurrentUserId(),role:w.mediaUserTypes.available_monitor,cu_id:n.getVisitorID(e.chid)})},t.prototype.isVisitorSharing=function(e,t){t=this.container.mediaUIHandler.getUIState().states[t],e=this.getUnifiedPeerObjByStreamType({id:e,type:w.screen_share_smart,streamType:w.downstream});return Boolean(e&&"$"==e.creatorid[0]&&t&&t.screen_share&&t.screen_share.type==w.viewing)},t}(s),W=function(e){function t(){e.apply(this,arguments),this.isDirectCallAllowed=!1}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.audioIconStatus=function(e,t,i){void 0===i&&(i=1);var n=this.container,a=n.detailsHandler,o=n.commonImpl,s=n.dataHandler,r=n.MediaDetails,n=n.constants,c=o.getMediaDataByChidAndType({chatid:e,type:n.audio})||!1,d=s.get(n.media_active),l=(-1==e&&t(e,n.hide),{not_group_chat:!!a.isCallMonitorConfEnabled()||!a.isGroupConversation(e),not_bot:!a.isAttenderBot(e),ongoing_chat:a.isChatExist(e),audiocall_enabled:a.isAudioCallEnabled(),current_plan_allowed:a.isPlanAllowed(),is_secure:a.isSecureConnection(),is_proactive_chat:!a.isProactiveChat(e),live_chat_window:a.isliveChatWindow(),isFacebookIntegration:!a.isFaceBookIntegration(),isBrandsDisabled:!s.get("isBrandsDisabled")||!1,isBrowserSupported:r.checkBrowserSupported(w.audio)||r.isNotebookDSKApp(),not_queued_chat:!a.isCurrentChatQueued()}),u={ongoing_call_current_chat:c,incoming_call_notification:a.hasIncomingCall(e),ongoing_media:a.onGoingCallForChat(e),isMediaActive:d,isInvitationPending:o.isInvitationPending()},s={1:["not_group_chat","not_bot","ongoing_chat","audiocall_enabled","current_plan_allowed","is_secure","is_proactive_chat","live_chat_window","isFacebookIntegration","isBrandsDisabled","isBrowserSupported","not_queued_chat"]}[i].map(function(e){return l[e]}).reduce(function(e,t){return e&&t},!0),r={1:["ongoing_call_current_chat","incoming_call_notification","ongoing_media","isMediaActive","isInvitationPending"]}[i].map(function(e){return u[e]}).reduce(function(e,t){return e||t},!1);t(e,s?r?n.disable:n.show:n.hide)},t.prototype.onstarted=function(e){var t=this,i=this.container,n=i.commonImpl,a=(i.MediaPermission,i.detailsHandler),o=i.mediaUIHandler,s=i.dataHandler,r=i.constants,i=r.WAITING_TIME_SECS;if(this.iconClicked={},e.data.error&&(e.data.error.code==w.error_code.AUDIO_CALL_NOT_ALLOWED||w.error_code.invalid_chat_errors.includes(e.data.error.code)))return this.clearOngoingCallDataOnFailure(),a.hideAudioCall(),a.clearBusyUI(),e.data.error.code==w.error_code.AUDIO_CALL_NOT_ALLOWED&&s.set("isBrandsDisabled",!0),!0;if(e.data.error&&e.data.error.code==w.error_code.UNABLE_TO_INTIATE_CALL)return this.clearOngoingCallDataOnFailure(),void a.showAudioCall();var e=R(e.data.msg).media?R(R(e.data.msg).media):R(e.data.msg),c=e.chatid,d=e.chid,l=e.id,u=e.type,p=e.media_request,h=e.connection_type,d=(c||(c=c||d,e.chatid=c),n.setWmsPushData(l,e),s.set(l+"_waiting_timer",setTimeout(function(){var e={},e=(a.isOldUI()&&(e.is_old_ui=a.isOldUI()),{action:r.miss,success_cbk:null,failure_cbk:null,extraData:e});n.setApiData(l,e),n.makeApiCall(l),n.removeMediaCache(w.siq_unifiedMedia),t.clearData(l),t.container.detailsHandler.handleCallMissed({type:u,chid:c}),o.updateCallInvitationState(u,{chid:c,media_id:l},r.missed)},6e4)),{callType:r.outgoing,callStatus:r.ringing,mediarequest:p,host:r.upstream,isdirectcall:!1,isPerfectRenegotiation:!1,type:u,connection_type:h}),e=(n.setCallStatusData(l,d),n.setActiveCallData(c),{chid:c,type:u,media_id:l,status:w.outgoing}),s=(n.setMediaCache(w.siq_unifiedMedia,e),a.handleCallInitiate({type:u,chid:c}),{type:r.audiocall,duration:i,tone:r.outgoingcall,chatid:c,isEncrypted:!1}),p=(n.playMediaNotificationSound(s),n.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_OUTGOING_SOUND_START,add_info:a.getMediaActivityAddInfo()},mid:l}),{cancelCbk:function(){t.handleUICancel(l)},muteCbk:function(){return t.toggleMute()},chid:c,media_id:l});o.handleAudioCallInitiate(u,p),a.triggerIconCheck(c)},t.prototype.clearOngoingCallDataOnFailure=function(){var e=this.container,t=e.commonImpl,i=e.MediaPermission,e=e.detailsHandler;t.removeActiveTab(),t.removeActiveCallData(),i.closeAllStream(),e.stopNotifSound()},t.prototype.onstartedSecondary=function(e){var t=this,i=e.chid,n=e.negotiationType,a=e.id,e=this.container,o=e.mediaUIHandler,s=e.detailsHandler,r=e.commonImpl,c=e.constants,e=e.dataHandler,d={process_type:c.negotiation,negotiation_type:n},l=(s.isOldUI()&&(d.is_old_ui=s.isOldUI()),this.iconClicked[i]&&delete this.iconClicked[i],c.WAITING_TIME),e=(e.set(a+"_waiting_timer",setTimeout(function(){var e={action:c.miss,success_cbk:null,failure_cbk:null,extraData:d};r.setApiData(a,e),r.makeApiCall(a),o.updateCallInvitationState(c.audio,{chid:i,media_id:a},c.missed)},l)),{chid:i,media_id:a,cancelCbk:function(){var e={action:c.cancel,success_cbk:null,failure_cbk:null,extraData:d};o.updateCallInvitationState(c.audio,{chid:i,id:a},c.cancelled),r.setApiData(a,e),r.makeApiCall(a),r.clearMissedCallTimeout(a)},muteCbk:function(){return t.toggleMute()}});r.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_RENEGOTIATION_INITIATE},mid:a}),o.handleAudioCallInitiate(n,e),s.handleCallInitiate({chid:i,type:n})},t.prototype.startApiDirectCall=function(e){var t=this,i=(e.conversationType,e.successCbk),e=this.container,n=e.mediaUIHandler,a=e.MediaPermission,e=e.commonImpl,o=function(){clearTimeout(s)},s=setTimeout(function(){o=n.mediaPermissionUI()},3e3);return a.getAudioStream(function(){o(),t.directCallMediaPermissionSuccess(i)},function(){return t.directCallMediaPermissionFailure(function(){return o()})}),e.setActiveTab(),this.isDirectCallAllowed=!0},t.prototype.directCallMediaPermissionSuccess=function(e){var t=this;try{var i=this.container,n=i.detailsHandler,a={tone:i.constants.outgoingcall,duration:60};n.playNotifSound(a),this.isDirectCallAllowed=!0;e(function(){return t.toggleMute()})}catch(e){}},t.prototype.directCallMediaPermissionFailure=function(e){var t=this.container.mediaUIHandler;return e(),t.mediaPermissionUnlock(),t.directCallCancelled(),!1},t.prototype.handleUIApiReject=function(e){this.handleUIReject(e),this.container.detailsHandler.initMissedChat(chatid,"CALLENDED","2",!0)},t.prototype.handleUIApiCallEnd=function(e){var t=this.container,i=t.commonImpl,n=t.detailsHandler,t=t.constants,a=i.getWmsPushData(e).chatid,o={action:t.end,success_cbk:function(){return n.endSession(a)},failure_cbk:null,extraData:{}};i.setApiData(e,o),i.makeApiCall(e),this.handleCallEnd(e),i.removeMediaCache(t.siq_directcall)},t.prototype.onDirectCallStarted=function(e){var t=this,i=this.container,n=i.commonImpl,a=i.detailsHandler,o=i.mediaUIHandler,s=i.dataHandler,r=i.constants,c=e.type,d=e.id,l=e.chatid,i=e.media_request,u=e.connection_type,p=e.isCallQueued,e=(n.setWmsPushData(d,e),n.setCredential(d),p||s.set(d+"_waiting_timer",setTimeout(function(){n.removeMediaCache(r.siq_directcall),n.clearMissedCallTimeout(d),t.clearData(d),a.initMissedChat(l,"CALLENDED","2",!0),o.updateCallInvitationState(c,{chid:l,media_id:d},r.missed)},6e4)),{callType:r.outgoing,callStatus:p?r.queued:r.ringing,mediarequest:i,host:r.upstream,isdirectcall:!0,isPerfectRenegotiation:!1,connection_type:u,type:c}),h=(n.setCallStatusData(d,e),n.setActiveCallData(l),function(){a.initMissedChat(l,"CALLENDED","2",!0),o.updateCallInvitationState(r.audio,{chid:l,media_id:d},r.cancelled),n.removeMediaCache(r.siq_directcall),n.clearMissedCallTimeout(d),t.clearData(d)}),m=function(){return t.toggleMute()},s=(a.triggerIconCheck(l),setTimeout(function(){return o.handleAudioCallInitiate(c,{muteCbk:m,chid:l,cancelCbk:h,media_id:d,isDirectCall:!0})},500),clearTimeout(a.getChatWinObjById(l).waitTimer),{chid:l,type:c,media_id:d,status:w.outgoing});n.setMediaCache(r.siq_directcall,s)},t.prototype.startAudioCallAgain=function(e){var t=this.container,i=t.detailsHandler,n=t.audioImpl,t=t.constants;i.isRecordingON()||this.hasIncommingCall(e)||(e=i.getChatWinObjById(e),t={type:t.audio,chatid:e.chatID,mode:t.visitor,mediarequest:!0,mediainvitation:!0,wmsid:$Support.EmbedObj.vwmsid,lsuid:e.attender,lsid:$Support.getParent().$ZSIQWidget.getWidgetObject().lsid,session_id:i.getSessionID()},n.startAudioCall(t))},t}(x),F=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.screenshareIconStatus=function(e){var t=e.chid,i=e.callback,e=e.type,n=(void 0===e&&(e=1),this.container),a=n.detailsHandler,n=n.constants,o={not_group_chat:!a.isGroupConversation(t),not_bot:!a.isAttenderBot(t),ongoing_chat:a.isChatExist(),audiocall_enabled:a.isScreenShareAllowed(),current_plan_allowed:a.isPlanAllowed()},s={sharescreenAllowed:!a.isShareScreenAllowed(t)},a={1:["not_group_chat","not_bot","ongoing_chat","audiocall_enabled","current_plan_allowed"]}[e].map(function(e){return o[e]}).reduce(function(e,t){return e&&t},!0),e={1:["sharescreenAllowed"]}[e].map(function(e){return s[e]}).reduce(function(e,t){return e&&t},!0),a=a?e?n.disable:n.show:n.hide;P(i)&&i(t,a)},t.prototype.isScreenShareAllowed=function(e,t){var e=e.chatid,i=this.container,n=i.commonImpl,a=i.constants,o=i.detailsHandler,i=i.mediaUIHandler,s=!0,r="",c="";return!n.getMediaDataByChidAndType({chatid:e,type:a.screen_share})&&(o.isSecureConnection()?o.isShareScreenAllowed(e)||(s=!1,c="siqMedia: screen share Failed screen share not allowed | chid - "+e):(s=!1,r=o.I18N("av.info.insecuredwebsite"),c="siqMedia: screen share Failed Visitor not in secure connection | chid - "+e),!s&&r&&(i.showDialog({desc:r,buttons:{accept:{text:"common.ok",callback:function(){return null}}}}),callBackAction(implConstants.postDebugLog,c)),s)},t}(B),G=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t}(t),K=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.checkAndUpdateUIForApi=function(){},t.prototype.showDesktopNotif=function(){},t.prototype.startApiCall=function(e){},t.prototype.checkAndPlayNotification=function(){},t.prototype.getFailureMessage=function(e){var t=null;switch(e.name){case"NotFoundError":case"DevicesNotFoundError":t=LSResource.getRealValue("av.info.microphone.notavailable");break;default:t=LSResource.getRealValue("av.info.microphone.blocked")}return t},t.prototype.sendMediaStats=function(e,t){var i=e.msg,n=i?i.media:null,n=n&&n.id?n.id:e.id||i.id,i={};e.statcode&&(i.statcode=e.statcode),i.description=t,this.container.ajaxHandler.post("stats/"+n+"/media",i,null,null)},t}(z);function I(e,t){for(var i=[],n=arguments.length-2;0<n--;)i[n]=arguments[n+2];return{tag:e,props:t||{},children:i}}function m(e,t){if(void 0===t&&(t={}),-1!=["number","string","undefined"].indexOf(typeof e))return document.createTextNode(e);var i=document.createElement(e.tag);Q(i,e.props,t);for(var n=0;n<e.children.length;n++)i.appendChild(m(e.children[n],t));return i}function Q(e,t,i){if(!e.skipattr)for(var n in t){var a,o,s;"skipattr"==n?e.skipattr=!0:"on"==n.slice(0,2)?(s=o=a=void 0,a=e,s=t[o=n],o=o.slice(2).toLowerCase(),a._listeners&&a._listeners[o]||a.addEventListener(o,function(e){return this._listeners[e.type](e)},!1),(a._listeners||(a._listeners={}))[o]=s):"ref"===n.slice(0,3)?i.refs[t[n]]=e:"html"===n.slice(0,4)?e.innerHTML=t[n]:"video"!=e.tagName.toLowerCase()||e[n]?n&&void 0!==t[n]&&$(e).attr(n)!=t[n]&&e.setAttribute(n,t[n]):e[n]=t[n]}}function J(e,t,i,n){var a,o,s,r=e;if(e)if(a=e,(s=-1!=["string","number"].indexOf(typeof(o=t)))||3==a.nodeType?s&&3==a.nodeType&&a.textContent==o:a.tagName.toLowerCase()==o.tag.toLowerCase()){if("object"==typeof t&&1==e.nodeType){var c=Math.max(e.childNodes.length,t.children.length),d=Array.from(e.childNodes);Q(e,t.props||{},n);for(var l=0;l<c;l++)J(d[l],t.children[l]||"",e,n)}}else r=m(t,n),$(e).replaceWith(r);else t&&i.append(m(t,n));return r}function Z(e,o){var s=0,r=0,c=e,d=!1;function l(e){u(e);var t,i=getComputedStyle(c),n=parseInt(i.getPropertyValue("left"))||0,a=parseInt(i.getPropertyValue("top"))||0;return n<0||a<0?(n<0&&(c.style.left="0px"),a<0&&(c.style.top="0px"),d=!1,void(o?window.parent:window).removeEventListener("mousemove",l)):(t=parseInt(i.getPropertyValue("right"))||0,i=parseInt(i.getPropertyValue("bottom"))||0,t<0||i<0?(t<0&&(c.style.left=n+t+"px"),i<0&&(c.style.top=a+i+"px"),d=!1,void(o?window.parent:window).removeEventListener("mousemove",l)):(c.style.left=e.pageX-s+"px",void(c.style.top=e.pageY-r+"px")))}function u(e){e.stopPropagation(),e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1}e.addEventListener("mousedown",function(e){u(e),d=!0;var t=getComputedStyle(c),i=parseInt(t.getPropertyValue("left"))||0,t=parseInt(t.getPropertyValue("top"))||0;s=e.pageX-i,r=e.pageY-t,(o?window.parent:window).addEventListener("mousemove",l)}),e.addEventListener("mouseup",function(e){u(e),!0===d&&(d=!1,(o?window.parent:window).removeEventListener("mousemove",l))})}function r(){this.embed=SiqAVRouter.container.mediaUIHandler.isEmbed(),this.reRender()}r.prototype.updateState=function(e){e&&(this.state=e);try{this.reRender()}catch(e){}},r.prototype.reRender=function(){var e;this.dom&&1==this.dom.nodeType?this.dom=J(this.dom,this.render(),this.placeholder,this):(e=m(this.render(),this),this.dom&&$(this.dom).replaceWith(e),this.dom=e,this.embed?e&&e.className&&e.className.includes("zsiq_media_videomain")?e&&V(e,this.frameout):this.disableDrag||Z(e,this.frameout):this.disableDrag||1!=e.nodeType||$(e).draggable({containment:"window",scroll:!1})),this.dom&&!this.dom.parentNode&&(this.placeholder_prepend?$(this.placeholder).prepend(this.dom):$(this.placeholder).append(this.dom))},r.prototype.destroy=function(){$(this.dom).remove()};var X=function(a){function e(e,t,i,n){void 0===n&&(n=!1),this.state=e,this.placeholder=t,this.refs={},this.container=i,this.constants=i.constants,this.frameout=!0,this.screenShareAllowed=i.mediaUIHandler.isScreenShareAllowed(),this.isInviteOnly=n,this.isDummyImage=!0,a.call(this)}return a&&(e.__proto__=a),((e.prototype=Object.create(a&&a.prototype)).constructor=e).prototype.destroy=function(){this.ssTimer&&clearInterval(this.ssTimer),this.audioTimer&&clearInterval(this.audioTimer),$(this.dom).remove()},e.prototype.canStartSS=function(){return!this.state.screen_share},e.prototype.__callCbk=function(){Y(this.container,this.state.chid,this.embed)},e.prototype.getUI=function(){var e=this.state,t=e.audio,e=e.screen_share;return e&&this.isSharing(e.type)&&!this.isInviteOnly?this.getScreenShareUI():!t||e&&this.isViewing(e.type)&&(!this.isViewing(e.type)||[this.constants.connected,this.constants.ended].includes(t.status))?"":this.getAudioCallUI()},e.prototype.getAudioCallBtns=function(){var e=this,t=this.state,i=t.handler,n=(t.name,t.url,t.screen_share),a=t.audio,o=t.chid,t=a.mute,s=a.status,a=a.media_id,r=this.container.mediaUIHandler,c=this.isInvited(s),d=this.isConnected(s),l=this.isRequested(s),u=this.isConnecting(s),p=[this.constants.rejected,this.constants.cancelled,this.constants.missed].includes(s),h=r.isScreenShareAllowed(),m=n&&this.isConnected(n.status),_=n&&(this.isConnected(n.status)?this.constants.stopsharing:this.constants.cancel),g=d?this.constants.end:this.constants.cancel,a=!r.isCallInitiatedFromOldUI(a)&&!r.isMobileOperator(a),f=!r.isMobileVisitor(o),r=r.isSecure();return s!=this.constants.ended?I("div",{class:"siq_media_btns siq_media_flexM"},h&&!n&&d&&a&&f&&r?I("div",{class:"zsiqmico-screenshare zsiq_media_gbtn",title:y("screenshare"),onclick:function(){return e.container.uiHandler.shareScreen(o)}}):"",n&&this.isSharing(n.type)&&!c&&!this.isInviteOnly?I("div",{class:"zsiqmico-endscreenshare zsiq_media_rbtn",title:y(_),onclick:function(){return i(o,"screen_share","reject")}}):"",d||l||u?I("div",{class:(t?"zsiqmico-unmute":"zsiqmico-mute")+" zsiq_media_wbtn "+(h||m?"zsiq_media_mL13":""),title:y(t?"unmute":"mute"),onClick:function(){return i(o,"audio","mute")}}):"",c?I("div",{class:"zsiqmico-pickcall zsiq_media_gbtn "+(n?"zsiq_media_mL13":""),title:y("accept"),onclick:function(){return i(o,"audio","accept")}}):"",p?"":I("div",{class:"zsiqmico-endcall zsiq_media_rbtn "+(d||l||c||u||m?"zsiq_media_mL13":""),title:y(g),onclick:function(){return i(o,"audio","reject")}})):""},e.prototype.getScreenShareBtns=function(){var e,t,i=this.state,n=i.handler,a=i.screen_share,o=i.audio,s=i.chid,i=a.status,r=(o&&(e=o.mute,t=o.status),this.isConnected(t)),c=this.isConnecting(t),d=this.isEnded(t),i=this.isConnected(i),l=a&&(this.isConnected(a.status)?this.constants.stopsharing:this.constants.cancel),u=o&&(r?this.constants.end:this.constants.cancel),p=this.container.mediaUIHandler.isAudioCallEnabled();return o&&o.status==this.constants.ended?"":I("div",{class:"siq_media_btns siq_media_flexM"},a&&this.isSharing(a.type)&&!this.isRequested(t)&&!this.isInvited(t)?I("div",{class:"zsiqmico-endscreenshare zsiq_media_rbtn",title:y(l),onclick:function(){return n(s,"screen_share","reject")}}):"",a&&(this.isRequested(t)||this.isInvited(t))?I("div",{title:y(l),class:"zsiqmico-endscreenshare zsiq_media_rbtn zsiq_media_disable"}):"",o&&(r||c)?I("div",{class:(e?"zsiqmico-unmute":"zsiqmico-mute")+" zsiq_media_wbtn "+(r||c?"zsiq_media_mL13":""),title:y(e?"unmute":"mute"),onClick:function(){return n(s,"audio","mute")}}):"",r?I("div",{class:"zsiqmico-endcall zsiq_media_rbtn "+(r||isRequested||isInvited||c||d&&i?"zsiq_media_mL13":""),title:y(u),onclick:function(){return n(s,"audio","reject")}}):"",i&&!o&&p?I("div",{class:"zsiqmico-pickcall zsiq_media_gbtn "+(a?"zsiq_media_mL13":""),title:y("call"),onclick:this.__callCbk.bind(this)}):"")},e.prototype.getAudioCallUI=function(){var e=this.state,t=(e.handler,e.name),i=e.url,n=(e.screen_share,e.audio),a=e.chid,o=e.timer,e=e.consent,s=(n.mute,n.status),r=n.media_id,c=this.isInvited(s),d=this.isRequested(s),i=i&&i(r)?I("img",{src:i(r,a),alt:t?t(a):"Operator",draggable:"false"}):I("em",{class:"sqico-person"}),l=t(a),l=l&&l[0].toLowerCase(),r=this.container.commonImpl.isSmartFlow(r);return I("div",{class:"zsiq_media_headshot_main"},I("div",{class:"zsiq_media_headshot"},I("div",{class:"zsiq_media_cirview"},c||d?I("div",{class:"zsiq-media-anim"}):"",I("div",{class:this.isDummyImage?"zsiq_media_userimg":"zsiq_media_imgdummy-"+l},i),I("div",{class:"zsiq_media_detail"},I("div",{class:"zsiq_media_elips zsiq_media_name"},t(a)),I("div",{class:"zsiq_media_info zsiq_media_elips"},o&&r&&n&&this.isConnected(s)?I("em",{title:y("recording"),class:"zsiqmico-record",style:"cursor: pointer;"}):"",se(this.state,this.__getAudioCallStatusPriorityInSS())),I("div",{class:"zsiq_media_dept zsiq_media_flexC",style:"display:none;"},I("span",{class:"zsiqmico-dept"}),I("span",{class:"zsiq_media_elips"})),this.getAudioCallBtns()))),e&&e.show?this.getConsentUI():"")},e.prototype.getConsentUI=function(){var e=this.state,t=e.handler,i=e.chid,e=e.consent;return I("div",{class:"const-div"},I("div",{class:"const-title"},e.title),I("p",{class:"const-desc"},e.desc),I("div",{class:"zsiq_center zsiq_popup_btn  const-btn"},I("span",{class:"zsiq_center",onclick:function(){return t(i,"consent","accept")}},e.type==this.constants.screen?LSResource.getRealValue("common.share"):LSResource.getRealValue("common.gdpr.agent.accept")),I("span",{class:"zsiq_center zsiq_cancelbtn",onclick:function(){return t(i,"consent","reject")}},LSResource.getRealValue("common.decline"))))},e.prototype.getScreenShareUI=function(){var e=this.state,t=e.timer,i=e.name,n=e.url,a=e.screen_share,o=(e.audio,e.chid),e=e.consent,s=i(o),s=s&&s[0].toLowerCase(),n=n&&n(a.media_id)?I("img",{src:n(a.media_id,o),alt:i?i(o):"Operator",draggable:"false"}):I("em",{class:"sqico-person"}),a=this.container.mediaUIHandler.isScreenRecordAllowed()&&this.container.mediaUIHandler.isScreenRecordingEnabled()&&this.container.commonImpl.isSmartFlow(a.media_id);return I("div",{class:"zsiq_media_headshot_main"},I("div",{class:"zsiq_media_headshot"},I("div",{class:"zsiq_media_cirview"},I("div",{class:this.isDummyImage?"zsiq_media_userimg":"zsiq_media_imgdummy-"+s},n),I("div",{class:"zsiq_media_detail"},I("div",{class:"zsiq_media_elips zsiq_media_name"},t&&a?I("em",{title:y("recording"),class:"zsiqmico-record zsiq_media_mR10",style:"cursor: pointer;"}):"",i(o)),I("div",{class:"zsiq_media_info zsiq_media_elips"},re(this.state,!1)),I("div",{class:"zsiq_media_dept zsiq_media_flexC",style:"display:none;"},I("span",{class:"zsiqmico-dept"}),I("span",{class:"zsiq_media_elips"})),this.getScreenShareBtns()))),e&&e.show&&e.type==this.constants.screen?this.getConsentUI():"")},e.prototype.inviteCheck=function(){var e=this.state,t=e.screen_share,e=e.audio;return!this.isInviteOnly||t&&e&&this.isSharing(t.type)&&!this.isConnected(e.status)&&!this.isEnded(e.status)},e.prototype.render=function(){return!this.inviteCheck()||this.state.isDirectCall||document.querySelector("#call_Busy")?"":this.getUI()},e.prototype.__getAudioCallStatusPriorityInSS=function(){var e=this.state,t=e.screen_share,i=e.audio,e=e.timer,i=i.status;return!(e&&!t&&this.__isStatusNotConnected(i))&&!!(e&&!t||e&&!this.__isStatusNotConnected(i))},e.prototype.__isStatusNotConnected=function(e){return e!=this.constants.connected},e.prototype.isConnected=function(e){return e&&e==this.constants.connected},e.prototype.isConnecting=function(e){return e&&e==this.constants.connecting},e.prototype.isEnded=function(e){return e&&e==this.constants.ended},e.prototype.isInvited=function(e){return e&&e==this.constants.invited},e.prototype.isRequested=function(e){return e&&e==this.constants.requested},e.prototype.isSharing=function(e){return e&&e==this.constants.sharing},e.prototype.isViewing=function(e){return e&&e==this.constants.viewing},e.prototype.isReconnecting=function(e){return e&&e==this.constants.reconnecting},e.prototype.isRejected=function(e){return e&&e==this.constants.rejected},e.prototype.isMissed=function(e){return e&&e==this.constants.missed},e}(r);function Y(e,t,i){void 0===i&&(i=!0);var n={type:e.constants.audio,mode:e.constants.visitor,mediarequest:!0,mediainvitation:!0},a=e.mediaUIHandler.getChatWinObjById(t);i?$.extend(n,{chatid:a.chatID,wmsid:$Support.EmbedObj.vwmsid,lsuid:a.attender,lsid:$Support.getParent().$ZSIQWidget.getWidgetObject().lsid,normalchid:t,session_id:e.detailsHandler.getSessionID()}):$.extend(n,{chatid:t}),e.mediaUIHandler.startAudioCall(n)}var ee=function(n){function e(e,t,i){this.state=e,this.placeholder=t,this.refs={},this.container=i,this.constants=i.constants,this.showSSList=!1,this.showMoreOptions=!1,this.showSettings=!1,this.placeholder_prepend=!0,this.moreOptionsUIPosition={right:"0"},this.isChatwindowOpened=!1,this.init(),n.call(this)}return n&&(e.__proto__=n),((e.prototype=Object.create(n&&n.prototype)).constructor=e).prototype.init=function(){this.fullscreen=!1,this.showcntrl=!1,this.frameout=!0,this.switchCbk=this.switchFullscreen.bind(this)},e.prototype.switchFullscreen=function(e){"keyup"==e.type&&"Escape"!=e.key||(this.fullscreen=!this.fullscreen,this.isChatwindowOpened=!this.isChatwindowOpened,this.container.mediaUIHandler.closeChatWindow(this.state.chid),this.fullscreen?$Support.getParent().document.addEventListener(this.constants.keyup,this.switchCbk):$Support.getParent().document.removeEventListener(this.constants.keyup,this.switchCbk),this.reRender())},e.prototype.getAudioCallBox=function(){var e=this.state,t=e.audio,i=e.handler,n=e.chid,a=e.name,e=e.url,o=this.embed?"siqico":"sqico",s=t&&(this.isConnected(t.status)?this.constants.end:this.constants.cancel);return I("div",{class:"zsiq_calldtl"},I("span",null,e&&e(t.media_id)?I("img",{src:e(t.media_id,n),alt:a?a(n):"Operator",class:"siquserimg"}):I("em",{class:o+"-user"}),I("em",{class:"zsiq_caller txtelips"},a(n))),I("span",null,se(this.state),t&&this.isConnected(t.status)?I("em",{title:y(t.mute?"unmute":"mute"),class:o+"-"+(t.mute?"unmute":"mute")+" zsiq_ctrlico",onClick:function(){return i(n,"audio","mute")},"data-type":"mic"}):"",t&&this.isInvited(t.status)?I("em",{title:y("accept"),class:o+"-end zsiq_vend zsiq_ctrlico zsiq_callin",onclick:function(){return i(n,"audio","accept")}}):"",I("em",{title:y(s),class:o+"-end zsiq_vend zsiq_ctrlico",onclick:function(){return i(n,"audio","reject")}}),I("em",null)))},e.prototype.showCntrl=function(){var e=this;this.showcntrl=!0,clearTimeout(this.showCntrlTimer),this.showCntrlTimer=setTimeout(function(){e.showcntrl=!1,e.reRender()},1500),this.__swapHandlerClickCbk(),this.reRender()},e.prototype.__swapHandlerClickCbk=function(){this.swapOptions&&($(this.swapOptions).remove(),this.swapOptions=null)},e.prototype.__swapHandler=function(e,n,t){function i(e,t,i){n(e,t,i),o()}var a=this,o=function(){return a.__swapHandlerClickCbk.call(a)};if(this.swapOptions)return o();this.swapOptions=m(I("div",{class:"zsiqcalloptions",id:"calloptions",style:"left:"+(e.clientX-220)+";top:"+(e.clientY-65)+";height:65px;z-index:11111111111;",onMouseLeave:this.__swapHandlerClickCbk.bind(this)},I("div",{onClick:function(){return i(t,"screen_share","swap")}},LSResource.getRealValue("screenshare.sharemyscreen")),I("div",{onClick:function(){return i(t,"screen_share","reject")}},LSResource.getRealValue("screenshare.endscreen")))),this.placeholder.append(this.swapOptions)},e.prototype._SwapList=function(e,t,i){this.embed&&this.state.audio&&!this.fullscreen?this.__swapHandler(e,t,i):t(i,"screen_share","swap")},e.prototype.__showMoreOptions=function(){var e,t=this;this.showMoreOptions||(e=function(){t.showMoreOptions=!1,t.updateState(),parent.document.removeEventListener(t.constants.click,e)},this.showMoreOptions=!0,setTimeout(function(){return parent.document.addEventListener(t.constants.click,e)}),this.updateState())},e.prototype.__showSettings=function(){var e,t=this;this.showSettings||(e=function(){t.showSettings=!1,t.updateState(),parent.document.removeEventListener(t.constants.click,e)},this.showSettings=!0,setTimeout(function(){return parent.document.addEventListener(t.constants.click,e)}),this.updateState())},e.prototype.__showDropDownList=function(){var e,t=this;this.getCallBarUIPosition(),this.showSSList||(e=function(){t.showSSList=!1,t.updateState(),parent.document.removeEventListener(t.constants.click,e)},this.showSSList=!0,setTimeout(function(){return parent.document.addEventListener(t.constants.click,e)}),this.updateState())},e.prototype.getCallBarUIPosition=function(){var e=this.container.uiHandler.getUIPosition(".zsiq_media_videomain");e.width<570&&e.left<100?this.moreOptionsUIPosition.right="auto":this.moreOptionsUIPosition.right="0"},e.prototype.__callCbk=function(){Y(this.container,this.state.chid,this.embed)},e.prototype.handleChatWindow=function(e){this.isChatwindowOpened=!this.isChatwindowOpened,this.container.mediaUIHandler.openChatWindow(e)},e.prototype.getScreenShareButtons=function(){var e,t,i=this,n=this.state,a=n.screen_share,o=n.audio,s=n.handler,r=n.chid,n=n.chatWinFocused,c=(o&&(e=o.mute,t=o.status),this.isConnected(t)),d=a.status,l=a.type,d=this.isConnected(d),u=a&&(d?this.constants.stopsharing:this.constants.cancel),p=o&&(c?this.constants.end:this.constants.cancel),h=this.container.mediaUIHandler.isAudioCallEnabled(),m=o&&[this.constants.invited,this.constants.requested,this.constants.connecting,this.constants.cancelled,this.constants.rejected,this.constants.missed].includes(t),_=this.container.mediaUIHandler.isScreenShareAllowed(),g=this.container.mediaUIHandler.isSSChatEnabled();return I("div",{class:"zsiq_media_videofoot"},o||_?I("div",{class:"zsiq_media_posrel"},d&&!m?I("div",{class:"zsiqmico-more zsiq_media_wbtn",title:y("options"),onMouseUp:this.__showDropDownList.bind(this)}):"",I("div",{class:"zsiq_media_options",style:(this.showSSList?"display:block;":"display:none;")+" right : "+this.moreOptionsUIPosition.right+";"},_?I("div",{class:"zsiq_media_option_li",onclick:function(){return s(r,"screen_share","swap")}},LSResource.getRealValue("screenshare.sharemyscreen")):"",o&&a&&this.isViewing(l)?I("div",{class:"zsiq_media_option_li zsiq_media_red",onclick:function(){return s(r,"screen_share","reject")}},LSResource.getRealValue("screenshare.endscreen")):"")):"",d&&m?I("div",{class:"zsiqmico-more zsiq_media_wbtn zsiq_media_disable"}):"",this.embed&&o&&(c||this.isConnecting(t)||this.isRequested(t))&&!m?I("div",{class:(e?"zsiqmico-unmute":"zsiqmico-mute")+" zsiq_media_wbtn zsiq_media_mL13",title:y(e?"unmute":"mute"),onClick:function(){return s(r,"audio","mute")}}):"",(this.embed||this.fullscreen||!n)&&!o&&d&&h?I("span",{title:y("call"),class:"zsiqmico-pickcall zsiq_media_gbtn zsiq_media_mL13",onclick:this.__callCbk.bind(this)}):"",this.fullscreen&&g&&!this.isChatwindowOpened?I("span",{title:y("openchat"),class:"zsiqmico-chat zsiq_media_wbtn zsiq_media_mL13",onclick:function(){return i.handleChatWindow(r)}}):"",this.embed&&o&&m?I("span",{class:"zsiqmico-pickcall zsiq_media_gbtn zsiq_media_mL13 zsiq_media_disable"}):"",this.embed&&o&&c?I("span",{title:y(p),class:"zsiqmico-endcall zsiq_media_rbtn zsiq_media_mL13",onclick:function(){return s(r,"audio","reject")}}):"",this.embed&&!o&&a&&this.isViewing(l)?I("div",{class:"zsiqmico-endscreenshare zsiq_media_rbtn zsiq_media_mL13",title:y(u),onclick:function(){return s(r,"screen_share","reject")}}):"")},e.prototype.getUI=function(){var e=this,t=this.state,i=t.screen_share,n=t.timer,t=(t.chid,i?i.stream:""),a=this.container.mediaUIHandler.isScreenRecordAllowed()&&this.container.mediaUIHandler.isScreenRecordingEnabled()&&this.container.commonImpl.isSmartFlow(i.media_id);return t?I("div",{class:"zsiq_media_videomain "+(this.isChatwindowOpened?"zsiqmedia_chatview":"")+" "+(this.fullscreen?"zsiq-media-maxscreen":"zsiq-media-minscreen")+" "+(this.showcntrl||!n?"zsiq_showcntl":"")+" ",onMouseMove:this.showCntrl.bind(this),onMouseOver:this.showCntrl.bind(this),onMouseDown:this.__swapHandlerClickCbk.bind(this)},this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_top_left_corner",position:"top_left_corner"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_top_border",position:"top_border"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_top_right_corner",position:"top_right_corner"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_right_border",position:"right_border"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_bottom_right_corner",position:"bottom_right_corner"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_bottom_border",position:"bottom_border"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_bottom_left_corner",position:"bottom_left_corner"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_left_border",position:"left_border"}),I("div",{class:"zsiq_media_videohdr"},I("div",{class:"zsiq_media_videotime"},n&&a?I("em",{title:y("recording"),class:"zsiqmico-record zsiq_media_mR10",style:"cursor: pointer;"}):"",re(this.state)),I("div",{class:"zsiq_media_videohdrico"},I("span",{class:"zsiqmico-settings",style:"display:none;"}),I("span",{class:this.fullscreen?"zsiqmico-minscreen":"zsiqmico-maxscreen",onclick:this.switchFullscreen.bind(this)}))),this.getScreenShareButtons(),I("div",null,I("video",{autoplay:!0,name:"media",srcObject:t,class:this.isReconnecting(i.status)?"zsiq_media_blur":"",onloadedmetadata:function(){return e.metadata=!0}})),"reconnecting"!=i.status&&this.metadata?"":I("div",{class:"zsiq_media_vloader"})):""},e.prototype.render=function(){var e=this.state,t=e.screen_share,e=e.audio;return t&&this.isViewing(t.type)&&!this.isRequested(t.status)||e&&this.isConnected(e.status)?this.getUI():""},e.prototype.isConnected=function(e){return e&&e==this.constants.connected},e.prototype.isConnecting=function(e){return e&&e==this.constants.connecting},e.prototype.isEnded=function(e){return e&&e==this.constants.ended},e.prototype.isInvited=function(e){return e&&e==this.constants.invited},e.prototype.isRequested=function(e){return e&&e==this.constants.requested},e.prototype.isSharing=function(e){return e&&e==this.constants.sharing},e.prototype.isViewing=function(e){return e&&e==this.constants.viewing},e.prototype.isReconnecting=function(e){return e&&e==this.constants.reconnecting},e.prototype.isRejected=function(e){return e&&e==this.constants.rejected},e.prototype.isMissed=function(e){return e&&e==this.constants.missed},e}(r);function te(){var e=getBrowserFromUserAgent(navigator.userAgent).split("-")[0],t={Chrome:"https://support.google.com/chrome/answer/2693767?hl=en",Firefox:"https://support.mozilla.org/en-US/questions/1168156",Opera:"https://help.opera.com/en/latest/web-preferences/#microphone",Safari:"https://support.apple.com/en-in/guide/safari/websites-ibrwe2159f50/mac"};t[e]&&window.open(t[e],"_blank")}function ie(i,n,a,o,s,r,c){function d(){$(t).remove()}function e(){var e=$(parent.document.body).find(".siq_media"),t=(window.currentRecorder&&window.currentRecorder.destroy(),Recorder());i.uiHandler.setCallUIposition("#user_busy"),s||(d(),e.append($Temp.getAudioRecordedUI(a(0,n),i.mediaUIHandler.getEscapedText(o(n)),r().top,r().left)),i.mediaUIHandler.removeCallUIPosition()),(window.currentRecorder=t).init(s,n,c)}var t,l=o(n);l&&l[0].toLowerCase();t=s?m(I("div",{class:"cal-wrap",id:"audiorec"},I("div",{class:"posrel dib-mid"},I("div",{class:"cal-widgt theme1 outcal"},I("div",{class:"posrel usr-imginfo"},I("div",{class:"cal-visimg "+((l=$Support.EmbedObj.clogo)?"":"sqico-user")},l?I("img",{src:l,alt:o?o(n):"Operator",draggable:"false"}):"")),I("div",{class:"cal-vstrdetl"},I("nav",{class:"cal-actvevstr elips font18"},LSResource.getRealValue("av.info.oprbusy")),I("p",{class:"cal-usrdesc elips"},LSResource.getRealValue("av.info.voicemsg"))),I("div",{class:"cal-optns posrel textR"},I("span",{onclick:e,class:"sqico-record bg-aaa"})))))):m(I("div",{class:"zsiq_media_headshot_main",id:"user_busy",style:"top:"+r().top+"px; left:"+r().left+"px;"},I("div",{class:"zsiq_media_headshot"},I("div",{class:"zsiq_media_cirview"},I("span",{class:"zsiqmico-close",onclick:d,onMouseUp:function(){i.mediaUIHandler.removeCallUIPosition()}}),I("div",{class:"zsiq_media_userimg"},I("img",{src:a&&a(0,n),alt:o?o(n):"Operator",draggable:"false"})),I("div",{class:"zsiq_media_detail"},I("div",{class:"zsiq_media_elips zsiq_media_name"},o(n)),I("div",{class:"zsiq_media_elips"},LSResource.getRealValue("av.info.userbusy")),I("div",{class:"siq_media_btns siq_media_flexM"},I("div",{class:"zsiqmico-record zsiq_media_wbtn",title:LSResource.getRealValue("av.info.voicemessage"),onclick:e}),I("div",{class:"zsiqmico-pickcall zsiq_media_gbtn zsiq_media_mL13",title:LSResource.getRealValue("av.info.callagain"),onclick:function(){i.mediaUIHandler.isRecordingON()||(d(),Y(i,n))}}))))))),s?(CallImpl.isCallWithChat=!0,$("body").prepend(t)):(Z(t,!0),$(parent.document.body).find(".siq_media").append(t))}var ne=function(n){function e(e,t,i){this.state=e,this.placeholder=t,this.refs={},this.container=i,this.constants=this.container.constants,this.disableDrag=!0,this.placeholder_prepend=!0,n.call(this)}return n&&(e.__proto__=n),((e.prototype=Object.create(n&&n.prototype)).constructor=e).prototype.getAudioCallStatusText=function(){var e=this.state.audio.status,t=this.state.timer;return{timer:t,connected:LSResource.getRealValue("common.connected"),invited:LSResource.getRealValue("av.info.calling"),connecting:LSResource.getRealValue("av.info.connecting"),ended:LSResource.getRealValue("common.ended"),cancelled:LSResource.getRealValue("av.info.cancelled"),rejected:LSResource.getRealValue("common.declined"),requested:LSResource.getRealValue("audiovideo.ringing"),missed:LSResource.getRealValue("common.missed"),reconnecting:LSResource.getRealValue("common.reconnecting"),initiated:LSResource.getRealValue("audiovideo.ringing"),mediapermission:LSResource.getRealValue("av.info.waitingformediapermission")}[t?"timer":e]||""},e.prototype.getUI=function(){var e=this,t=this.state,i=t.url,n=t.handler,a=t.name,o=t.chid,s=t.audio,t=t.screen_share,r=s&&s.status,i=(t&&t.status,-1==["initiated","requested"].indexOf(r)&&i&&i(s.media_id,o)||$Support.EmbedObj.clogo),c="initiated"==r,d="mediapermission"==r,l=this.container.mediaUIHandler.isScreenShareAllowed(),u=this.container.mediaUIHandler.isCallInitiatedFromOldUI(s.media_id),p=t&&t.type==this.constants.viewing;return $Support.getParent().$zoho.salesiq.floatwindow.visible("show"),p&&($Support.getParent().$zoho.salesiq.floatwindow.visible("hide"),$Support.getParent().$zoho.salesiq.floatbutton.visible("hide")),I("div",{class:"cal-wrap",id:"audiocal"},I("div",{class:"posrel dib-mid"},I("div",{class:"cal-widgt theme1 outcal"},I("div",{class:"posrel usr-imginfo"},I("div",{class:"cal-visimg "},I("img",{src:i,alt:a?a(o):"Operator"}))),I("div",{class:"cal-vstrdetl "+(l?"cal-mw180":"")},I("nav",{class:"cal-actvevstr elips font18"},a&&a(o)||""),I("p",{class:"cal-usrdesc elips"},this.getAudioCallStatusText())),I("div",{class:"cal-optns posrel textR"},!u&&s&&r==this.constants.connected&&l&&!t?I("span",{class:"sqico-screenshare bg-grn",title:y("screenshare"),onclick:function(){return e.container.uiHandler.shareScreen(o)}}):"",!u&&t&&t.type==this.constants.sharing?I("span",{class:"sqico-ssend bg-red",title:y("stopsharing"),onclick:function(){return n(o,"screen_share","reject")}}):"",I("span",{title:s&&y(s.mute?"unmute":"mute"),id:"audiocall_mute",class:"sqico-"+(s.mute?"muteaudio":"microphone")+" bg-aaa "+(d?"cmn_disable":"")+" "+(l?"mL20":""),onclick:function(){return d?"":n(o,"audio","mute")}}),I("span",{title:s&&y(r==this.constants.connected?"end":"cancel"),class:"sqico-call cal-rjct "+(c||d?"cmn_disable":""),id:"audiocall_outgoingend",onclick:function(){return c||d?"":n(o,"audio","reject")}})))))},e.prototype.render=function(){var e=this.state,t=e.isDirectCall,i=e.audio;e.status;return t&&i?this.getUI():""},e}(r);function y(e){var t={mute:LSResource.getRealValue("av.info.mute"),unmute:LSResource.getRealValue("av.info.unmute"),end:LSResource.getRealValue("common.end"),reject:LSResource.getRealValue("common.reject"),screenshare:LSResource.getRealValue("common.screenshare"),swap:LSResource.getRealValue("av.info.swap"),call:LSResource.getRealValue("av.info.call"),cancel:LSResource.getRealValue("common.cancel"),accept:LSResource.getRealValue("common.accept"),stopsharing:LSResource.getRealValue("av.info.endscreen"),options:LSResource.getRealValue("av.info.options"),recording:LSResource.getRealValue("av.info.recording"),openchat:LSResource.getRealValue("av.info.openchat")};return t[e]||""}function ae(e,t){return"theme4"==oe()?I("div",{class:"thme-bgimg",style:"background-image:url("+("Comp"==e?$Support.EmbedObj.clogo:_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/userimg/"+t.attenderimagefkey+"/photo.ls?nps=404")+")"}):""}function oe(){return window.parent.$ZSIQWidget.getWidgetObject().calltheme||"theme1"}function se(e,t){void 0===t&&(t=!0);var i=e.audio.status,e=e.timer;return t="reconnecting"!=i&&t,{timer:I("span",{class:"call-time-embed"},e),connected:LSResource.getRealValue("common.connected"),invited:LSResource.getRealValue("av.info.calling"),connecting:LSResource.getRealValue("av.info.connecting"),ended:LSResource.getRealValue("common.ended"),cancelled:LSResource.getRealValue("av.info.cancelled"),rejected:LSResource.getRealValue("common.declined"),requested:LSResource.getRealValue("audiovideo.ringing"),missed:LSResource.getRealValue("common.missed"),reconnecting:LSResource.getRealValue("common.reconnecting"),failed:LSResource.getRealValue("av.info.failed")}[e&&t?"timer":i]||""}function re(e,t){void 0===t&&(t=!0);var i=e.screen_share.status,e=e.timer;return t="reconnecting"!=i&&t,{timer:I("span",{class:"call-time-embed"},e),connected:LSResource.getRealValue(t?"common.connected":"ss.info.viewing"),invited:LSResource.getRealValue("av.info.calling"),connecting:LSResource.getRealValue("av.info.connecting"),ended:LSResource.getRealValue("common.ended"),cancelled:LSResource.getRealValue("av.info.cancelled"),rejected:LSResource.getRealValue("common.declined"),requested:LSResource.getRealValue("audiovideo.ringing"),missed:LSResource.getRealValue("common.missed"),reconnecting:LSResource.getRealValue("common.reconnecting"),failed:LSResource.getRealValue("screenshare.info.failed")}[e&&t?"timer":i]||""}function l(e){return SiqAVRouter.container.mediaUIHandler.getChatWinObjById(e)}function u(e,t){void 0===e&&(e=0);var i=SiqAVRouter.container.mediaUIHandler,t=l(t).attenderimagefkey,e=_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/userimg/"+t+"/photo.ls?mid="+e,i=i.canShowOperatorImage();return JSON.parse(i)&&t?e:$Support.EmbedObj.clogo}function _(e){return SiqAVRouter.container.mediaUIHandler.getDecodedText(p[e])||""}function ce(){return SiqAVRouter.container.mediaUIHandler.getCallUIPosition()}function c(e){var t=this;this.container=e,this.invitations=null,this.ss_invitation={},this.states={},window.onbeforeunload=function(){if(e.commonImpl.updateMediaCache(w.siq_directcall,w.is_refreshed,!0),e.commonImpl.updateMediaCache(w.siq_unifiedMedia,w.is_refreshed,!0),Object.keys(t.states).length)return""},this.siqdom=document.createElement("div"),this.siqdom.setAttribute("class","siq_media"),this.siqdom.setAttribute("data-id","zsalesiq"),this.container.mediaUIHandler.getBody()[0].appendChild(this.siqdom)}var p={};function g(){return SiqAVRouter.container.mediaUIHandler.isEmbed()?$(parent.document.body):$("body")}c.prototype.initiateHeadshot=function(e,t){this.states[e]||(this.states[e]={chid:e,isDirectCall:t},this.states[e].headshot=new X(this.states[e],t?$("body"):this.siqdom,this.container),this.states[e].headshotInvite=new X(this.states[e],t?$("body"):this.siqdom,this.container,!0),this.states[e].directCallUI=new ne(this.states[e],$("body"),this.container))},c.prototype.__getType=function(e){var t=this.container.constants;return-1!=[t.audio_unified_mix,t.audio_smart].indexOf(e)?t.audio:-1!=[t.screen_share_smart,t.screen_view_smart,t.screen_view].indexOf(e)?t.screen_share:e},c.prototype.updateCallInvitationState=function(e,t,i){e=this.__getType(e);var n={audio:{connecting:this.makeAudioCallConnecting,connected:this.makeAudioCallConnected,ended:this.makeAudioCallEnded,cancelled:this.makeAudioCallCancelled,rejected:this.makeAudioCallRejected,missed:this.makeAudioCallMissed,reconnecting:this.makeAudioReconnecting,failed:this.makeAudioCallFailed,showConsent:this.showAudioConsent},screen_share:{connecting:this.makeScreenShareConnecting,connected:this.makeScreenShareConnected,ended:this.makeScreenShareEnded,cancelled:this.makeScreenShareCancelled,rejected:this.makeScreenShareRejected,missed:this.makeScreenShareMissed,reconnecting:this.makeScreenShareReconnecting,failed:this.MakeScreenShareFailed,showConsent:this.showScreenConsent}},n=n[e]&&n[e][i];try{n&&n.call(this,e,t)}catch(e){}},c.prototype.playScreenShareStream=function(e){var t=e.stream,i=e.mid,e=(e.endCbk,e.chid),n=this.container.mediaUIHandler,e=(this.initiateHeadshot(e),this.states[e]);e.screen_share=e.screen_share||{},$.extend(!0,e,{screen_share:{stream:t,type:"viewing",status:"connected",media_id:i}});try{e.player||(e.player=new ee(e,this.siqdom,this.container),n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_SHOWN,add_info:n.getMediaActivityAddInfo()},mid:i}))}catch(e){}},c.prototype.handleAudioCallInvite=function(e,t){var i=this.container.mediaUIHandler,i=(p[t.chid]=l(t.chid)&&l(t.chid).attendername,"audio"==(e=this.__getType(e))?(this.showAudioCallInvitation(t),this.invitations=!0,i.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_INVITATION_SHOWN,add_info:i.getMediaActivityAddInfo()},mid:t.media_id||t.id})):"screen_share"==e&&this.showScreenShareInvitation(t),parent.document.querySelector(".zsiqmico-close"));i&&i.click()},c.prototype.clearAudioCallInvite=function(e,t,i){var n=this.container.mediaUIHandler;try{n.isEmbed()&&n.clearConformBox()&&n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:n.getMediaActivityAddInfo()},mid:t}),"audio"==e&&i&&this.__callTerminate(e,{chid:i,media_id:t,isDirectCall:!1},"rejected")}catch(e){}},c.prototype.showAudioCallInvitation=function(e){var t=e.chid,i=e.rejectCbk,n=e.acceptCbk,e=e.media_id,a=(this.initiateHeadshot(t),this.states[t]);$.extend(!0,a,{handler:this.handleActionHandler.bind(this),name:_,url:u,chid:t,audio:{mute:!1,media_id:e,reject_cbk:i,accept_cbk:n,is_invited:!0,status:"invited"}}),this.__updateState(t)},c.prototype.handleAudioCallInitiate=function(e,t){var i=this,n=t.chid,a=t.cancelCbk,o=t.muteCbk,s=t.media_id,t=t.isDirectCall,r=this.container.mediaUIHandler,c=(t?(this.states[n]=this.states.directcall,delete this.states.directcall):this.initiateHeadshot(n,t),p[n]=l(n)&&l(n).attendername,this.states[n]),d=parent.document.querySelector(".zsiqmico-close");d&&d.click(),$.extend(!0,c,{handler:this.handleActionHandler.bind(this),name:_,url:u,chid:n,audio:{mute:!!t&&c.audio.mute,media_id:s,reject_cbk:a,mute_cbk:function(){o(),$.extend(!0,c,{audio:{mute:!i.states[n].audio.mute}}),i.__updateState(n)},is_invited:!1,status:"requested"}}),this.__updateState(n),r.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_UI_SHOWN,add_info:r.getMediaActivityAddInfo()},mid:s})},c.prototype.initiateDirectCallUI=function(e){function t(){e(),$.extend(!0,o,{audio:{mute:!n.states[a].audio.mute}}),n.__updateState(a)}var i,n=this,a="directcall";if(e=void 0===e?null:e)return i=this.states[a],$.extend(!0,i,{audio:{mute:!1,mute_cbk:t,status:"initiated"}}),void this.__updateState(a);$("#audiorec,#audiocal").remove(),this.initiateHeadshot(a,!0);var o=this.states[a];$.extend(!0,o,{audio:{mute:!1,mute_cbk:t,status:"mediapermission"}}),this.__updateState(a)},c.prototype.makeAudioCallConnecting=function(e,t){var i=this,n=t.chid,a=t.muteCbk,o=t.rejectCbk,s=t.media_id,r=(t.name,t.isDirectCall),c=this.container.mediaUIHandler,d=this.states[n];EmbedSound.stop(),p[t.chid]=l(t.chid).attendername,$.extend(!0,d,{isDirectCall:r,audio:{mute_cbk:function(){a(),$.extend(!0,d,{audio:{mute:!i.states[n].audio.mute}}),i.__updateState(n)},reject_cbk:o,status:"connecting"}}),this.__updateState(n),c.checkCallHostType({chid:n,mid:s,hostType:"downstream"})&&c.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_UI_SHOWN,add_info:c.getMediaActivityAddInfo()},mid:s}),r&&this.stopSoundNotification()},c.prototype.makeAudioCallConnected=function(e,t){t.media_id;var i=t.chid,n=t.callEndCbk,t=t.isDirectCall,a=this.container.constants.connected,o=(EmbedSound.stop(),this.initiateHeadshot(i),this.ss_invitation[i]&&delete this.ss_invitation[i],this.states[i]),s=o.audio.status==a?o.audio.connected_time:(new Date).getTime();$.extend(!0,o,{isDirectCall:t,audio:{reject_cbk:n,status:a,connected_time:s}}),setTimeout(this.startTimer.bind(this,i,e),500),this.__updateState(i)},c.prototype.makeAudioReconnecting=function(e,t){this.__makeReconnecting(e,t)},c.prototype.makeAudioCallEnded=function(e,t){this.__callTerminate(e,t,"ended")},c.prototype.makeAudioCallCancelled=function(e,t){this.__callTerminate(e,t,"cancelled")},c.prototype.makeAudioCallRejected=function(e,t){this.states[t.chid].isDirectCall&&this.container.mediaUIHandler.initMissedChat(t.chid,"CALLENDED","2",!0),this.__callTerminate(e,t,"rejected")},c.prototype.makeAudioCallMissed=function(e,t){this.__callTerminate(e,t,"missed")},c.prototype.makeAudioCallFailed=function(e,t){this.__callTerminate(e,t,"failed")},c.prototype.__recordSound=function(e,t,i,n,a){var o=this,s=this.container.mediaUIHandler,r=s.isChatExist(e),c=s.getAttenderId(e),d=this.states&&this.states[e]&&this.states[e].screen_share&&"connected"==this.states[e].screen_share.status;(s.getSupportRepCount(e)<2&&r&&!d&&("rejected"==n&&c==i||"missed"==n)||t)&&(ie(this.container,e,u,_,t,ce,a),this.__updateState(e),$(".zsiq_media_headshot_main .zsiqmico-close").on("click",function(){return o.__updateState(e)}))},c.prototype.__callTerminate=function(e,t,i){var n,a=this,o=t.chid,s=t.media_id,r=t.isDirectCall,c=t.lsuid,t=this.container.mediaUIHandler,d=this.states[o],l=Boolean(d.audio&&d.audio.is_invited);t.checkIsChatEndTimerAlive(o)||t.stopNotifSound(),d&&d.audio?(this.invitations=l?null:this.invitations,$.extend(!0,d,{audio:{status:i}}),"rejected"!=i&&"missed"!=i||r||this.setCallUIposition(".zsiq_media_headshot_main"),setTimeout(function(){var e=d.isDirectCall;delete d.audio,a.__updateState(o),a.__checkAndDestroyInstance(o),l||-1==["rejected","missed"].indexOf(i)||a.__recordSound(o,e,c,i,s),e&&"ended"==i&&a.implementRatingUI(o),e&&"cancelled"==i&&a.directCallCancelled()},500),this.__updateState(o),n=t.checkCallHostType({chid:o,mid:s,hostType:"downstream"})&&["cancelled","rejected","missed"].includes(i)?w.activity.MEDIA_AUDIO_INVITATION_CLEARED:w.activity.MEDIA_AUDIO_UI_CLEARED,t.getActiveTab()&&t.sendMediaActivity({param:{action_type:n,add_info:t.getMediaActivityAddInfo()},mid:s}),r&&(this.stopSoundNotification(),clearTimeout(t.getChatWinObjById(o).waitTimer))):d&&this.__checkAndDestroyInstance(o)},c.prototype.__checkAndDestroyInstance=function(e){try{var t=Object.keys(this.states[e]);0==["audio","screen_share"].filter(function(e){return-1!=t.indexOf(e)}).length&&(this.stopTimer(e),delete this.states[e])}catch(e){}},c.prototype.setCallUIposition=function(e){var t,i=this.container.mediaUIHandler,e=$(g()).find(e);e[0]&&(e=getComputedStyle(e[0]),t=parseInt(e.getPropertyValue("left"))||0,e=parseInt(e.getPropertyValue("top"))||0,i.setCallUIPosition(e,t))},c.prototype.showScreenShareInvitation=function(e){function t(){h.clearConformBox()&&h.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:h.getMediaActivityAddInfo()},mid:p}),u()}function i(e){void 0===e&&(e=!0),h.clearConformBox()&&h.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:h.getMediaActivityAddInfo()},mid:p}),e&&l()}var n,a,o,s,r,c,d=e.chid,l=e.rejectCbk,u=e.acceptCbk,p=e.media_id,h=this.container.mediaUIHandler;this.initiateHeadshot(d);n=(e={name:_,acceptHandler:t,rejectHandler:i,chid:d}).name,a=e.acceptHandler,o=e.rejectHandler,e=e.chid,s=(r=SiqAVRouter.container).mediaUIHandler,r=r.uiHandler,c=s.getMediaIdByChid(e),c=s.getCallStatusData(c),r=r.__getConsentContent("screen"),n=m(I("div",{class:"zsiq_popup",id:"zsiqssconfirmbox"},I("div",{class:"zsiq_popupsub"},I("div",{class:"zsiq_popup_child"},I("em",{class:"siqico-close zsiq_center",onClick:o}),I("em",{class:"siqico-screenshare zsiq_popuplogo"}),I("div",{class:"zsiq_popup_hdr"},LSResource.getRealValue("common.screensharerequest")),I("div",{class:"zsiq_popup_desc"},LSResource.getRealValue("screenshare.request.desc",n(e))),I("div",{class:"zsiq_popup_btn zsiq_center"},I("span",{class:"zsiq_center",id:"zsiqconfirmss",onClick:a},LSResource.getRealValue("common.share")),I("span",{class:"zsiq_center zsiq_cancelbtn",id:"zsiqdecliness",onClick:o},LSResource.getRealValue("common.decline")))),s.isScreenRecordingEnabled()&&s.isScreenRecordAllowed()&&!s.isScreenConsentAllowed()&&"smart"==c.connection_type?I("div",{class:"siq-note-cont"},I("div",{class:"siq-note-title"},LSResource.getRealValue("common.disclaimer")," "),I("p",{class:"siq-note-desc"},r," ")):""))),$(g()).append(n),h.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_SHOWN,add_info:h.getMediaActivityAddInfo()},mid:p}),this.ss_invitation[d]={rejectHandler:i,acceptHandler:t,media_id:p,template:n}},c.prototype.showScreenShareMaking=function(e,t){var i=t.chid,n=t.cancelCbk,a=t.media_id,t=t.ss_type,o=(this.initiateHeadshot(i),this.states[i]),t=t||(0==this.container.mediaUIHandler.getScreenShareType(i,a)?"sharing":"viewing");$.extend(!0,o,{handler:this.handleActionHandler.bind(this),name:_,url:u,chid:i,screen_share:{media_id:a,reject_cbk:n,status:"requested",type:t}}),this.__updateState(i)},c.prototype.makeScreenShareConnecting=function(e,t){var i=t.chid,n=t.muteCbk,a=t.rejectCbk,o=t.media_id,t=(t.name,t.ss_type),s=(p[i]=l(i).attendername,this.initiateHeadshot(i),this.states[i]),t=t||(0==this.container.mediaUIHandler.getScreenShareType(i,o)?"sharing":"viewing");$.extend(!0,s,{handler:this.handleActionHandler.bind(this),name:_,url:u,chid:i,screen_share:{media_id:o,mute_cbk:n,reject_cbk:a,status:"connecting",type:t}}),this.__updateState(i)},c.prototype.makeScreenShareConnected=function(e,t){var i=this,n=this.container.mediaUIHandler,a=t.media_id,o=t.chid,s=t.callEndCbk,t=t.ss_type,r=(p[o]=l(o).attendername,this.initiateHeadshot(o),this.states[o]),t=t||(0==n.getScreenShareType(o,a)?"sharing":"viewing");$.extend(!0,r,{handler:this.handleActionHandler.bind(this),name:_,url:u,screen_share:{reject_cbk:s,status:"connected",connected_time:(new Date).getTime(),type:t,media_id:a,swap_cbk:function(){return i.__swapScreen(n.getActiveMediaID(o),o)}}}),setTimeout(this.startTimer.bind(this,o,e),500),this.__updateState(o)},c.prototype.makeScreenShareReconnecting=function(e,t){this.__makeReconnecting(e,t)},c.prototype.makeScreenShareEnded=function(e,t){this.__ssTerminate(e,t,"ended")},c.prototype.makeScreenShareCancelled=function(e,t){this.__ssTerminate(e,t,"cancelled")},c.prototype.makeScreenShareRejected=function(e,t){this.__ssTerminate(e,t,"rejected")},c.prototype.makeScreenShareMissed=function(e,t){this.__ssTerminate(e,t,"missed")},c.prototype.MakeScreenShareFailed=function(e,t){this.__ssTerminate(e,t,"failed")},c.prototype.__ssTerminate=function(e,t,i){var n=this,a=t.chid,o=(t.media_id,this.states[a]);this.ss_invitation[a]&&(this.ss_invitation[a].rejectHandler(!1),delete this.ss_invitation[a]),o&&o.screen_share?(o&&o.screen_share&&!o.audio&&this.stopTimer(a,e),$.extend(!0,o,{screen_share:{status:i}}),setTimeout(function(){delete o.screen_share,n.__updateState(a),n.__checkAndDestroyInstance(a),n.deletePlayer(a)},500),this.__updateState(a)):o&&this.__checkAndDestroyInstance(a)},c.prototype.showDialog=function(){},c.prototype.enableOutingCallUI=function(){},c.prototype.handleActionHandler=function(e,t,i){e=this.states[e]&&this.states[e][t]&&this.states[e][t][i+"_cbk"];e&&e.call(this)},c.prototype.getTimeDiff=function(e){var e=(new Date).getTime()-e,t=0<(t=Math.floor(e/36e5))?t<10?"0"+t:t:"0",i=(i=Math.floor(e%36e5/6e4))<10?"0"+i:i,e=(e=Math.floor(e%6e4/1e3))<10?"0"+e:e,n="";return n=isFinite(i)&&isFinite(e)?(n=0<t?t+":":n)+i+":"+e:n},c.prototype.startTimer=function(t,e){var i,n=this;this.states[t].timer_ref||(i=this.states[t][e].connected_time,this.states[t].timer_ref=setInterval(function(){var e=n.states[t];$.extend(!0,e,{timer:n.getTimeDiff(i)}),n.__updateState(t)},1e3))},c.prototype.stopTimer=function(e){e=this.states[e];clearInterval(e.timer_ref),delete e.timer,this.__updateState(e.chid)},c.prototype.playSoundNotification=function(e,t){var i=this.container.constants.WAITING_TIME_SECS;this.container.mediaUIHandler.playNotifSound({type:t=void 0===t?"audiocall":t,duration:i,tone:e=void 0===e?"incomingcall":e})},c.prototype.stopSoundNotification=function(){this.container.mediaUIHandler.stopNotifSound()},c.prototype.__updateState=function(e){e=this.states[e];e&&[e.headshot,e.headshotInvite,e.player,e.directCallUI].forEach(function(e){e&&e.updateState()}),this.handleMinimizeState()},c.prototype.__swapScreen=function(t,e){var i=this.container.mediaUIHandler,n=(i.getEncryChid(e),l(e),function(e){"Escape"===e.key&&($(g()).find(".zsiq_media_popup").remove(),window.parent.removeEventListener("keydown",n),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:i.getMediaActivityAddInfo()},mid:t}))}),a=m(I("div",{class:"zsiq_media_popup"},I("span",null,LSResource.getRealValue("screenshare.swap.sharing")),I("div",{class:"zsiq_media_btn"},I("span",{onClick:function(){$(a).remove(),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SWAP},mid:t}),i.swapScreenShare({chid:e,id:t}),window.parent.removeEventListener("keydown",n),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:i.getMediaActivityAddInfo()},mid:t})}},LSResource.getRealValue("common.continue")),I("span",{class:"zsiq_media_cancelbtn",onClick:function(){window.parent.removeEventListener("keydown",n),$(a).remove(),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:i.getMediaActivityAddInfo()},mid:t})}},LSResource.getRealValue("common.cancel")))));$(g()).append(a),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_SHOWN,add_info:i.getMediaActivityAddInfo()},mid:t}),window.parent.addEventListener("keydown",n),window.parent.focus()},c.prototype.__makeReconnecting=function(e,t){var i=t.chid,t=t.media_id,i=(this.states[i][e="viewing"==this.getCurrentScreenshareType(i)?"screen_share":e].status="reconnecting",this.__updateState(i),"audio"==e?w.activity.MEDIA_AUDIO_RECONNECT_STATE:w.activity.MEDIA_SCREENSHARE_RECONNECT_STATE);this.container.mediaUIHandler.sendMediaActivity({param:{action_type:i},mid:t})},c.prototype.shareScreen=function(e,t,i){var n=this.container.mediaUIHandler,a=n.getMediaIdByChid(e),o=n.getCallStatusData(a);n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SHARESCREEN},mid:a}),o.connection_type==w.connectionType.PEER2PEER||n.isScreenConsentAllowed()||!n.isScreenRecordingEnabled()||"audio_call"==n.getMediaRecordingConsentDetails().type?n.addScreenShareTrack({chid:e,id:a}):n.showScreenShareConsentUI(a)},c.prototype.mediaPermissionUI=function(e){e=e,t=getBrowserFromUserAgent(navigator.userAgent).split("-")[0];var t,i,n=i=m(I("div",{class:"zsiq_prv_main zsiq-cal-turtrp",id:"allowmicbannerui",onClick:function(){window.currentRecorder&&window.currentRecorder.destroy(),$(i).remove()}},I("div",{class:"zsiq-cal-hnt-cont "+("Chrome"==t?"":"zsiq-"+t)},I("div",{class:"zsiq-trtp-anim"}),I("span",{class:"siqico-arrow zsiq-arrow"}),I("span",{class:"zsiq-alw-mic siqico-mic"}),I("div",{class:"zsiq-alw-mic-desc",html:e?LSResource.getRealValue("voicenotes.info.pleaseallowmicrophone"):LSResource.getRealValue("av.info.pleaseallowmicrophone")}))));return $(g()).append(n),function(){return $(n).remove()}},c.prototype.mediaPermissionUnlock=function(e){t=e,a=getBrowserFromUserAgent(navigator.userAgent).split("-")[0];var t,i,n=i=m(I("div",{class:"zsiq_prv_main zsiq-cal-turtrp",onClick:function(){window.currentRecorder&&window.currentRecorder.destroy(),$(i).remove()}},I("div",{class:"zsiq-cal-hnt-cont zsiq-isblk "+("Chrome"==a?"":"zsiq-"+a)},I("div",{class:"zsiq-trtp-anim "}),I("span",{class:"siqico-arrow zsiq-arrow"}),I("div",{html:t?LSResource.getRealValue("voicenotes.info.pleasetaponlock","<em class='siqico-lock'></em>"):LSResource.getRealValue("av.info.pleasetaponlock","<em class='siqico-lock'></em>")}),I("p",null,"(",LSResource.getRealValue("common.or"),")"),I("div",null,LSResource.getRealValue("av.info.enablemicrophonesetting")),I("div",{class:"calndr-sedulbtn",style:"",onclick:te}," ",LSResource.getRealValue("chatwindow.mailcopy.clickhere")," ")))),a=($(g()).append(n),$(g()).find("#allowmicbannerui").remove(),e?LSResource.getRealValue("voicenotes.info.microphone.blocked"):LSResource.getRealValue("av.info.microphone.blocked"));return $UI.showBanner(a,!0,null,8e3),function(){return $(n).remove()}},c.prototype.handleCallClash=function(e,t){e()},c.prototype.handleMinimizeState=function(){var e=this.invitations,t=this.container.mediaUIHandler.getActiveCallData();e||t?($Support.getParent().$ZSIQWidgetUI.updateCallUI(),e?$Support.getParent().$ZSIQWidgetUI.updateIncomingCallUI():$Support.getParent().$ZSIQWidgetUI.removeIncomingCallUI()):$Support.getParent().$ZSIQWidgetUI.removeCallUI()},c.prototype.forceEndCall=function(){var e,t=this.container.mediaUIHandler;for(e in this.states)t.endCallByChid(e),t.triggerIconCheck(e)},c.prototype.implementRatingUI=function(e){var t,i=this.container.mediaUIHandler,n=(t=e,m(I("div",{class:"cal-wrap",id:"audiocal"},I("div",{class:"posrel dib-mid"},I("div",{class:"cal-widgt theme1 outcal"},I("div",{class:"posrel usr-imginfo"},I("div",{class:"cal-visimg "},I("img",{src:(n=u)&&n(0,t),alt:"Operator"}))),I("div",{class:"cal-vstrdetl textC"},I("nav",{class:"cal-actvevstr elips font16"},LSResource.getRealValue("av.info.rating")),I("div",{class:"rating font18"},I("span",{class:"reaction_ico sad_icon","data-reaction":"sad",documentclick:"sendCallRating",title:LSResource.getRealValue("common.sad")}),I("span",{class:"reaction_ico neutral_icon","data-reaction":"neutral",documentclick:"sendCallRating",title:LSResource.getRealValue("common.neutral")}),I("span",{class:"reaction_ico happy_icon","data-reaction":"happy",documentclick:"sendCallRating",title:LSResource.getRealValue("common.happy")})),I("p",{class:"c777 font14"},LSResource.getRealValue("ne.rating.byline"))))))));CallImpl.isCallWithChat=i.getEncryChid(e),SiqAVRouter.chatwinobj=i.getChatWinObjById(e),i.getChatWinObjById(e).hideMaskDiv(),JSON.parse($Support.EmbedObj.eprops.reaction[0])?($("#audiorec,#audiocal").remove(),$("body").prepend(n)):this.implementRatingFdbkUI(SiqAVRouter.chatwinobj)},c.prototype.implementRatingFdbkUI=function(e){e=e,t=u,i=_,n=ZSIQConversationManager.getChatWinObjById(e.chatID).RCHID,a=$Support.isSignature($Support.EmbedObj);var t,i,n,a=m(I("div",{class:"cal-wrap",id:"audiocal"},I("div",{class:"adocal-cont dtfix "+oe()+" cal-oflne",style:"height:354px;"},ae(null,e),I("div",{class:"header"},a?"":I("div",{class:"actbtn"},I("em",{class:"sqico-min siq-minimize-icon",title:LSResource.getRealValue("ne.title.minimize"),documentclick:"min_iframe"})),I("div",{class:"posrel dib-mid"},I("div",{class:"cal-visimg sqico-user"},I("img",{src:t&&t(0,n),alt:i?i(n):"Operator"})),e.rating?I("em",{class:"reaction_ico "+e.rating+"_icon usr-rtng"}):""),I("div",null,I("div",{class:"cal-cmpname font20 fontB"},i(n)))),I("div",{class:"cal-bodycont posrel"},e.rating?I("div",{class:"ofln-msg mT5"}," ",$Support.getReactionIndex(e.rating)," "):""),I("div",{class:"cal-footer",style:"height:70px;"},I("textarea",{class:"bg-f6 font13 c333 lH20",dockeyup:"feedback",dockeydown:"textarea",id:"fdbkarea","data-validate":"required",placeholder:LSResource.getRealValue("av.info.fdkbckmsg"),autofocus:"",style:"overflow: hidden;"}),I("div",{class:"sqico-calsend fdbak-send msg-send",documentclick:"sendCallFb",title:LSResource.getRealValue("embed.submit")})))));JSON.parse($Support.EmbedObj.eprops.feedback[0])?($($Support.getParent().document.body).find(".siqembed").removeClass("zsiq_size2"),$Support.getParent().$ZSIQWidgetUI.handlefbCall(),$("#audiorec,#audiocal").remove(),$("body").prepend(a)):this.directCallCancelled()},c.prototype.implementFdbkSuccessUI=function(e){e=e,t=u,i=_,n=ZSIQConversationManager.getChatWinObjById(e.chatID).RCHID,a=$Support.isSignature($Support.EmbedObj);var t,i,n,a=m(I("div",{class:"cal-wrap",id:"audiocal"},I("div",{class:"adocal-cont dtfix "+oe()+" cal-oflne"},ae(null,e),I("div",{class:"header"},a?"":I("div",{class:"actbtn"},I("em",{class:"sqico-min siq-minimize-icon",title:LSResource.getRealValue("ne.title.minimize"),documentclick:"min_iframe"})),I("div",{class:"posrel dib-mid"},I("div",{class:"cal-visimg sqico-user"},I("img",{src:t&&t(0,n),alt:i?i(n):"Operator"})),e.rating?I("em",{class:"reaction_ico "+e.rating+"_icon usr-rtng",title:e.rating}):""),I("div",null,I("div",{class:"cal-cmpname font20 fontB"},i(n)))),I("div",{class:"cal-bodycont posrel"},I("div",{class:"ofln-msg mT5"},LSResource.getRealValue(e.rating?"av.info.ratingandfbk":"faq.feedback")),I("div",{class:"sqico-call bg-grn mT25 mA",title:LSResource.getRealValue("av.info.callagain"),onclick:function(){return parent.$zohosq.call.start()}})))));$Support.getParent().$ZSIQWidgetUI.handleMinCall(),$("#audiorec,#audiocal").remove(),$("body").prepend(a)},c.prototype.directCallCancelled=function(){$("#audiorec,#audiocal").remove(),$("body").prepend(CallUIHandler.getCallCancelledHtml()),$Support.isSignature($Support.EmbedObj)&&$("div.actbtn").remove(),$($Support.getParent().document.body).find(".siqembed").removeClass("zsiq_size2"),$Support.getParent().$ZSIQWidgetUI.handleMinCall()},c.prototype.deleteScreenShareState=function(e){this.states[e]&&this.states[e].screen_share&&delete this.states[e].screen_share},c.prototype.deletePlayer=function(e){this.states[e]&&this.states[e].player&&(clearTimeout(this.states[e].player.showCntrlTimer),delete this.states[e].player)},c.prototype.clearAllStates=function(e){this.states[e]&&delete this.states[e]},c.prototype.getCurrentScreenshareType=function(e){e=this.states[e];return e&&e.screen_share&&e.screen_share.type?e.screen_share.type:null},c.prototype.getUIPosition=function(e){e=getComputedStyle(this.siqdom.querySelector(e));if(e)return{left:parseInt(e.getPropertyValue("left"))||0,top:parseInt(e.getPropertyValue("top"))||0,bottom:parseInt(e.getPropertyValue("bottom"))||0,right:parseInt(e.getPropertyValue("right"))||0,width:parseInt(e.getPropertyValue("width"))||0,height:parseInt(e.getPropertyValue("height"))||0}},c.prototype.showAudioConsent=function(e,t){var i=t.chid,n=t.rejectCbk,t=t.acceptCbk,a=this.states[i];$.extend(!0,a,{consent:{desc:this.__getConsentContent("audio"),title:LSResource.getRealValue("av.info.recordingconsent.title"),show:!0,reject_cbk:n,accept_cbk:t,type:w.audio}}),this.__updateState(i)},c.prototype.showScreenConsent=function(e,t){var i=t.chid,n=t.rejectCbk,t=t.acceptCbk,a=this.states[i];$.extend(!0,a,{consent:{desc:this.__getConsentContent("screen"),title:LSResource.getRealValue("av.info.recordingconsent.title"),show:!0,reject_cbk:n,accept_cbk:t,type:w.screen}}),this.__updateState(i)},c.prototype.__getConsentContent=function(e){var t=this.container.mediaUIHandler.getMediaRecordingConsentDetails(),t={audio_default:LSResource.getRealValue("av.info.audiorecordingconsent.defaultvalue"),screen_default:LSResource.getRealValue("av.info.screenrecordingconsent.defaultvalue"),audio:t&&t.call_consent_message,screen:t&&t.screenshare_consent_message};return t[e]||t[e+"_default"]},c.prototype.clearConsentState=function(e){delete this.states[e].consent,this.__updateState(e)};function d(e){this.container=e,this.ajax=new j}function h(e){this.container=e,this.uiutil=$Support,this.isembed=!0,this.isoldUI=!1}function f(e){this.container=e,this.init(e),this.data={}}function de(e){this.container=this.container}function le(e){this.container=e,this.init(e)}function ue(e){this.conatiner=e}function C(e){((this.container=e).MediaPermission=this).isSupported=void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia,this.displayMediaSupported=this.isSupported&&navigator.mediaDevices.getDisplayMedia&&void 0!==navigator.mediaDevices.getDisplayMedia,this.init(),this.getmediaDevices(this.updateMediaDevices.bind(this),null)}function A(e){this.container=e,this.userAgent=navigator.userAgent,this.browserName=null,this.browserVersion=null,this.browserSupported=!1,this.browserSupportedForStats=!1,(e.MediaDetails=this).platform=navigator.platform,this.setBrowserName()}function pe(e){this.data={},this.container=e,this.unique="SiqMedia_",e.dataHandler=this}function he(e){(e.router=this).container=e,this.init(e)}function b(e){(e.LSRouter=this).container=e,this.init()}function E(e){this.container=e}function k(){this.embed=SiqAVRouter.container.mediaUIHandler.isEmbed(),this.reRender()}d.prototype.post=function(e,t,i,n,a,o,s){void 0===s&&(s="v2"),(a=void 0===a?!1:a)?this._postRequest(e,t,i,n,!0,s):this.request("POST",e,t,i,n)},d.prototype.get=function(e,t,i){this.request("GET",url,e,t,i)},d.prototype.request=function(e,t,i,n,a){t=_SCHEMA+"://"+_EMBEDSERVERURL+"/visitor/v2/"+_SCREENNAME+"/"+t;try{$.ajax({url:t,type:e,data:i,success:n||function(){},error:a||function(){}})}catch(e){}},d.prototype._postRequest=function(e,t,i,n,a,o){o=_SCHEMA+"://"+_EMBEDSERVERURL+"/visitor/"+o+"/"+_SCREENNAME+"/"+e;this.ajax.request({url:o,type:"POST",data:t,rest:a,success:i,error:n})},d.prototype.put=function(e,t,i,n,a,o){void 0===o&&(o="v2");o=_SCHEMA+"://"+_EMBEDSERVERURL+"/visitor/"+o+"/"+_SCREENNAME+"/"+e;this.ajax.request({url:o,type:"PUT",data:t,rest:a,success:i,error:n})},h.prototype.isOldUI=function(){return this.isoldUI},h.prototype.handleEndSession=function(e,t){this.onGoingCallForChat(e)?this.container.commonImpl.endCallByChid(e,t):t()},h.prototype.onGoingCallForChat=function(e){var t=this.container.commonImpl,e=t.getMediaIdByChid(e);return!!v(e?t.getCallStatusData(e):{})},h.prototype.getEncryChid=function(e){return $Support.chidmappinglist[e]},h.prototype.isEmbed=function(){return this.isembed},h.prototype.getChatWinObjById=function(e,t){t=(t=void 0===t?!1:t)?e:this.getEncryChid(e);return ZSIQConversationManager.getChatWinObjById(t)},h.prototype.getSupportReps=function(e,t){t=(t=void 0===t?!1:t)?e:this.getEncryChid(e);return SUPPORT_REPS[t]||null},h.prototype.getSupportRepCount=function(e,t){e=this.getSupportReps(e,t=void 0===t?!1:t);return e&&Object.keys(e).length},h.prototype.isGroupConversation=function(e,t){void 0===t&&(t=!1);try{return 1<this.getSupportRepCount(e,t)}catch(e){return!1}},h.prototype.isAttenderBot=function(e,t){return this.getChatWinObjById(e,t=void 0===t?!1:t).isBotChat},h.prototype.isChatExist=function(e,t){return this.getChatWinObjById(e,t=void 0===t?!1:t).isAudioCallAllowed()},h.prototype.getAttenderId=function(e,t){return this.getChatWinObjById(e,t=void 0===t?!1:t).attender},h.prototype.isProactiveChat=function(e,t){return this.getChatWinObjById(e,t=void 0===t?!1:t).proactive},h.prototype.getCurrentUserId=function(){return null},h.prototype.playNotifSound=function(e){var t=e.tone,i=e.duration,n=e.chatid,e=e.isEncrypted,e=!n||this.getChatWinObjById(n,e);n&&e.isSoundOff()||EmbedSound.play(t,i)},h.prototype.stopNotifSound=function(){EmbedSound.stop()},h.prototype.initMissedChat=function(e,t,i,n){e=e?this.getChatWinObjById(e):ZSIQConversationManager.getcurrchatwinobj();delete $Support.requestRunning_missedvisitor,this.uiutil.handleMissed(t,i,n,e),this.uiutil.removeWtimeCookie(e.chatID),delete e.reopenwaiting,$Support.removeBroadCast()},h.prototype.clearChatWindow=function(){this.uiutil.removeSSChatView()},h.prototype.clearPlayer=function(){var e=this.getBody().find(".zsiq_media_videomain");return 0<e.length&&(e.remove(),!0)},h.prototype.clearAudioUI=function(){var e=this.getBody().find(".zsiq_media_headshot_main");e&&e[0]&&"user_busy"!=e[0].id&&e.remove()},h.prototype.clearConformBox=function(){var e=this.getBody().find("#zsiqssconfirmbox");return 0<e.length&&(e.remove(),!0)},h.prototype.clearPopup=function(){var e=this.getBody().find(".zsiq_media_popup");return 0<e.length&&(e.remove(),!0)},h.prototype.clearBusyUI=function(){var e=this.getBody().find("#user_busy");return 0<e.length&&(e.remove(),!0)},h.prototype.getBody=function(){return $(parent.document.body)},h.prototype.triggerAudioCallIcon=function(e,t){var i=$("#audiocall");"show"==t?(this.showAudioCall(),i.removeClass("cmn_disable").show(),i.show().parent().addClass("rgt_ico")):"hide"==t?(this.hideAudioCall(),i.hide().parent().removeClass("rgt_ico")):"disable"==t&&(this.showAudioCall(),i.addClass("cmn_disable"))},h.prototype.showAudioCall=function(){$("#audiocall").show(),$(".callagain-txt").show()},h.prototype.hideAudioCall=function(){$("#audiocall").hide(),$(".callagain-txt").hide()},h.prototype.isAudioCallEnabled=function(){var e="true"==$Support.getParent().$ZSIQChat.getWidgetData().embedobj.isaudiocallallowed,t="true"==$Support.EmbedObj.eprops.isaudiocall;return e&&t&&!this.container.dataHandler.get("isBrandsDisabled")},h.prototype.isPlanAllowed=function(){return Licence.verify("audiocall")},h.prototype.isScreenShareAllowed=function(){return CommonUtil.isScreenshareEnabledFromPortal()&&$Support.EmbedObj.eprops.ischannelscreenshare&&Licence.verify("issiqscreenshare")},h.prototype.hasIncomingCall=function(e){var t=this.container,i=t.commonImpl,t=t.constants,e=i.getMediaIdByChid(e),i=e?i.getCallStatusData(e):{};return!(!v(i)||i.type!=t.audio||i.callType!=t.incoming||i.callStatus!=t.ringing)},h.prototype.isActiveBySSType=function(e){var t=this.container,i=t.commonImpl,t=t.constants,n={isActive:!1,id:null},a=i.getActiveCallData();if(!a)return n;if(a==e){e=i.getMediaIdByChid(a),a=e?i.getCallStatusData(e):{};if(v(a)&&a.type==t.screen_share)return n.isActive=!0,n.id=e,n}return n},h.prototype.isShareScreenAllowed=function(e){if(!this.container.commonImpl.currentUserBrowserSupportSS())return!1;var t=this.isActiveBySSType(e),i=t.isActive,t=t.id;return 0!=this.container.screen_shareImpl.getScreenShareType(e,t)||!i},h.prototype.checkIsSSOnGoing=function(e,t){var i=this.container.commonImpl.getActiveCallData();return!!i&&(i!=e||(t==w.screen_share?this.isShareScreenAllowed(e):t==w.screen_view?this.isRequestScreenShareAllowed(e):void 0))},h.prototype.isSecureConnection=function(){return-1<window.location.protocol.indexOf("https")||-1<window.location.protocol.indexOf("file:")},h.prototype.isAudioRecordingSupported=function(){return window.AudioContext=window.AudioContext||window.webkitAudioContext,window.URL=window.URL||window.webkitURL,navigator.getUserMedia=this.container.MediaPermission.getUserMediaDetail(),window.AudioContext&&navigator.getUserMedia&&window.URL&&window.Worker||(support=!1),!0},h.prototype.closeViewMediaPermission=function(){$(window.parent.document).find("body").find(".zsiq_prv_main").remove()},h.prototype.isliveChatWindow=function(){return"msgarea"==$Support.container.attr("cwview")},h.prototype.isFaceBookIntegration=function(){return-1<window.location.href.lastIndexOf("facebook.ext")},h.prototype.getVisitorWMSID=function(){return this.uiutil.EmbedObj.vwmsid},h.prototype.getDecodedText=function(e){return"function"==typeof getDecodedText?getDecodedText(e):e},h.prototype.getEscapedText=function(e){return"function"==typeof getEscapedText?getEscapedText(e):e},h.prototype.getVisitorID=function(e){},h.prototype.getVisitorBrowser=function(e){},h.prototype.getVisitorPage=function(e){},h.prototype.isMobileVisitor=function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB10|IEMobile|Opera Mini/i.test(navigator.userAgent)},h.prototype.isIOSSDKVisitor=function(e){},h.prototype.isChatMonitor=function(e){return!1},h.prototype.I18N=function(e){},h.prototype.getChatAttender=function(e){},h.prototype.isVisitorOnline=function(e){},h.prototype.isOngoingChat=function(e){return!1},h.prototype.checkBrowserSupported=function(e,t){},h.prototype.addVisitorDetail=function(e){},h.prototype.pickupsupport=function(e){},h.prototype.endSession=function(e){e=e?this.getChatWinObjById(e):ZSIQConversationManager.getcurrchatwinobj();$Support.quitChat(e)},h.prototype.getChatIdByVisitorId=function(e){},h.prototype.isScreenShareEnabled=function(){},h.prototype.sendDebugLogger=function(e){},h.prototype.removeAudioCallIcon=function(e){},h.prototype.isAllowedForCurrTab=function(e,t){},h.prototype.isVisitorBrowserSupported=function(e){},h.prototype.getVisitorOS=function(e){},h.prototype.triggerIconCheck=function(e){try{this.container.audioImpl.audioIconStatus(e,this.triggerAudioCallIcon.bind(this))}catch(e){}},h.prototype.focusChatWindow=function(e){},h.prototype.joinChat=function(e){},h.prototype.canShowAudioCallInvitation=function(e){return!0},h.prototype.endCall=function(e,t){this.container.commonImpl.endCallByChid(e,t)},h.prototype.isAudioCallDisabled=function(){return!1},h.prototype.handleCallInitiate=function(e){this.clearChatEndTimer(e),this.triggerRecorderIcon("disable")},h.prototype.handleCallEnded=function(e){this.triggerRecorderIcon("show"),this.closeChatWindow(e.chid)},h.prototype.handleCallCancelled=function(e){this.triggerRecorderIcon("show")},h.prototype.handleCallRejected=function(e){this.triggerRecorderIcon("show")},h.prototype.handleCallMissed=function(e){this.triggerRecorderIcon("show")},h.prototype.handleCallFailed=function(e){this.triggerRecorderIcon("show")},h.prototype.handleIncomingCall=function(e){this.clearChatEndTimer(e),this.triggerRecorderIcon("disable")},h.prototype.handleIncomingAccept=function(e){this.clearChatEndTimer(e)},h.prototype.handleOutgoingAccept=function(e){this.clearChatEndTimer(e)},h.prototype.isCallInitiatedFromOldUI=function(e){return this.container.commonImpl.getIsCallInitiatedFromOldUI(e)},h.prototype.isMobileOperator=function(e){return this.container.commonImpl.getIsMobileOperator(e)},h.prototype.checkIsChatEndTimerAlive=function(e){e=this.getChatWinObjById(e);return e&&e.endtimer},h.prototype.clearChatEndTimer=function(e){var t=this.getChatWinObjById(e.chid);this.checkIsChatEndTimerAlive(e.chid)&&($Support.clearEndTimer(t),this.stopNotifSound())},h.prototype.isTabFocused=function(){return parent.document.hasFocus()},h.prototype.getSessionID=function(){return LSMessanger.getSid()},h.prototype.getMediaActivityAddInfo=function(){return+this.isTabFocused()+" | "+this.getSessionID()},h.prototype.isMediaRecordingEnabledForChat=function(e){return $Support.EmbedObj.eprops.call_recording},h.prototype.removeAudioPlayers=function(){$(".siqmediaaudioplayer").remove()},h.prototype.isCurrentChatQueued=function(){var e=ZSIQConversationManager.getcurrchatwinobj();return!(!e||!e.queueTimer)},h.prototype.showEmbedBanner=function(e,t,i){var n=ZSIQConversationManager.getcurrchatwinobj();this.isEmbed()&&n&&n.RCHID==i&&$UI.showBanner(LSResource.getRealValue(e),!0,null,t)},h.prototype.triggerRecorderIcon=function(e){"show"==e?$(document).ready(function(){$('span[id="zsiq-voicenote"').removeClass("cmn_disable").show(),$('span[id="zsiq-voicenote"').removeAttr("disabled")}):"disable"==e&&$(document).ready(function(){$('span[id="zsiq-voicenote"').addClass("cmn_disable"),$('span[id="zsiq-voicenote"').attr("disabled","")})},h.prototype.isRecordingON=function(){return window.currentRecorder&&window.currentRecorder.isRecording()&&window.currentRecorder.isVoiceNote()},h.prototype.hasAudioCallInvitation=function(){var e=this.container.dataHandler;return e.data.media_inv&&e.data.media_inv.length||$Support.getParent().document.getElementById("zsiqssconfirmbox")||e.data.media_active},h.prototype.isChatLive=function(){return this.uiutil.isChatExist()},h.prototype.setValueInSession=function(e,t){this.uiutil.LSDB.storeInSession(e,t)},h.prototype.removeValueInSession=function(e){this.uiutil.LSDB.removeSessionStore(e)},h.prototype.getValueInSession=function(e){return this.uiutil.LSDB.getFromSession(e)},h.prototype.getAppName=function(){return this.uiutil.EmbedObj.embedname},h.prototype.getApiVisitorId=function(){return this.uiutil.getParent().$ZSIQUtil.getAPIVisitorID()},h.prototype.getAVUID=function(){return this.uiutil.getParent().$ZSIQUtil.getAvuid()},h.prototype.getMediaRecordingConsentDetails=function(){return this.uiutil.EmbedObj.call_recording},h.prototype.isScreenRecordingEnabled=function(){return this.uiutil.EmbedObj.screenRecordingEnabled||!1},h.prototype.isScreenRecordAllowed=function(){return this.getMediaRecordingConsentDetails().type==w.consent_audioandscreen},h.prototype.isAudioRecordAllowed=function(){return this.getMediaRecordingConsentDetails().type==w.consent_audioandscreen||this.getMediaRecordingConsentDetails().type==w.consent_onlyaudio},h.prototype.canShowOperatorImage=function(){return this.uiutil.EmbedObj.eprops.icphoto},h.prototype.isOnlyCallEnabled=function(){return this.uiutil.EmbedObj.onlyCallEnabled||!1},h.prototype.openChatWindow=function(e){this.uiutil.handleSSChatView(e)},h.prototype.closeChatWindow=function(e){var t=this.container.mediaUIHandler.getUIState().states;t&&((e=t[e]?t[e].player:t[Object.keys(t)[0]]&&t[Object.keys(t)[0]].player)&&(e.isChatwindowOpened=!1),this.uiutil.removeSSChatView())},h.prototype.getIsSSChatEnabled=function(){return this.uiutil.EmbedObj.isScreenshareChatEnabled},h.prototype.isCallMonitorConfEnabled=function(){return Boolean(this.uiutil.EmbedObj.callMonitorEnabled)},f.prototype.init=function(e){this.audio_impl=e.audioImpl,this.audio_unified_mix_impl=e.audioImpl,this.video_impl=e.videoImpl,this.screen_share_impl=e.screenShareImpl,this.screen_view_impl=e.screen_viewImpl,this.screen_share_smart_impl=e.screen_viewImpl,this.screen_view_smart_impl=e.screenShareImpl,this.common_impl=e.commonImpl},f.prototype.handle=function(e){this.data=e.param,this.route()},f.prototype.route=function(){var e=this.container,t=e.constants,i=e.commonImpl,e=e.uiHandler,n=this.data.msg.media||this.data.msg,a=n.type,o=n.chatid,s=(n.chid,n.id),n=(n.negotiationType,n.connection_type),r=(this.__formatMessage(),i.getCallStatusData(s)),n=n||r.connection_type,a=a||r.type,n=(n&&(r=i.getTypeFromConnectionType(n,a),this.data.msg.media&&(this.data.msg.media.type=r),this.data.msg&&(this.data.msg.type=r),a=r),this.data.msg),r=n.operation;n.cbtype;i.setWmsPushData(s,this.data.msg.media||this.data.msg),this.checkIsCurrentTab()||-1!=[t.call_initiate,t.call_cancel,t.call_miss,t.call_failed,"invite","initiate",t.cancel,t.reject,t.miss,"init_monitor"].indexOf(r)||-1!=["offer"].indexOf(r)&&"screen_share_smart"==a?P(t=(n=this.getController())&&n[this.getHandler()])&&(t.call(n,s),i.sendMediaStats(this.data,null)):(e.clearAudioCallInvite(a,s,o),this.container[a+"Impl"].clearData(s),Sound.stop())},f.prototype.__formatMessage=function(){var e=this.data.msg.media||this.data.msg,t=e.chatid,e=e.chid,i=(t||(this.data.msg.chatid=t||e),{negotiation_type:"negotiationType",media_invitation:"mediaInvitation",perfect_renegotiation:" perfectReNegotiation",media_request:"mediaRequest",is_mobile_operator:"isMobileOperator",closed_reason:"closedReason",recording_type:"recordingType",is_consent_allowed:"isConsentAllowed"});if(this.data.msg.media)for(var n in i)null!=this.data.msg.media[n]&&(this.data.msg.media[i[n]]=this.data.msg.media[n]);else for(var a in i)null!=this.data.msg[a]&&(this.data.msg[i[a]]=this.data.msg[a])},f.prototype.checkIsCurrentTab=function(){return this.container.commonImpl.getActiveTab()},f.prototype.getController=function(){var e=this.container.constants,t=this.data.msg.media||this.data.msg,i=t.type,t=(t.chatid,t.id,t.negotiationType);return i==e.audio_unified_mix||i==e.audio_smart?i=e.audio:i!=e.screen_share_smart&&i!=e.screen_view_smart||(i=e.screen_share),this[(t||i)+"_impl"]},f.prototype.getHandler=function(){var e,t=this.data.msg.media||this.data.msg,i=t.id,t=t.connection_type,n=this.container.commonImpl;return"unified"==(t=t||n.getCallStatusData(i).connection_type)||"smart"==t?(n=this.getOperations(),this.__getConfOperationKeys()||n):(i=this.getStatus(),t=this.getOperations(),n=this.getCBTypes(),e=this.__getP2POperation(),i||t||e||n)},f.prototype.__getConfOperationKeys=function(){var e=this.container.constants,t=this.data.msg.operation;return{credential:"handleUnifiedCallCredentail",initiate:"handleInvitation",accept:"handleUnifiedCallAccept",reject:"handleCallReject",candidates:"handleCandidates",answer:"handleUnifiedCallAnswer",offer:"handleUnifiedCallOffer",cancel:"handleCallCancel",miss:"handleCallMissed",invite:e.handleInvitation,request:"handleCallRequest",answer_received:"handleCallAnswerReceived",connected:"handleUnifiedCallConnected",end:"handleUnifiedCallEnd"}[t]},f.prototype.__getP2POperation=function(){var e=this.container.constants,t=this.data.msg,t=(t.cbtype,t.statusType,t.operation);return{credential:e.setCredential,initiate:e.handleInvitation,accept:e.handleCallAccept,reject:e.handleCallReject,candidates:e.handleCandidates,answer:e.handleCallAnswer,end:e.handleCallEnd,offer:e.handleCallOffer,cancel:e.handleCallCancel,miss:e.handleCallMissed,invite:e.handleCallInvite,request:e.handleCallRequest,failed:e.handleCallFailed}[t]},f.prototype.getOperations=function(){var e=this.container.constants,t=this.data.msg,t=(t.cbtype,t.statusType,t.operation);return{call_credential:e.setCredential,call_initiate:e.handleInvitation,call_accept:e.handleCallAccept,call_reject:e.handleCallReject,call_candidates:e.handleCandidates,call_answer:e.handleCallAnswer,call_end:e.handleCallEnd,call_offer:e.handleCallOffer,call_cancel:e.handleCallCancel,call_miss:e.handleCallMissed,call_invite:e.handleCallInvite,call_request:e.handleCallRequest,call_failed:e.handleCallFailed}[t]},f.prototype.getCBTypes=function(){var e=this.container.constants,t=this.data.msg;t.cbtype,t.statusType,t.operation;return{credential:e.setCredential,invite:e.handleInvitation,reject:e.handleCallReject,candidate:e.handleCandidates,answer:e.handleCallAnswer,offer:e.handleCallOffer,cancel:e.handleCallCancel,miss:e.handleCallMissed,invite:e.handleCallInvite}},f.prototype.getStatus=function(){var e=this.container.constants,t=this.data.msg,i=(t.cbtype,t.statusType);t.operation;return{accept:e.handleCallAccept,end:e.handleCallEnd}[i]},de.prototype.getEventsMap=function(){return{mute:"",end_media:"",sharescreen:"",shareaudio:"",stop_audio:"",stop_screenshare:""}},le.prototype.handle=function(){},le.prototype.init=function(e){},ue.prototype.handle=function(){},C.prototype.init=function(){this.type={audio:"audio",video:"video",audio_video:"audio_video",screen:"screen_share"},this.streamType={audio:1,video:2,screen:3,audio_video:4},this.streamTypeInString={1:"audio",2:"video",3:"screen_share",4:"audio_video"},this.devicesType={audioInput:"audioinput",videoInput:"videoinput",audioOutput:"audiooutput"}},C.prototype.isDisplayMediaSupported=function(){return this.displayMediaSupported},C.prototype.updateMediaDevices=function(e){this.devicesArray=e;var t,i=[],n=[],a=[];for(t in this.devicesArray){var o=this.devicesArray[t];o.kind==this.devicesType.audioInput?i.push(o):o.kind==this.devicesType.videoInput?a.push(o):o.kind==this.devicesType.audioOutput&&n.push(o)}this.availableDevices={audioInput:i,videoInput:a,audioOutput:n}},C.prototype.getAvailableDevices=function(){return this.availableDevices},C.prototype.getmediaDevices=function(t,e){void 0!==navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices().then(function(e){return t(e)})},C.prototype.updatePreferredDevice=function(e){this.preferredDevice||(this.preferredDevice={}),this.preferredDevice[e.kind]=e},C.prototype.updatePreferredDeviceByDeviceId=function(e,t){for(var i={},n=0;n<this.availableDevices[t].length;n++)this.availableDevices[t][n].deviceId==e&&(i=this.availableDevices[t][n]);this.updatePreferredDevice(i)},C.prototype.getPreferredDevice=function(e){return this.preferredDevice?this.preferredDevice[e]:null},C.prototype.getAudioInputDevices=function(){return this.availableDevices.audioInput},C.prototype.getVideoInputDevices=function(){return this.availableDevices.videoInput},C.prototype.getAudioOutputDevices=function(){return this.availableDevices.audioOutput},C.prototype.getMediaConstraints=function(e,t){var i={},n=!0,a=!0,o=this.getPreferredDevice(this.devicesType.audioInput),s=this.getPreferredDevice(this.devicesType.videoInput);return o&&(n={deviceId:{exact:o.deviceId}}),s&&(a={deviceId:{exact:s.deviceId}}),i=Object.assign({},{audio:n,video:a},t),e==this.type.audio?i.video=!1:e!=this.type.video&&e!=this.type.screen||(i.audio=!1),i},C.prototype.getDeskTopScreen=function(i,n,a,e,t,o){var s=this,r=this.container.constants;SalesIQDesktopIPC.getMediaInstance().getSources({types:[r.window,r.screen]}).then(function(e){for(var t in e)if(e[t].name===r.Entire_Screen)try{navigator.mediaDevices.getUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:r.desktop,chromeMediaSourceId:e[t].id}}}).then(function(e){s.streams[i]=e,typeof o===r.function&&(e=e._getPrimaryVideoTrack())&&(e.onended=o),n()})}catch(e){a(e,i)}})},C.prototype.requestStream=function(t,i,n,e,a,o){var s=this,r=null;this.streams?r=this.streams[t]:this.streams=[],r&&t!=this.type.screen?i():this.isDesktopApp()&&t==this.type.screen?this.getDeskTopScreen(t,i,n,e,a,o):(r=a?navigator.mediaDevices.getDisplayMedia:navigator.mediaDevices.getUserMedia,a=this.getMediaConstraints(t,e),r.call(navigator.mediaDevices,a).then(function(e){s.setType(e,t),s.streams[t]=e,"function"==typeof o&&(e=e._getPrimaryVideoTrack())&&(e.onended=o),i()}).catch(function(e){n(e,t)}))},C.prototype.getAudioStream=function(e,t,i,n){this.requestStream(this.type.audio,e,t,i,!1,n)},C.prototype.getVideoStream=function(e,t,i,n){this.requestStream(this.type.video,e,t,i,!1,n)},C.prototype.getScreenShareStream=function(e,t,i,n){this.displayMediaSupported?this.requestStream(this.type.screen,e,t,i,!0,n):(i={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:sourceId}}},this.requestStream(this.type.screen,e,t,i,!1,n))},C.prototype.getStreamByType=function(e){return this.streams?this.streams[e]:null},C.prototype.getScreenSharePermissionWithAudio=function(){},C.prototype.getAudioPermission=function(e,t){this.getPermission(this.type.audio,e,t)},C.prototype.getVideoPermission=function(e,t){this.getPermission(this.type.video,e,t)},C.prototype.getPermission=function(e,t,i){navigator.permissions.query({name:e}).then(function(e){"function"==typeof t&&t(e.state)}).catch(function(e){"function"==typeof i&&i(e)})},C.prototype.setType=function(e,t){var i="";return(i=e.salesiq?i:e.salesiq={})._type=t,i},C.prototype.getTypeFromStream=function(e){return e&&e.salesiq&&e.salesiq._type?e.salesiq._type:null},C.prototype.closeAllStream=function(){for(var e in this.streams)this.closeStream(e)},C.prototype.closeStreamByType=function(e){this.closeStream(e)},C.prototype.closeStream=function(e){var t=this.streams?this.streams[e]:null;if(t){var i,n=t.getTracks();for(i in n)n[i].stop();this.streams[e]=null}},C.prototype.toggleMute=function(){var e=this.streams[this.type.audio];e.getAudioTracks()[0].enabled=!e.getAudioTracks()[0].enabled,this.container.commonImpl.sendMediaActivity({param:{action_type:e.getAudioTracks()[0].enabled?w.activity.MEDIA_AUDIO_UNMUTE:w.activity.MEDIA_AUDIO_MUTE}})},C.prototype.screenEndFromBrowserUI=function(e){this.isDesktopApp()||(this.streams[this.type.screen].getVideoTracks()[0].onended=function(){e()})},C.prototype.getUserMediaDetail=function(){return navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||null},C.prototype.getTracksId=function(){var e,t={};for(e in this.streams)t[e]=this.streams[e]&&this.streams[e].id;return t},C.prototype.isDesktopApp=function(){return navigator.userAgent.includes(this.container.constants.Zoho_SalesIQ)},A.prototype.setBrowserName=function(){e=this.userAgent,t="unknown-unknown",-1<(e=(i=e).toLowerCase()).indexOf("msie")?t=(n=i.substring(i.indexOf("MSIE")).split(";")[0]).split(" ")[0].replace("MSIE","IE")+"-"+n.split(" ")[1]:-1<e.indexOf("edge")?t=i.substring(i.indexOf("Edge")).split(" ")[0].replace("/","-"):-1<e.indexOf("edg")?t=i.substring(i.indexOf("Edg")).split(" ")[0].replace("/","-").replace("Edg","Edge"):-1<e.indexOf("safari")&&-1<e.indexOf("version")?t=i.substring(i.indexOf("Safari")).split(" ")[0].split("/")[0]+"-"+i.substring(i.indexOf("Version")).split(" ")[0].split("/")[1]:-1<e.indexOf("opr")||-1<e.indexOf("opera")?-1<e.indexOf("opera")?t=i.substring(i.indexOf("Opera")).split(" ")[0].split("/")[0]+"-"+i.substring(i.indexOf("Version")).split(" ")[0].split("/")[1]:-1<e.indexOf("opr")&&(t=i.substring(i.indexOf("OPR")).split(" ")[0].replace("/","-").replace("OPR","Opera")):-1<e.indexOf("chrome")?t=i.substring(i.indexOf("Chrome")).split(" ")[0].replace("/","-"):-1<e.indexOf("firefox")&&(t=i.substring(i.indexOf("Firefox")).split(" ")[0].replace("/","-"));var e,t,i,n=[t,parseInt(t.split("-")[1])];this.browserName=n[0],this.browserVersion=n[1]},A.prototype.getBrowserName=function(){return this.browserName},A.prototype.getBrowserVersion=function(){return this.browserVersion},A.prototype.checkBrowserSupported=function(e){var t=this.browserName.split("-")[0].toLowerCase(),e=(this.browserSupported=!1,!e||e==w.audio?w.audioCallAllowedBrowserVersions:w.screenShareAllowedBrowserVersions);return this.browserSupported=e[t]&&this.browserVersion>=e[t],this.browserSupported},A.prototype.checkBrowserSupportedForStats=function(){var e=this.browserName.split("-")[0];return this.browserSupportedForStats=!1,"Chrome"!=e&&"Opera"!=e||(this.browserSupportedForStats=!0),this.browserSupportedForStats},A.prototype.getPlatform=function(){return this.platform},A.prototype.getClientSupport=function(){var e=this.container.MediaPermission,t={perfect_renegotiation:!0,multi_stream:!0,reconnection_policy:!0};return this.__isChrome()||this.__isSafari()||this.__isOpera()?e.displayMediaSupported||(t={perfect_renegotiation:!1,multi_stream:!1,reconnection_policy:!0}):this.__isFirefox()&&(t.perfect_renegotiation=!1),t},A.prototype.__isChrome=function(){return"Chrome"==this.browserName.split("-")[0]},A.prototype.__isFirefox=function(){return"Firefox"==this.browserName.split("-")[0]},A.prototype.__isSafari=function(){return"Safari"==this.browserName.split("-")[0]},A.prototype.__isOpera=function(){return"Opera"==this.browserName.split("-")[0]},A.prototype.isNotebookDSKApp=function(){return this.userAgent.includes("Notebook")},A.prototype.isSecure=function(){return-1<window.location.protocol.indexOf("https")},pe.prototype.get=function(e,t){this.getLocalKey(e);return this.data[e]},pe.prototype.set=function(e,t,i){this.getLocalKey(e);this.data[e]=t},pe.prototype.remove=function(e,t){this.getLocalKey(e);this.data[e]&&delete this.data[e]},pe.prototype.getLocalKey=function(e){return this.unique+e},he.prototype.init=function(e){this.rtc_router=new f(e),this.event_router=new de,this.media_router=new le(e),this.action_router=new ue(e),this.MediaPermission=new C(e),this.dataHandler=new pe(e),this.MediaDetails=new A(e),this.container.constants=w},he.prototype.route=function(e){if(!this.validateRouteObject(e))throw"Media Router Schema Mismatch";this.handle(e)},he.prototype.handle=function(e){try{var t=this[e.type+"_router"];t&&t.handle&&t.handle(e)}catch(e){}},he.prototype.validateRouteObject=function(t){var i={type:"string",useCase:"string",param:"object"},n=!0;return Object.keys(i).forEach(function(e){t[e]&&typeof t[e]==i[e]||(n=!1)}),n},b.prototype.init=function(){var e=this,t=this;this.routes={0:function(){return e.container.checkDirectCallOnload()},2:t.handleCustomMessage(),29:t.handleAVcall.bind(t),13:t.handleUserStatus.bind(t),113:t.chatEnded.bind(t),35:t.chatEnded.bind(this),114:t.handleInfoMessage.bind(this),14:t.checkForCallIcon.bind(this),15:t.checkForCallIcon.bind(this)}},b.prototype.chatEnded=function(e){var t=e.msg.chid;this.container.detailsHandler.getBody().find(".zsiq_media_headshot_main").remove(),this.container.mediaUIHandler.clearAudioCallInvite(t),this.checkForCallIcon(e),this.container.detailsHandler.clearBusyUI(),"content_moderation_end"==e.msg.msg.action&&this.endSupport(e)},b.prototype.handleMessage=function(e){var t,i,n=this.routes,a=typeof n[e.mtype];try{"function"==a?n[e.mtype].call(this,e):"object"==a&&(t=this.getModuleName(e),"function"==typeof(i=n[e.mtype][t])&&i.call(this,e))}catch(e){}},b.prototype.handleCustomMessage=function(e){return{addvisitor:this.showInvitation,acctranschat:this.endCall,closetransfer:this.checkForCallIcon,pickupsupport:this.handlePicksupport,leavesupport:this.endSupport,missedvisitor:this.missedDirectCall,joinsupport:this.joinsupport}},b.prototype.handlePicksupport=function(e){var t=e.msg,i=LSMessanger.getPrd()+"_"+$Support.getParent().$ZSIQWidget.getEmbedObject().pinfo.soid+"_"+t.attender;try{for(var n in SUPPORT_REPS[t.chid])n!=i&&delete SUPPORT_REPS[t.chid][n]}catch(e){}this.checkForCallIcon(e)},b.prototype.handleAVcall=function(e){e.msg.msg=JSON.parse(e.msg.msg),e.msg.msg.media||this.handleCallConfernce(e)},b.prototype.handleCallConfernce=function(e){e.msg.msg;this.container.router.route({type:"rtc",module:e.msg.msg.type,useCase:e.msg.msg.operation,param:e.msg})},b.prototype.getModuleName=function(t){return{2:"msg > module",114:"msg > msg > mode",700:"msg > msg > module"}[t.mtype].trim().split(/\s*\>\s*/g).forEach(function(e){return t=t[e]}),t},b.prototype.showInvitation=function(e){try{var t=e.msg,i=t.media;if(!i)return;var n,a,o="";for(a in i)o=(n=JSON.parse(i[a])).type;this.container.commonImpl.setWmsPushData(n.id,t),this.container[o+"Impl"].handleApiCallInvitation(n.id)}catch(e){}},b.prototype.missedDirectCall=function(e){var t=this.container,i=t.detailsHandler,n=t.commonImpl,a=e.msg,o=a.media;if(o)for(var s in o){var s=JSON.parse(o[s]),r=s.type,s=s.id,c=i.getChatIdByVisitorId(a.visitorid);n.setWmsPushData(s,{chatid:c,id:s,type:r}),this.container[r+"Impl"].handleCallCancel(s)}},b.prototype.checkForCallIcon=function(e){var t=this.container,e=e.msg,e=e.chatid||e.chid;e==ZSIQConversationManager.getcurrchatwinobj().RCHID&&t.detailsHandler.triggerIconCheck(e),t.detailsHandler.isGroupConversation(e)&&this.container.detailsHandler.clearBusyUI()},b.prototype.endSupport=function(e){var t,i=this.container,n=i.detailsHandler,a=i.commonImpl,o=i.mediaUIHandler,s=i.MediaPermission,r=i.screenShareImpl,c=i.audioImpl,i=i.constants,e=e.msg,e=e.chatid||e.chid,d=a.getMediaIdByChid(e),l=d&&a.getCallStatusData(d);0<Object.keys(l).length&&(t={type:l=l.type,chid:e,media_id:d},a.setWmsPushData(d,{chatid:e,type:l}),o.updateCallInvitationState(l,t,i.ended),o.clearAudioCallInvite(l,d),r.handleAudioCallEnd(e),c.handleAudioCallEnd(d),this.container[l+"Impl"].clearData(d)),s.closeAllStream(),n.removeAudioCallIcon(e),a.stopNotificationSound(),a.checkAndPlayNotification()},b.prototype.disableAvIcons=function(){},b.prototype.endCall=function(e){try{var t=this.container,i=e.msg,n=i.chatid||i.chid;t.commonImpl.endCallByChid(n),this.checkForCallIcon(e)}catch(e){}},b.prototype.handleUserStatus=function(e){this.checkForCallIcon(e)},b.prototype.joinsupport=function(e){this.checkForCallIcon(e),this.container.commonImpl.checkOnGoingCall()},b.prototype.handleInfoMessage=function(e){this.checkForCallIcon(e),"acctranschat"==e.msg.module&&this.container.detailsHandler.clearBusyUI()},E.prototype.handleAudioCallInvite=function(e,t){this.container.uiHandler.handleAudioCallInvite(e,t)},E.prototype.handleAudioCallInitiate=function(e,t){this.container.uiHandler.handleAudioCallInitiate(e,t)},E.prototype.handleCallMonitorUIInitiate=function(e,t){this.container.uiHandler.handleCallMonitorUIInitiate(e,t)},E.prototype.handleCallMonitorConnected=function(e,t){this.container.uiHandler.handleCallMonitorConnected(e,t)},E.prototype.handleCallMonitorUIJoin=function(e,t){this.container.uiHandler.handleCallMonitorUIJoin(e,t)},E.prototype.handleCallMonitorJoinConnected=function(e,t){this.container.uiHandler.handleCallMonitorJoinConnected(e,t)},E.prototype.clearAudioCallInvite=function(e,t){this.container.uiHandler.clearAudioCallInvite(e,t)},E.prototype.updateCallInvitationState=function(e,t,i){this.container.uiHandler.updateCallInvitationState(e,t,i)},E.prototype.mediaPermissionUI=function(e){return this.container.uiHandler.mediaPermissionUI(e)},E.prototype.mediaPermissionUnlock=function(e){return this.container.uiHandler.mediaPermissionUnlock(e)},E.prototype.showDialog=function(e){this.container.uiHandler.showDialog(e)},E.prototype.handleCallClash=function(e,t){this.container.uiHandler.handleCallClash(e,t)},E.prototype.deleteScreenShareState=function(e){this.container.uiHandler.deleteScreenShareState(e)},E.prototype.showScreenShareInvitation=function(e){this.container.uiHandler.showScreenShareInvitation(e)},E.prototype.makeScreenShareConnected=function(e,t){this.container.uiHandler.makeScreenShareConnected(e,t)},E.prototype.makeScreenShareConnecting=function(e,t){this.container.uiHandler.makeScreenShareConnecting(e,t)},E.prototype.showScreenShareMaking=function(e,t){this.container.uiHandler.showScreenShareMaking(e,t)},E.prototype.playScreenShareStream=function(e){this.container.uiHandler.playScreenShareStream(e)},E.prototype.getCurrentScreenshareType=function(e){return this.container.uiHandler.getCurrentScreenshareType(e)},E.prototype.stopTimer=function(e){this.container.uiHandler.stopTimer(e)},E.prototype.clearAllStates=function(e){this.container.uiHandler.clearAllStates(e)},E.prototype.getUIState=function(){return this.container.uiHandler},E.prototype.enableOutingCallUI=function(){this.container.uiHandler.enableOutingCallUI()},E.prototype.deletePlayer=function(e){this.container.uiHandler.deletePlayer(e)},E.prototype.directCallCancelled=function(){this.container.uiHandler.directCallCancelled()},E.prototype.exitFullScreenMode=function(){this.container.uiHandler.exitFullScreenMode()},E.prototype.getAvailableDevices=function(){return this.container.MediaPermission.getAvailableDevices()},E.prototype.updateMediaDevices=function(e){this.container.MediaPermission.updateMediaDevices(e)},E.prototype.startAudioCall=function(e){this.container.audioImpl.startAudioCall(e)},E.prototype.__isSmartFlow=function(e){var t=this.container,i=t.commonImpl,t=(t.screen_share_smartImpl,t.audioImpl,i.getCallStatusData(e));return!(!t.type.includes("unified")&&!t.type.includes("smart"))},E.prototype.initCallRequest=function(e){this.__isSmartFlow(e.mid)&&(e.negotiationType==w.screen_share&&(e.negotiationType=w.screen_share_smart),e.negotiationType==w.audio&&(e.negotiationType=w.audio_unified_mix)),this.container.audioImpl.initCallRequest(e)},E.prototype.addScreenShareTrack=function(e){this.__isSmartFlow(e.id)?this.addScreenTrackInConference():this.container.audioImpl.addScreenShareTrack(e)},E.prototype.addScreenTrackInConference=function(){this.container.screen_share_smartImpl.addScreenTrackInConference()},E.prototype.getAudioInputDevice=function(){return this.container.audioImpl.getAudioInputDevice()},E.prototype.getCurrentStreamDeviceId=function(){return this.container.audioImpl.getCurrentStreamDeviceId()},E.prototype.getAudioOutputDevice=function(){return this.container.audioImpl.getAudioOutputDevice()},E.prototype.changeAudioPlayer=function(e,t){var i=this.container.commonImpl.getActiveMediaID(t);this.__isSmartFlow(i)?this.container.audioImpl.changeUnifiedAudioPlayer(e,i):this.container.audioImpl.changeAudioPlayer(e,t)},E.prototype.changeAudioInputDevice=function(e,t,i){var n=this.container.commonImpl.getActiveMediaID(t);this.__isSmartFlow(n)?this.container.audioImpl.changeUnifiedAudioInputDevice(e,n,i):this.container.audioImpl.changeAudioInputDevice(e,t,i)},E.prototype.isWaitingForPermission=function(){return this.container.audioImpl.isWaitingForPermission},E.prototype.getScreenShareType=function(e,t){return this.container.screenShareImpl.getScreenShareType(e,t)},E.prototype.handleUIRequestCancel=function(e,t,i){this.container.screenShareImpl.handleUIRequestCancel(e,t,i)},E.prototype.swapScreenShare=function(e){var t=this.container,i=t.commonImpl,t=t.screenShareImpl,i=i.getCallStatusData(e.id);i.type.includes("unified")||i.type.includes("smart")?t.swapUnifiedScreenShare(e):t.swapScreenShare(e)},E.prototype.startScreenShare=function(e){this.container.screenShareImpl.startScreenShare(e)},E.prototype.sendMediaActivity=function(e){this.container.commonImpl.sendMediaActivity(e)},E.prototype.checkCallHostType=function(e){return this.container.commonImpl.checkCallHostType(e)},E.prototype.getActiveTab=function(){return this.container.commonImpl.getActiveTab()},E.prototype.getCallUIPosition=function(){return this.container.commonImpl.getCallUIPosition()},E.prototype.setCallUIPosition=function(e,t){this.container.commonImpl.setCallUIPosition(e,t)},E.prototype.removeCallUIPosition=function(){this.container.commonImpl.removeCallUIPosition()},E.prototype.getActiveMediaID=function(e){return this.container.commonImpl.getActiveMediaID(e)},E.prototype.getActiveCallData=function(){return this.container.commonImpl.getActiveCallData()},E.prototype.endCallByChid=function(e){this.container.commonImpl.endCallByChid(e)},E.prototype.isOldUI=function(){return this.container.detailsHandler.isOldUI()},E.prototype.isEmbed=function(){return this.container.detailsHandler.isEmbed()},E.prototype.isAudioCallEnabled=function(){return this.container.detailsHandler.isAudioCallEnabled()},E.prototype.isScreenShareEnabled=function(){return this.container.detailsHandler.isScreenShareEnabled()},E.prototype.isScreenShareAllowed=function(){return this.container.detailsHandler.isScreenShareAllowed()},E.prototype.isCallInitiatedFromOldUI=function(e){return this.container.detailsHandler.isCallInitiatedFromOldUI(e)},E.prototype.isMobileOperator=function(e){return this.container.detailsHandler.isMobileOperator(e)},E.prototype.isMobileVisitor=function(e){return this.container.detailsHandler.isMobileVisitor(e)},E.prototype.getChatWinObjById=function(e){return this.container.detailsHandler.getChatWinObjById(e)},E.prototype.getDecodedText=function(e){return this.container.detailsHandler.getDecodedText(e)},E.prototype.getEscapedText=function(e){return this.container.detailsHandler.getEscapedText(e)},E.prototype.getBody=function(){return this.container.detailsHandler.getBody()},E.prototype.getMediaActivityAddInfo=function(){return this.container.detailsHandler.getMediaActivityAddInfo()},E.prototype.clearConformBox=function(){this.container.detailsHandler.clearConformBox()},E.prototype.initMissedChat=function(e,t,i,n){this.container.detailsHandler.initMissedChat(e,t,i,n)},E.prototype.isChatExist=function(e){return this.container.detailsHandler.isChatExist(e)},E.prototype.getAttenderId=function(e){return this.container.detailsHandler.getAttenderId(e)},E.prototype.getSupportRepCount=function(e){return this.container.detailsHandler.getSupportRepCount(e)},E.prototype.playNotifSound=function(e){this.container.detailsHandler.playNotifSound(e)},E.prototype.stopNotifSound=function(){this.container.detailsHandler.stopNotifSound()},E.prototype.getEncryChid=function(e){return this.container.detailsHandler.getEncryChid(e)},E.prototype.triggerIconCheck=function(e){this.container.detailsHandler.triggerIconCheck(e)},E.prototype.getCurrentOpenChat=function(){return this.container.detailsHandler.getCurrentOpenChat()},E.prototype.focusChatWindow=function(e){this.container.detailsHandler.focusChatWindow(e)},E.prototype.focusCallWindow=function(e){this.container.detailsHandler.focusCallWindow(e)},E.prototype.canShowAudioCallInvitation=function(e){return this.container.detailsHandler.canShowAudioCallInvitation(e)},E.prototype.joinChat=function(e){this.container.detailsHandler.joinChat(e)},E.prototype.getVisitorName=function(e){return this.container.detailsHandler.getVisitorName(e)},E.prototype.getVisitorID=function(e){return this.container.detailsHandler.getVisitorID(e)},E.prototype.onGoingMediaDetails=function(){return this.container.detailsHandler.onGoingMediaDetails()},E.prototype.isMediaRecordingEnabledForChat=function(e){return this.container.detailsHandler.isMediaRecordingEnabledForChat(e)},E.prototype.checkIsChatEndTimerAlive=function(e){return this.container.detailsHandler.checkIsChatEndTimerAlive(e)},E.prototype.isRecordingON=function(){return this.container.detailsHandler.isRecordingON()},E.prototype.isSecure=function(){return this.container.MediaDetails.isSecure()},E.prototype.isVisitorSecure=function(e){return this.container.detailsHandler.isVisitorFromHttps(e)},E.prototype.isSwapState=function(){return this.container.commonImpl.getSwapRequestCallbackState()},E.prototype.getMediaIdByChid=function(e){return this.container.commonImpl.getMediaIdByChid(e)},E.prototype.getCallStatusData=function(e){return this.container.commonImpl.getCallStatusData(e)},E.prototype.openChatWindow=function(e,t){this.container.detailsHandler.openChatWindow(e,t)},E.prototype.closeChatWindow=function(e){this.container.detailsHandler.closeChatWindow(e)},E.prototype.clearChatWindow=function(){return this.container.detailsHandler.clearChatWindow()},E.prototype.isSSChatEnabled=function(){return this.container.detailsHandler.getIsSSChatEnabled()},E.prototype.addFullScreenClass=function(){this.container.detailsHandler.addFullScreenClass()},E.prototype.removeFullScreenClass=function(){this.container.detailsHandler.removeFullScreenClass()},E.prototype.clearConsentUIState=function(e){this.container.uiHandler.clearConsentState(e)},E.prototype.showScreenShareConsentUI=function(e){this.container.screenShareImpl.showConsentUI(e,!1)},E.prototype.isScreenConsentAllowed=function(){return this.container.screenShareImpl.isConsentBannerAccepted()},E.prototype.getMediaRecordingConsentDetails=function(){return this.container.detailsHandler.getMediaRecordingConsentDetails()},E.prototype.isScreenRecordingEnabled=function(){return this.container.detailsHandler.isScreenRecordingEnabled()},E.prototype.isScreenRecordAllowed=function(){return this.container.detailsHandler.isScreenRecordAllowed()},E.prototype.canShowOperatorImage=function(){return this.container.detailsHandler.canShowOperatorImage()},E.prototype.isOnlyCallConfEnabled=function(){return this.container.detailsHandler.isOnlyCallConfEnabled()},E.prototype.endSession=function(e){this.container.detailsHandler.endSession(e)},E.prototype.getCountryNameFromCCode=function(e){return this.container.detailsHandler.getCountryNameFromCCode(e)},E.prototype.getVisitorDisplayName=function(e,t,i){return this.container.detailsHandler.getVisitorDisplayName(e,t,i)},E.prototype.isVisitorSharing=function(e,t){return this.container.commonImpl.isVisitorSharing(e,t)},E.prototype.updateMonitorData=function(e,t){return this.container.uiHandler.updateMonitorData(e,t)},E.prototype.requestScreenShareWhileViewing=function(e){return this.container.uiHandler.requestScreenShareWhileViewing(e)},E.prototype.getRequestingWhileViewingState=function(){return this.container.commonImpl.getRequestingWhileViewingState()};k.prototype.updateState=function(e){e&&(this.state=e);try{this.reRender()}catch(e){}},k.prototype.reRender=function(){var e;this.dom&&1==this.dom.nodeType?this.dom=J(this.dom,this.render(),this.placeholder,this):(e=m(this.render(),this),this.dom&&$(this.dom).replaceWith(e),this.dom=e,this.embed?e&&e.className&&e.className.includes("zsiq_media_videomain")?e&&V(e,this.frameout):this.disableDrag||Z(e,this.frameout):this.disableDrag||1!=e.nodeType||$(e).draggable({containment:"window",scroll:!1})),this.dom&&!this.dom.parentNode&&(this.placeholder_prepend?$(this.placeholder).prepend(this.dom):$(this.placeholder).append(this.dom))},k.prototype.destroy=function(){$(this.dom).remove()},k.prototype.getMediaCallUI=function(){try{var e,t=this.state,i=t.name,n=t.url,a=t.audio,o=t.chid,s=(t.timer,t.consent,t.screen_share),r=(a&&(e=a.media_id),s&&(e=s.media_id),n&&n(e)?I("img",{src:n(e,o),alt:i?i(o):"Operator",draggable:"false"}):I("em",{class:"sqico-person"}),i(o));r&&r[0].toLowerCase(),this.container.commonImpl.isSmartFlow(e);return I("div",{class:"siqdc-home"},I("div",{class:"siqdc-homehdr"},i&&i(o)||""),I("p",{class:"siqdc-homedec"},a?ve(this.state,this.__getAudioCallStatusPriorityInSS()):Se(this.state,!1)),this.__getMediaUIBtns())}catch(e){console.log(e)}},k.prototype.__getMediaUIBtns=function(){var e,t,i=this,n=this.state,a=n.handler,o=(n.name,n.url,n.screen_share),s=n.audio,r=n.chid,n=(s&&(e=s.status,C=s.media_id,t=s.mute),o&&(_=o.status,C=o.media_id),this.container.mediaUIHandler),c=this.isInvited(e),d=this.isConnected(e),l=this.isRequested(e),u=this.isConnecting(e),p=[this.constants.rejected,this.constants.cancelled,this.constants.missed].includes(status),h=n.isScreenShareAllowed(),m=o&&this.isConnected(_),_=o&&(this.isConnected(_)?this.constants.stopsharing:this.constants.cancel),g=d?this.constants.end:this.constants.cancel,f=!n.isCallInitiatedFromOldUI(C)&&!n.isMobileOperator(C),y=!n.isMobileVisitor(r),n=n.isSecure(),C=this.container.mediaUIHandler.isCallInitiatedFromOldUI(C),v=this.container.mediaUIHandler.isAudioCallEnabled();return I("div",{class:"siqdc-icons"},d||l||u?I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-"+(t?"sqico-muteaudio":"microphone")+" bg-aaa ",onclick:function(){return a(r,"audio","mute")}}),I("span",null,s&&U(t?"unmute":"mute"))):"",c?I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-call call-gbtn ",onclick:function(){return a(r,"audio","accept")}}),I("span",null,s&&U(this.constants.accept))):"",m&&!s&&v?I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-call call-gbtn ",onclick:this.__callCbk.bind(this)})," ",I("span",null,s&&U("call"))):"",s&&!p?I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-call call-rbtn ",onclick:function(){return a(r,"audio","reject")}}),I("span",null,s&&U(g))):"",!C&&s&&!o&&d&&h&&f&&y&&n?I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-screenshare bg-grn",onclick:function(){return i.container.uiHandler.shareScreen(r)}}),I("span",null,U("screenshare"))):"",C||!o||!this.isSharing(o.type)||this.isRequested(e)||this.isInvited(e)?"":I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-ssend bg-red",onclick:function(){return a(r,"screen_share","reject")}}),I("span",null,U(_))))};var me=function(a){function e(e,t,i,n){void 0===n&&(n=!1),this.state=e,this.placeholder=t,this.refs={},this.container=i,this.constants=i.constants,this.frameout=!0,this.screenShareAllowed=i.mediaUIHandler.isScreenShareAllowed(),this.isInviteOnly=n,this.isDummyImage=!0,a.call(this)}return a&&(e.__proto__=a),((e.prototype=Object.create(a&&a.prototype)).constructor=e).prototype.destroy=function(){this.ssTimer&&clearInterval(this.ssTimer),this.audioTimer&&clearInterval(this.audioTimer),$(this.dom).remove()},e.prototype.canStartSS=function(){return!this.state.screen_share},e.prototype.__callCbk=function(){_e(this.container,this.state.chid,this.embed)},e.prototype.getUI=function(){var e=this.state,t=e.audio,e=e.screen_share;return(!e||!this.isSharing(e.type)||this.isInviteOnly)&&(!t||e&&this.isViewing(e.type)&&(!this.isViewing(e.type)||this.isConnected(t.status)))?"":this.getMediaCallUI()},e.prototype.inviteCheck=function(){var e=this.state,t=e.screen_share,e=e.audio;return!this.isInviteOnly||t&&e&&this.isSharing(t.type)&&!this.isConnected(e.status)&&!this.isEnded(e.status)},e.prototype.render=function(){return!this.inviteCheck()||this.state.isDirectCall||document.querySelector("#call_Busy")?"":this.getUI()},e.prototype.__getAudioCallStatusPriorityInSS=function(){var e,t=this.state,i=t.screen_share,n=t.audio,t=t.timer;return n&&(e=n.status),!(t&&!i&&this.__isStatusNotConnected(e))&&!!(t&&!i||t&&!this.__isStatusNotConnected(e))},e.prototype.__isStatusNotConnected=function(e){return e!=this.constants.connected},e.prototype.isConnected=function(e){return e&&e==this.constants.connected},e.prototype.isConnecting=function(e){return e&&e==this.constants.connecting},e.prototype.isEnded=function(e){return e&&e==this.constants.ended},e.prototype.isInvited=function(e){return e&&e==this.constants.invited},e.prototype.isRequested=function(e){return e&&e==this.constants.requested},e.prototype.isSharing=function(e){return e&&e==this.constants.sharing},e.prototype.isViewing=function(e){return e&&e==this.constants.viewing},e.prototype.isReconnecting=function(e){return e&&e==this.constants.reconnecting},e.prototype.isRejected=function(e){return e&&e==this.constants.rejected},e.prototype.isMissed=function(e){return e&&e==this.constants.missed},e}(k);function _e(e,t,i){void 0===i&&(i=!0);var n={type:e.constants.audio,mode:e.constants.visitor,mediarequest:!0,mediainvitation:!0},a=e.mediaUIHandler.getChatWinObjById(t);i?$.extend(n,{chatid:a.chatID,wmsid:$Support.EmbedObj.vwmsid,lsuid:a.attender,lsid:$Support.getParent().$ZSIQWidget.getWidgetObject().lsid,normalchid:t,session_id:e.detailsHandler.getSessionID()}):$.extend(n,{chatid:t}),e.mediaUIHandler.startAudioCall(n)}var ge=function(n){function e(e,t,i){this.state=e,this.placeholder=t,this.refs={},this.container=i,this.constants=i.constants,this.showSSList=!1,this.showMoreOptions=!1,this.showSettings=!1,this.placeholder_prepend=!0,this.moreOptionsUIPosition={right:"0"},this.init(),n.call(this)}return n&&(e.__proto__=n),((e.prototype=Object.create(n&&n.prototype)).constructor=e).prototype.init=function(){this.fullscreen=!1,this.showcntrl=!1,this.frameout=!0,this.switchCbk=this.switchFullscreen.bind(this)},e.prototype.switchFullscreen=function(e){"keyup"==e.type&&"Escape"!=e.key||(this.fullscreen=!this.fullscreen,this.fullscreen?$Support.getParent().document.addEventListener(this.constants.keyup,this.switchCbk):$Support.getParent().document.removeEventListener(this.constants.keyup,this.switchCbk),this.reRender())},e.prototype.getAudioCallBox=function(){var e=this.state,t=e.audio,i=e.handler,n=e.chid,a=e.name,e=e.url,o=this.embed?"siqico":"sqico",s=t&&(this.isConnected(t.status)?this.constants.end:this.constants.cancel);return I("div",{class:"zsiq_calldtl"},I("span",null,e&&e(t.media_id)?I("img",{src:e(t.media_id,n),alt:a?a(n):"Operator",class:"siquserimg"}):I("em",{class:o+"-user"}),I("em",{class:"zsiq_caller txtelips"},a(n))),I("span",null,ve(this.state),t&&this.isConnected(t.status)?I("em",{title:U(t.mute?"unmute":"mute"),class:o+"-"+(t.mute?"unmute":"mute")+" zsiq_ctrlico",onClick:function(){return i(n,"audio","mute")},"data-type":"mic"}):"",t&&this.isInvited(t.status)?I("em",{title:U("accept"),class:o+"-end zsiq_vend zsiq_ctrlico zsiq_callin",onclick:function(){return i(n,"audio","accept")}}):"",I("em",{title:U(s),class:o+"-end zsiq_vend zsiq_ctrlico",onclick:function(){return i(n,"audio","reject")}}),I("em",null)))},e.prototype.showCntrl=function(){var e=this;this.showcntrl=!0,clearTimeout(this.showCntrlTimer),this.showCntrlTimer=setTimeout(function(){e.showcntrl=!1,e.reRender()},1500),this.__swapHandlerClickCbk(),this.reRender()},e.prototype.__swapHandlerClickCbk=function(){this.swapOptions&&($(this.swapOptions).remove(),this.swapOptions=null)},e.prototype.__swapHandler=function(e,n,t){function i(e,t,i){n(e,t,i),o()}var a=this,o=function(){return a.__swapHandlerClickCbk.call(a)};if(this.swapOptions)return o();this.swapOptions=m(I("div",{class:"zsiqcalloptions",id:"calloptions",style:"left:"+(e.clientX-220)+";top:"+(e.clientY-65)+";height:65px;z-index:11111111111;",onMouseLeave:this.__swapHandlerClickCbk.bind(this)},I("div",{onClick:function(){return i(t,"screen_share","swap")}},LSResource.getRealValue("screenshare.sharemyscreen")),I("div",{onClick:function(){return i(t,"screen_share","reject")}},LSResource.getRealValue("screenshare.endscreen")))),this.placeholder.append(this.swapOptions)},e.prototype._SwapList=function(e,t,i){this.embed&&this.state.audio&&!this.fullscreen?this.__swapHandler(e,t,i):t(i,"screen_share","swap")},e.prototype.__showMoreOptions=function(){var e,t=this;this.showMoreOptions||(e=function(){t.showMoreOptions=!1,t.updateState(),parent.document.removeEventListener(t.constants.click,e)},this.showMoreOptions=!0,setTimeout(function(){return parent.document.addEventListener(t.constants.click,e)}),this.updateState())},e.prototype.__showSettings=function(){var e,t=this;this.showSettings||(e=function(){t.showSettings=!1,t.updateState(),parent.document.removeEventListener(t.constants.click,e)},this.showSettings=!0,setTimeout(function(){return parent.document.addEventListener(t.constants.click,e)}),this.updateState())},e.prototype.__showDropDownList=function(){var e,t=this;this.getCallBarUIPosition(),this.showSSList||(e=function(){t.showSSList=!1,t.updateState(),parent.document.removeEventListener(t.constants.click,e)},this.showSSList=!0,setTimeout(function(){return parent.document.addEventListener(t.constants.click,e)}),this.updateState())},e.prototype.getCallBarUIPosition=function(){var e=this.container.uiHandler.getUIPosition(".zsiq_media_videomain");e.width<570&&e.left<100?this.moreOptionsUIPosition.right="auto":this.moreOptionsUIPosition.right="0"},e.prototype.__callCbk=function(){_e(this.container,this.state.chid,this.embed)},e.prototype.getScreenShareButtons=function(){var e,t,i=this.state,n=i.screen_share,a=i.audio,o=i.handler,s=i.chid,i=i.chatWinFocused,r=(a&&(e=a.mute,t=a.status),this.isConnected(t)),c=n.status,d=n.type,c=this.isConnected(c),l=n&&(c?this.constants.stopsharing:this.constants.cancel),u=a&&(r?this.constants.end:this.constants.cancel),p=this.container.mediaUIHandler.isAudioCallEnabled(),h=a&&[this.constants.invited,this.constants.requested,this.constants.connecting,this.constants.cancelled,this.constants.rejected,this.constants.missed].includes(t),m=this.container.mediaUIHandler.isScreenShareAllowed();return I("div",{class:"zsiq_media_videofoot"},a||m?I("div",{class:"zsiq_media_posrel"},c&&!h?I("div",{class:"zsiqmico-more zsiq_media_wbtn",title:U("options"),onMouseUp:this.__showDropDownList.bind(this)}):"",I("div",{class:"zsiq_media_options",style:(this.showSSList?"display:block;":"display:none;")+" right : "+this.moreOptionsUIPosition.right+";"},m?I("div",{class:"zsiq_media_option_li",onclick:function(){return o(s,"screen_share","swap")}},LSResource.getRealValue("screenshare.sharemyscreen")):"",a&&n&&this.isViewing(d)?I("div",{class:"zsiq_media_option_li zsiq_media_red",onclick:function(){return o(s,"screen_share","reject")}},LSResource.getRealValue("screenshare.endscreen")):"")):"",c&&h?I("div",{class:"zsiqmico-more zsiq_media_wbtn zsiq_media_disable"}):"",I("span",{class:"zsiqmico-chat zsiq_media_wbtn",style:"display:none;"}),this.embed&&a&&(r||this.isConnecting(t)||this.isRequested(t))&&!h?I("div",{class:(e?"zsiqmico-unmute":"zsiqmico-mute")+" zsiq_media_wbtn zsiq_media_mL13",title:U(e?"unmute":"mute"),onClick:function(){return o(s,"audio","mute")}}):"",(this.embed||this.fullscreen||!i)&&!a&&c&&p?I("span",{title:U("call"),class:"zsiqmico-pickcall zsiq_media_gbtn zsiq_media_mL13",onclick:this.__callCbk.bind(this)}):"",this.embed&&a&&h?I("span",{class:"zsiqmico-pickcall zsiq_media_gbtn zsiq_media_mL13 zsiq_media_disable"}):"",this.embed&&a&&r?I("span",{title:U(u),class:"zsiqmico-endcall zsiq_media_rbtn zsiq_media_mL13",onclick:function(){return o(s,"audio","reject")}}):"",this.embed&&!a&&n&&this.isViewing(d)?I("div",{class:"zsiqmico-endscreenshare zsiq_media_rbtn zsiq_media_mL13",title:U(l),onclick:function(){return o(s,"screen_share","reject")}}):"")},e.prototype.getUI=function(){var e=this,t=this.state,i=t.screen_share,n=t.timer,t=(t.chid,i?i.stream:""),a=this.container.mediaUIHandler.isScreenRecordAllowed()&&this.container.mediaUIHandler.isScreenRecordingEnabled()&&this.container.commonImpl.isSmartFlow(i.media_id);return t?I("div",{class:"zsiq_media_videomain "+(this.fullscreen?"zsiq-media-maxscreen":"zsiq-media-minscreen")+" "+(this.showcntrl||!n?"zsiq_showcntl":"")+" ",onMouseMove:this.showCntrl.bind(this),onMouseOver:this.showCntrl.bind(this),onMouseDown:this.__swapHandlerClickCbk.bind(this)},this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_top_left_corner",position:"top_left_corner"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_top_border",position:"top_border"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_top_right_corner",position:"top_right_corner"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_right_border",position:"right_border"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_bottom_right_corner",position:"bottom_right_corner"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_bottom_border",position:"bottom_border"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_bottom_left_corner",position:"bottom_left_corner"}),this.fullscreen?"":I("div",{enable_resize:!0,class:"zsiq_drag-handle zsiq_left_border",position:"left_border"}),I("div",{class:"zsiq_media_videohdr"},I("div",{class:"zsiq_media_videotime"},n&&a?I("em",{title:U("recording"),class:"zsiqmico-record zsiq_media_mR10",style:"cursor: pointer;"}):"",Se(this.state)),I("div",{class:"zsiq_media_videohdrico"},I("span",{class:"zsiqmico-settings",style:"display:none;"}),I("span",{class:this.fullscreen?"zsiqmico-minscreen":"zsiqmico-maxscreen",onclick:this.switchFullscreen.bind(this)}))),this.getScreenShareButtons(),I("div",null,I("video",{autoplay:!0,name:"media",srcObject:t,class:this.isReconnecting(i.status)?"zsiq_media_blur":"",onloadedmetadata:function(){return e.metadata=!0}})),"reconnecting"!=i.status&&this.metadata?"":I("div",{class:"zsiq_media_vloader"})):""},e.prototype.render=function(){var e=this.state,t=e.screen_share,e=e.audio;return t&&this.isViewing(t.type)&&!this.isRequested(t.status)||e&&this.isConnected(e.status)?this.getUI():""},e.prototype.isConnected=function(e){return e&&e==this.constants.connected},e.prototype.isConnecting=function(e){return e&&e==this.constants.connecting},e.prototype.isEnded=function(e){return e&&e==this.constants.ended},e.prototype.isInvited=function(e){return e&&e==this.constants.invited},e.prototype.isRequested=function(e){return e&&e==this.constants.requested},e.prototype.isSharing=function(e){return e&&e==this.constants.sharing},e.prototype.isViewing=function(e){return e&&e==this.constants.viewing},e.prototype.isReconnecting=function(e){return e&&e==this.constants.reconnecting},e.prototype.isRejected=function(e){return e&&e==this.constants.rejected},e.prototype.isMissed=function(e){return e&&e==this.constants.missed},e}(k);function fe(){var e=getBrowserFromUserAgent(navigator.userAgent).split("-")[0],t={Chrome:"https://support.google.com/chrome/answer/2693767?hl=en",Firefox:"https://support.mozilla.org/en-US/questions/1168156",Opera:"https://help.opera.com/en/latest/web-preferences/#microphone",Safari:"https://support.apple.com/en-in/guide/safari/websites-ibrwe2159f50/mac"};t[e]&&window.open(t[e],"_blank")}var ye=function(n){function e(e,t,i){this.state=e,this.placeholder=t,this.refs={},this.container=i,this.constants=this.container.constants,this.disableDrag=!0,this.placeholder_prepend=!0,n.call(this)}return n&&(e.__proto__=n),((e.prototype=Object.create(n&&n.prototype)).constructor=e).prototype.getAudioCallStatusText=function(){var e=this.state.audio.status,t=this.state.timer;return{timer:t,connected:LSResource.getRealValue("common.connected"),invited:LSResource.getRealValue("av.info.calling"),connecting:LSResource.getRealValue("av.info.connecting"),ended:LSResource.getRealValue("common.ended"),cancelled:LSResource.getRealValue("av.info.cancelled"),rejected:LSResource.getRealValue("common.declined"),requested:LSResource.getRealValue("audiovideo.ringing"),missed:LSResource.getRealValue("common.missed"),reconnecting:LSResource.getRealValue("common.reconnecting"),initiated:LSResource.getRealValue("audiovideo.ringing"),mediapermission:LSResource.getRealValue("av.info.waitingformediapermission")}[t?"timer":e]||""},e.prototype.getUI=function(){var e=this,t=this.state,i=t.url,n=t.handler,a=t.name,o=t.chid,s=t.audio,t=t.screen_share,r=s&&s.status,c=(t&&t.status,-1==["initiated","requested"].indexOf(r)&&i&&i(s.media_id,o)||$Support.EmbedObj.clogo,"initiated"==r),d="mediapermission"==r,i=this.container.mediaUIHandler.isScreenShareAllowed(),l=this.container.mediaUIHandler.isCallInitiatedFromOldUI(s.media_id),u=t&&t.type==this.constants.viewing;return $Support.getParent().$zoho.salesiq.floatwindow.visible("show"),u&&($Support.getParent().$zoho.salesiq.floatwindow.visible("hide"),$Support.getParent().$zoho.salesiq.floatbutton.visible("hide")),I("div",{class:"siqdc-home"},I("div",{class:"siqdc-homehdr"},a&&a(o)||""),I("p",{class:"siqdc-homedec"},this.getAudioCallStatusText()),I("div",{class:"siqdc-icons"},I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-"+(s.mute?"sqico-muteaudio":"microphone")+" bg-aaa "+(d?"cmn_disable":""),onclick:function(){return d?"":n(o,"audio","mute")}}),I("span",null,s&&U(s.mute?"unmute":"mute"))),I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-call call-rbtn "+(c||d?"cmn_disable":""),onclick:function(){return c||d?"":n(o,"audio","reject")}}),I("span",null,s&&U(r==this.constants.connected?"end":"cancel"))),!l&&s&&r==this.constants.connected&&i&&!t?I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-screenshare bg-grn",onclick:function(){return e.container.uiHandler.shareScreen(o)}}),I("span",null,U("screenshare"))):"",!l&&t&&t.type==this.constants.sharing?I("span",{class:"siqdc-iconsub"},I("em",{class:"sqico-ssend bg-red",onclick:function(){return n(o,"screen_share","reject")}}),I("span",null,U("stopsharing"))):""))},e.prototype.render=function(){var e=this.state,t=e.isDirectCall,i=e.audio;e.status;return t&&i?this.getUI():""},e}(k);function U(e){var t={mute:LSResource.getRealValue("av.info.mute"),unmute:LSResource.getRealValue("av.info.unmute"),end:LSResource.getRealValue("common.end"),reject:LSResource.getRealValue("common.reject"),screenshare:LSResource.getRealValue("common.screenshare"),swap:LSResource.getRealValue("av.info.swap"),call:LSResource.getRealValue("av.info.call"),cancel:LSResource.getRealValue("common.cancel"),accept:LSResource.getRealValue("common.accept"),stopsharing:LSResource.getRealValue("av.info.endscreen"),options:LSResource.getRealValue("av.info.options"),recording:LSResource.getRealValue("av.info.recording")};return t[e]||""}function Ce(e){try{var t=e.consent;return m(I("div",{class:"dc-ratingpop",id:"onlycallconsent"},I("div",null,t.desc),I("div",{class:"btndiv"},I("span",{class:"updatebtn",onclick:t.accept_cbk},t.type==w.screen?LSResource.getRealValue("common.share"):LSResource.getRealValue("common.gdpr.agent.accept")),I("span",{class:"c666 curP","data-type":"cancel",onclick:t.reject_cbk},LSResource.getRealValue("common.decline")))))}catch(e){}}function ve(e,t){void 0===t&&(t=!0);var i=e.audio.status,e=e.timer;return t="reconnecting"!=i&&t,{timer:I("span",{class:"call-time-embed"},e),connected:LSResource.getRealValue("common.connected"),invited:LSResource.getRealValue("av.info.calling"),connecting:LSResource.getRealValue("av.info.connecting"),ended:LSResource.getRealValue("common.ended"),cancelled:LSResource.getRealValue("av.info.cancelled"),rejected:LSResource.getRealValue("common.declined"),requested:LSResource.getRealValue("audiovideo.ringing"),missed:LSResource.getRealValue("common.missed"),reconnecting:LSResource.getRealValue("common.reconnecting"),failed:LSResource.getRealValue("av.info.failed")}[e&&t?"timer":i]||""}function Se(e,t){void 0===t&&(t=!0);var i=e.screen_share.status,e=e.timer;return t="reconnecting"!=i&&t,{timer:I("span",{class:"call-time-embed"},e),connected:LSResource.getRealValue(t?"common.connected":"ss.info.viewing"),invited:LSResource.getRealValue("av.info.calling"),connecting:LSResource.getRealValue("av.info.connecting"),ended:LSResource.getRealValue("common.ended"),cancelled:LSResource.getRealValue("av.info.cancelled"),rejected:LSResource.getRealValue("common.declined"),requested:LSResource.getRealValue("audiovideo.ringing"),missed:LSResource.getRealValue("common.missed"),reconnecting:LSResource.getRealValue("common.reconnecting"),failed:LSResource.getRealValue("screenshare.info.failed")}[e&&t?"timer":i]||""}function T(e){return SiqAVRouter.container.mediaUIHandler.getChatWinObjById(e)}function Ie(e,t){void 0===e&&(e=0);var i=SiqAVRouter.container.mediaUIHandler,t=T(t).attenderimagefkey,e=_SCHEMA+"://"+_EMBEDSERVERURL+"/"+_SCREENNAME+"/userimg/"+t+"/photo.ls?mid="+e,i=i.canShowOperatorImage();return JSON.parse(i)&&t?e:$Support.EmbedObj.clogo}function M(e){return SiqAVRouter.container.mediaUIHandler.getDecodedText(q[e])||""}function O(e){var t=this;this.container=e,this.invitations=null,this.ss_invitation={},this.states={},window.onbeforeunload=function(){if(e.commonImpl.updateMediaCache(w.siq_directcall,w.is_refreshed,!0),e.commonImpl.updateMediaCache(w.siq_unifiedMedia,w.is_refreshed,!0),Object.keys(t.states).length)return""},this.siqdom=document.createElement("div"),this.siqdom.setAttribute("class","siq_media"),this.siqdom.setAttribute("data-id","zsalesiq"),this.container.mediaUIHandler.getBody()[0].appendChild(this.siqdom)}var q={};function H(){return SiqAVRouter.container.mediaUIHandler.isEmbed()?$(parent.document.body):$("body")}O.prototype.initiateHeadshot=function(e,t){this.states[e]||(this.states[e]={chid:e,isDirectCall:t},this.states[e].headshot=new me(this.states[e],document.querySelector(".onlycall_main"),this.container),this.states[e].directCallUI=new ye(this.states[e],document.querySelector(".onlycall_main"),this.container))},O.prototype.__getType=function(e){var t=this.container.constants;return-1!=[t.audio_unified_mix,t.audio_smart].indexOf(e)?t.audio:-1!=[t.screen_share_smart,t.screen_view_smart,t.screen_view].indexOf(e)?t.screen_share:e},O.prototype.updateCallInvitationState=function(e,t,i){e=this.__getType(e);var n={audio:{connecting:this.makeAudioCallConnecting,connected:this.makeAudioCallConnected,ended:this.makeAudioCallEnded,cancelled:this.makeAudioCallCancelled,rejected:this.makeAudioCallRejected,missed:this.makeAudioCallMissed,reconnecting:this.makeAudioReconnecting,failed:this.makeAudioCallFailed,showConsent:this.showAudioConsent},screen_share:{connecting:this.makeScreenShareConnecting,connected:this.makeScreenShareConnected,ended:this.makeScreenShareEnded,cancelled:this.makeScreenShareCancelled,rejected:this.makeScreenShareRejected,missed:this.makeScreenShareMissed,reconnecting:this.makeScreenShareReconnecting,failed:this.MakeScreenShareFailed,showConsent:this.showScreenConsent}},n=n[e]&&n[e][i];try{n&&n.call(this,e,t)}catch(e){}},O.prototype.playScreenShareStream=function(e){var t=e.stream,i=e.mid,e=(e.endCbk,e.chid),n=this.container.mediaUIHandler,e=(this.initiateHeadshot(e),this.states[e]);e.screen_share=e.screen_share||{},$.extend(!0,e,{screen_share:{stream:t,type:"viewing",status:"connected",media_id:i}});try{e.player||(e.player=new ge(e,this.siqdom,this.container),n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_PLAYER_SHOWN,add_info:n.getMediaActivityAddInfo()},mid:i}))}catch(e){}},O.prototype.handleAudioCallInvite=function(e,t){var i=this.container.mediaUIHandler,i=(q[t.chid]=T(t.chid)&&T(t.chid).attendername,"audio"==(e=this.__getType(e))?(this.showAudioCallInvitation(t),this.invitations=!0,i.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_INVITATION_SHOWN,add_info:i.getMediaActivityAddInfo()},mid:t.media_id||t.id})):"screen_share"==e&&this.showScreenShareInvitation(t),parent.document.querySelector(".zsiqmico-close"));i&&i.click()},O.prototype.clearAudioCallInvite=function(e,t,i){var n=this.container.mediaUIHandler;try{n.isEmbed()&&n.clearConformBox()&&n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:n.getMediaActivityAddInfo()},mid:t}),"audio"==e&&i&&this.__callTerminate(e,{chid:i,media_id:t,isDirectCall:!1},"rejected")}catch(e){}},O.prototype.showAudioCallInvitation=function(e){var t=e.chid,i=e.rejectCbk,n=e.acceptCbk,e=e.media_id,a=(this.initiateHeadshot(t),this.states[t]);$.extend(!0,a,{handler:this.handleActionHandler.bind(this),name:M,url:Ie,chid:t,audio:{mute:!1,media_id:e,reject_cbk:i,accept_cbk:n,is_invited:!0,status:"invited"}}),this.__updateState(t)},O.prototype.handleAudioCallInitiate=function(e,t){var i=this,n=t.chid,a=t.cancelCbk,o=t.muteCbk,s=t.media_id,t=t.isDirectCall,r=this.container.mediaUIHandler,c=(t?(this.states[n]=this.states.directcall,delete this.states.directcall):this.initiateHeadshot(n,t),q[n]=T(n)&&T(n).attendername,this.states[n]),d=parent.document.querySelector(".zsiqmico-close");d&&d.click(),$.extend(!0,c,{handler:this.handleActionHandler.bind(this),name:M,url:Ie,chid:n,audio:{mute:!!t&&c.audio.mute,media_id:s,reject_cbk:a,mute_cbk:function(){o(),$.extend(!0,c,{audio:{mute:!i.states[n].audio.mute}}),i.__updateState(n)},is_invited:!1,status:"requested"}}),this.__updateState(n),r.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_UI_SHOWN,add_info:r.getMediaActivityAddInfo()},mid:s})},O.prototype.initiateDirectCallUI=function(e){function t(){e(),$.extend(!0,o,{audio:{mute:!n.states[a].audio.mute}}),n.__updateState(a)}var i,n=this,a="directcall";if(e=void 0===e?null:e)return i=this.states[a],$.extend(!0,i,{audio:{mute:!1,mute_cbk:t,status:"initiated"}}),void this.__updateState(a);this.initiateHeadshot(a,!0);var o=this.states[a];$.extend(!0,o,{audio:{mute:!1,mute_cbk:t,status:"mediapermission"}}),this.__updateState(a)},O.prototype.makeAudioCallConnecting=function(e,t){var i=this,n=t.chid,a=t.muteCbk,o=t.rejectCbk,s=t.media_id,r=(t.name,t.isDirectCall),c=this.container.mediaUIHandler,d=this.states[n];EmbedSound.stop(),q[t.chid]=T(t.chid).attendername,$.extend(!0,d,{isDirectCall:r,audio:{mute_cbk:function(){a(),$.extend(!0,d,{audio:{mute:!i.states[n].audio.mute}}),i.__updateState(n)},reject_cbk:o,status:"connecting"}}),this.__updateState(n),c.checkCallHostType({chid:n,mid:s,hostType:"downstream"})&&c.sendMediaActivity({param:{action_type:w.activity.MEDIA_AUDIO_UI_SHOWN,add_info:c.getMediaActivityAddInfo()},mid:s}),r&&this.stopSoundNotification()},O.prototype.makeAudioCallConnected=function(e,t){t.media_id;var i=t.chid,n=t.callEndCbk,t=t.isDirectCall,a=this.container.constants.connected,o=(EmbedSound.stop(),this.initiateHeadshot(i),this.ss_invitation[i]&&delete this.ss_invitation[i],this.states[i]),s=o.audio.status==a?o.audio.connected_time:(new Date).getTime();$.extend(!0,o,{isDirectCall:t,audio:{reject_cbk:n,status:a,connected_time:s}}),setTimeout(this.startTimer.bind(this,i,e),500),this.__updateState(i)},O.prototype.makeAudioReconnecting=function(e,t){this.__makeReconnecting(e,t)},O.prototype.makeAudioCallEnded=function(e,t){this.__callTerminate(e,t,"ended")},O.prototype.makeAudioCallCancelled=function(e,t){this.__callTerminate(e,t,"cancelled")},O.prototype.makeAudioCallRejected=function(e,t){var i=t.isConsent||!1,n=this.states[t.chid],a=this.container.mediaUIHandler;n.isDirectCall&&(i?a.endSession(t.chid):a.initMissedChat(t.chid,"CALLENDED","2",!0)),this.__callTerminate(e,t,"rejected")},O.prototype.makeAudioCallMissed=function(e,t){this.__callTerminate(e,t,"missed")},O.prototype.makeAudioCallFailed=function(e,t){this.__callTerminate(e,t,"failed")},O.prototype.__recordSound=function(e,t,i,n,a){var o,s,r,c=this,d=this.container.mediaUIHandler,l=d.isChatExist(e),u=d.getAttenderId(e),p=this.states&&this.states[e]&&this.states[e].screen_share&&"connected"==this.states[e].screen_share.status;(d.getSupportRepCount(e)<2&&l&&!p&&("rejected"==n&&u==i||"missed"==n)||t)&&(o=this.container,d=t,r=a,(p=(l=M)(s=e))&&p[0].toLowerCase(),$Support.EmbedObj.clogo,p=$Support.EmbedObj.embedname,p=m(I("div",{class:"siqdc-home",id:"audiorec"},d?I("div",null,I("div",{class:"siqdc-homehdr"},p||""),I("p",{class:"siqdc-homedec",id:"sqico-timer"},LSResource.getRealValue("av.info.oprbusy"))):I("div",null,I("div",{class:"siqdc-homehdr"},l&&l(s)||""),I("p",{class:"siqdc-homedec"},LSResource.getRealValue("av.info.userbusy"))),I("div",{class:"flexG w100",id:"sqico-canvas"}),I("div",{class:"siqdc-icons"},I("span",{class:"siqdc-iconsub",id:"startRecord"},I("em",{class:"sqico-record",onclick:function(){document.querySelector(".onlycall_main");window.currentRecorder&&window.currentRecorder.destroy();var e=Recorder();o.uiHandler.setCallUIposition("#user_busy"),(window.currentRecorder=e).init(!0,s,r)}}),I("span",null,LSResource.getRealValue("av.info.voicemsg"))),I("span",{class:"siqdc-iconsub",cntrl:"recordAgain",style:"display:none"},I("em",{class:"sqico-record",cntrl:"recordAgain"}),I("span",null,LSResource.getRealValue("av.info.voicemsg"))),I("span",{class:"siqdc-iconsub",cntrl:"playRecord",style:"display:none"},I("em",{class:"sqico-play",cntrl:"playRecord"}),I("span",null," ",LSResource.getRealValue("av.info.play"))),I("span",{class:"siqdc-iconsub",cntrl:"pauseRecord",style:"display:none"},I("em",{class:"sqico-pause",cntrl:"pauseRecord"}),I("span",null," ",LSResource.getRealValue("av.info.pause"))),I("div",{class:"progress flexM",cntrl:"stopRecord",style:"display:none"},I("svg",{class:"progress-circle",width:"160px",height:"160px",xmlns:"http://www.w3.org/2000/svg"},I("circle",{class:"progress-circle-back",cx:"107",cy:"47",r:"44"}),I("circle",{class:"progress-circle-prog",cx:"107",cy:"47",r:"44"})),I("em",{class:"siqico-stop",cntrl:"stopRecord"}),I("span",null," ",LSResource.getRealValue("av.info.stop"))),I("span",{class:"siqdc-iconsub",cntrl:"uploadRecord",style:"display:none"},I("em",{class:"sqico-videosend",cntrl:"uploadRecord"}),I("span",null,LSResource.getRealValue("av.info.send")))))),d&&(CallImpl.isCallWithChat=!0),document.querySelector(".onlycall_main").append(p),this.__updateState(e),$(".zsiq_media_headshot_main .zsiqmico-close").on("click",function(){return c.__updateState(e)}))},O.prototype.__callTerminate=function(e,t,i){var n,a=this,o=t.chid,s=t.media_id,r=t.isDirectCall,c=t.lsuid,t=this.container.mediaUIHandler,d=this.states[o],l=Boolean(d.audio&&d.audio.is_invited);t.checkIsChatEndTimerAlive(o)||t.stopNotifSound(),d&&d.audio?(this.invitations=l?null:this.invitations,$.extend(!0,d,{audio:{status:i}}),"rejected"!=i&&"missed"!=i||r||this.setCallUIposition(".zsiq_media_headshot_main"),setTimeout(function(){var e=d.isDirectCall;delete d.audio,a.__updateState(o),a.__checkAndDestroyInstance(o),l||-1==["rejected","missed"].indexOf(i)||a.__recordSound(o,e,c,i,s),e&&"ended"==i&&a.implementRatingUI(o),e&&"cancelled"==i&&a.directCallCancelled()},500),this.__updateState(o),n=t.checkCallHostType({chid:o,mid:s,hostType:"downstream"})&&["cancelled","rejected","missed"].includes(i)?w.activity.MEDIA_AUDIO_INVITATION_CLEARED:w.activity.MEDIA_AUDIO_UI_CLEARED,t.getActiveTab()&&t.sendMediaActivity({param:{action_type:n,add_info:t.getMediaActivityAddInfo()},mid:s}),r&&(this.stopSoundNotification(),clearTimeout(t.getChatWinObjById(o).waitTimer))):d&&this.__checkAndDestroyInstance(o)},O.prototype.__checkAndDestroyInstance=function(e){try{var t=Object.keys(this.states[e]);0==["audio","screen_share"].filter(function(e){return-1!=t.indexOf(e)}).length&&(this.stopTimer(e),delete this.states[e])}catch(e){}},O.prototype.setCallUIposition=function(e){var t,i=this.container.mediaUIHandler,e=$(H()).find(e);e[0]&&(e=getComputedStyle(e[0]),t=parseInt(e.getPropertyValue("left"))||0,e=parseInt(e.getPropertyValue("top"))||0,i.setCallUIPosition(e,t))},O.prototype.showScreenShareInvitation=function(e){function t(){h.clearConformBox()&&h.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:h.getMediaActivityAddInfo()},mid:p}),u()}function i(e){void 0===e&&(e=!0),h.clearConformBox()&&h.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_CLEARED,add_info:h.getMediaActivityAddInfo()},mid:p}),e&&l()}var n,a,o,s,r,c,d=e.chid,l=e.rejectCbk,u=e.acceptCbk,p=e.media_id,h=this.container.mediaUIHandler;this.initiateHeadshot(d);n=(e={name:M,acceptHandler:t,rejectHandler:i,chid:d}).name,a=e.acceptHandler,o=e.rejectHandler,e=e.chid,s=(r=SiqAVRouter.container).mediaUIHandler,r=r.uiHandler,c=s.getMediaIdByChid(e),c=s.getCallStatusData(c),r=r.__getConsentContent("screen"),n=m(I("div",{class:"zsiq_popup",id:"zsiqssconfirmbox"},I("div",{class:"zsiq_popupsub"},I("div",{class:"zsiq_popup_child"},I("em",{class:"siqico-close zsiq_center",onClick:o}),I("em",{class:"siqico-screenshare zsiq_popuplogo"}),I("div",{class:"zsiq_popup_hdr"},LSResource.getRealValue("common.screensharerequest")),I("div",{class:"zsiq_popup_desc"},LSResource.getRealValue("screenshare.request.desc",n(e))),I("div",{class:"zsiq_popup_btn zsiq_center"},I("span",{class:"zsiq_center",id:"zsiqconfirmss",onClick:a},LSResource.getRealValue("common.share")),I("span",{class:"zsiq_center zsiq_cancelbtn",id:"zsiqdecliness",onClick:o},LSResource.getRealValue("common.decline")))),s.isScreenRecordingEnabled()&&s.isScreenRecordAllowed()&&!s.isScreenConsentAllowed()&&"smart"==c.connection_type?I("div",{class:"siq-note-cont"},I("div",{class:"siq-note-title"},LSResource.getRealValue("common.disclaimer")," "),I("p",{class:"siq-note-desc"},r," ")):""))),$(H()).append(n),h.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_CONFIRMBOX_SHOWN,add_info:h.getMediaActivityAddInfo()},mid:p}),this.ss_invitation[d]={rejectHandler:i,acceptHandler:t,media_id:p,template:n}},O.prototype.showScreenShareMaking=function(e,t){var i=t.chid,n=t.cancelCbk,a=t.media_id,t=t.ss_type,o=(this.initiateHeadshot(i),this.states[i]),t=t||(0==this.container.mediaUIHandler.getScreenShareType(i,a)?"sharing":"viewing");$.extend(!0,o,{handler:this.handleActionHandler.bind(this),name:M,url:Ie,chid:i,screen_share:{media_id:a,reject_cbk:n,status:"requested",type:t}}),this.__updateState(i)},O.prototype.makeScreenShareConnecting=function(e,t){var i=t.chid,n=t.muteCbk,a=t.rejectCbk,o=t.media_id,t=(t.name,t.ss_type),s=(q[i]=T(i).attendername,this.initiateHeadshot(i),this.states[i]),t=t||(0==this.container.mediaUIHandler.getScreenShareType(i,o)?"sharing":"viewing");$.extend(!0,s,{handler:this.handleActionHandler.bind(this),name:M,url:Ie,chid:i,screen_share:{media_id:o,mute_cbk:n,reject_cbk:a,status:"connecting",type:t}}),this.__updateState(i)},O.prototype.makeScreenShareConnected=function(e,t){var i=this,n=this.container.mediaUIHandler,a=t.media_id,o=t.chid,s=t.callEndCbk,t=t.ss_type,r=(q[o]=T(o).attendername,this.initiateHeadshot(o),this.states[o]),t=t||(0==n.getScreenShareType(o,a)?"sharing":"viewing");$.extend(!0,r,{handler:this.handleActionHandler.bind(this),name:M,url:Ie,screen_share:{reject_cbk:s,status:"connected",connected_time:(new Date).getTime(),type:t,media_id:a,swap_cbk:function(){return i.__swapScreen(n.getActiveMediaID(o),o)}}}),setTimeout(this.startTimer.bind(this,o,e),500),this.__updateState(o)},O.prototype.makeScreenShareReconnecting=function(e,t){this.__makeReconnecting(e,t)},O.prototype.makeScreenShareEnded=function(e,t){this.__ssTerminate(e,t,"ended")},O.prototype.makeScreenShareCancelled=function(e,t){this.__ssTerminate(e,t,"cancelled")},O.prototype.makeScreenShareRejected=function(e,t){this.__ssTerminate(e,t,"rejected")},O.prototype.makeScreenShareMissed=function(e,t){this.__ssTerminate(e,t,"missed")},O.prototype.MakeScreenShareFailed=function(e,t){this.__ssTerminate(e,t,"failed")},O.prototype.__ssTerminate=function(e,t,i){var n=this,a=t.chid,o=(t.media_id,this.states[a]);this.ss_invitation[a]&&(this.ss_invitation[a].rejectHandler(!1),delete this.ss_invitation[a]),o&&o.screen_share?(o&&o.screen_share&&!o.audio&&this.stopTimer(a,e),$.extend(!0,o,{screen_share:{status:i}}),setTimeout(function(){delete o.screen_share,n.__updateState(a),n.__checkAndDestroyInstance(a),n.deletePlayer(a)},500),this.__updateState(a)):o&&this.__checkAndDestroyInstance(a)},O.prototype.showDialog=function(){},O.prototype.enableOutingCallUI=function(){},O.prototype.handleActionHandler=function(e,t,i){e=this.states[e]&&this.states[e][t]&&this.states[e][t][i+"_cbk"];e&&e.call(this)},O.prototype.getTimeDiff=function(e){var e=(new Date).getTime()-e,t=(t=Math.floor(e%36e5/6e4))<10?"0"+t:t,e=(e=Math.floor(e%6e4/1e3))<10?"0"+e:e;return isFinite(t)&&isFinite(e)?t+":"+e:""},O.prototype.startTimer=function(t,e){var i,n=this;this.states[t].timer_ref||(i=this.states[t][e].connected_time,this.states[t].timer_ref=setInterval(function(){var e=n.states[t];$.extend(!0,e,{timer:n.getTimeDiff(i)}),n.__updateState(t)},1e3))},O.prototype.stopTimer=function(e){e=this.states[e];clearInterval(e.timer_ref),delete e.timer,this.__updateState(e.chid)},O.prototype.playSoundNotification=function(e,t){var i=this.container.constants.WAITING_TIME_SECS;this.container.mediaUIHandler.playNotifSound({type:t=void 0===t?"audiocall":t,duration:i,tone:e=void 0===e?"incomingcall":e})},O.prototype.stopSoundNotification=function(){this.container.mediaUIHandler.stopNotifSound()},O.prototype.__updateState=function(e){e=this.states[e];e&&[e.headshot,e.headshotInvite,e.player,e.directCallUI].forEach(function(e){e&&e.updateState()}),this.handleMinimizeState()},O.prototype.__swapScreen=function(t,e){var i=this.container.mediaUIHandler,n=(i.getEncryChid(e),T(e),function(e){"Escape"===e.key&&($(H()).find(".zsiq_media_popup").remove(),window.parent.removeEventListener("keydown",n),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:i.getMediaActivityAddInfo()},mid:t}))}),a=m(I("div",{class:"zsiq_media_popup"},I("span",null,LSResource.getRealValue("screenshare.swap.sharing")),I("div",{class:"zsiq_media_btn"},I("span",{onClick:function(){$(a).remove(),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SWAP},mid:t}),i.swapScreenShare({chid:e,id:t}),window.parent.removeEventListener("keydown",n),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:i.getMediaActivityAddInfo()},mid:t})}},LSResource.getRealValue("common.continue")),I("span",{class:"zsiq_media_cancelbtn",onClick:function(){window.parent.removeEventListener("keydown",n),$(a).remove(),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_CLEARED,add_info:i.getMediaActivityAddInfo()},mid:t})}},LSResource.getRealValue("common.cancel")))));$(H()).append(a),i.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_POPUP_SHOWN,add_info:i.getMediaActivityAddInfo()},mid:t}),window.parent.addEventListener("keydown",n),window.parent.focus()},O.prototype.__makeReconnecting=function(e,t){var i=t.chid,t=t.media_id,i=(this.states[i][e="viewing"==this.getCurrentScreenshareType(i)?"screen_share":e].status="reconnecting",this.__updateState(i),"audio"==e?w.activity.MEDIA_AUDIO_RECONNECT_STATE:w.activity.MEDIA_SCREENSHARE_RECONNECT_STATE);this.container.mediaUIHandler.sendMediaActivity({param:{action_type:i},mid:t})},O.prototype.shareScreen=function(e,t,i){var n=this.container.mediaUIHandler,a=n.getMediaIdByChid(e),o=n.getCallStatusData(a);n.sendMediaActivity({param:{action_type:w.activity.MEDIA_SCREENSHARE_SHARESCREEN},mid:a}),o.connection_type==w.connectionType.PEER2PEER||n.isScreenConsentAllowed()||!n.isScreenRecordingEnabled()||"audio_call"==n.getMediaRecordingConsentDetails().type?n.addScreenShareTrack({chid:e,id:a}):n.showScreenShareConsentUI(a)},O.prototype.mediaPermissionUI=function(e){e=e,t=getBrowserFromUserAgent(navigator.userAgent).split("-")[0];var t,i,n=i=m(I("div",{class:"zsiq_prv_main zsiq-cal-turtrp",id:"allowmicbannerui",onClick:function(){window.currentRecorder&&window.currentRecorder.destroy(),$(i).remove()}},I("div",{class:"zsiq-cal-hnt-cont "+("Chrome"==t?"":"zsiq-"+t)},I("div",{class:"zsiq-trtp-anim"}),I("span",{class:"siqico-arrow zsiq-arrow"}),I("span",{class:"zsiq-alw-mic siqico-mic"}),I("div",{class:"zsiq-alw-mic-desc",html:e?LSResource.getRealValue("voicenotes.info.pleaseallowmicrophone"):LSResource.getRealValue("av.info.pleaseallowmicrophone")}))));return $(H()).append(n),function(){return $(n).remove()}},O.prototype.mediaPermissionUnlock=function(e){t=e,a=getBrowserFromUserAgent(navigator.userAgent).split("-")[0];var t,i,n=i=m(I("div",{class:"zsiq_prv_main zsiq-cal-turtrp",onClick:function(){window.currentRecorder&&window.currentRecorder.destroy(),$(i).remove()}},I("div",{class:"zsiq-cal-hnt-cont zsiq-isblk "+("Chrome"==a?"":"zsiq-"+a)},I("div",{class:"zsiq-trtp-anim "}),I("span",{class:"siqico-arrow zsiq-arrow"}),I("div",{html:t?LSResource.getRealValue("voicenotes.info.pleasetaponlock","<em class='siqico-lock'></em>"):LSResource.getRealValue("av.info.pleasetaponlock","<em class='siqico-lock'></em>")}),I("p",null,"(",LSResource.getRealValue("common.or"),")"),I("div",null,LSResource.getRealValue("av.info.enablemicrophonesetting")),I("div",{class:"calndr-sedulbtn",style:"",onclick:fe}," ",LSResource.getRealValue("chatwindow.mailcopy.clickhere")," ")))),a=($(H()).append(n),$(H()).find("#allowmicbannerui").remove(),e?LSResource.getRealValue("voicenotes.info.microphone.blocked"):LSResource.getRealValue("av.info.microphone.blocked"));return $UI.showBanner(a,!0,null,8e3),function(){return $(n).remove()}},O.prototype.handleCallClash=function(e,t){e()},O.prototype.handleMinimizeState=function(){var e=this.invitations,t=this.container.mediaUIHandler.getActiveCallData();e||t?($Support.getParent().$ZSIQWidgetUI.updateCallUI(),e?$Support.getParent().$ZSIQWidgetUI.updateIncomingCallUI():$Support.getParent().$ZSIQWidgetUI.removeIncomingCallUI()):$Support.getParent().$ZSIQWidgetUI.removeCallUI()},O.prototype.forceEndCall=function(){var e,t=this.container.mediaUIHandler;for(e in this.states)t.endCallByChid(e),t.triggerIconCheck(e)},O.prototype.implementRatingUI=function(e){var t,i,n=this.container.mediaUIHandler,a=(t=e,i=m(I("div",{class:"siqdc-home"},I("div",{class:"siqdc-homehdr"},(a=M)&&a(t)),I("p",{class:"siqdc-homedec"},LSResource.getRealValue("av.info.rating")),I("div",{class:"siqdc-icons dc-radin"},I("span",{class:"siqdc-iconsub"},I("em",{class:"reaction_ico sad_icon","data-reaction":"sad",documentclick:"sendCallRating"}),I("span",null,LSResource.getRealValue("common.sad"))),I("span",{class:"siqdc-iconsub"},I("em",{class:"reaction_ico neutral_icon","data-reaction":"neutral",documentclick:"sendCallRating"}),I("span",null,LSResource.getRealValue("common.neutral"))),I("span",{class:"siqdc-iconsub"},I("em",{class:"reaction_ico happy_icon","data-reaction":"happy",documentclick:"sendCallRating"}),I("span",null,LSResource.getRealValue("common.happy")))),I("span",{class:"dcskip flexC",onclick:function(){$(i).remove(),$Support.showCallList(),$("body").removeClass("onlycallview"),$Support.container.find("header").removeClass("siqdc-hdr")}},LSResource.getRealValue("common.skip")," ",I("em",{class:"sqico-skip flexM"})))));CallImpl.isCallWithChat=n.getEncryChid(e),SiqAVRouter.chatwinobj=n.getChatWinObjById(e),n.getChatWinObjById(e).hideMaskDiv(),JSON.parse($Support.EmbedObj.eprops.reaction[0])?document.querySelector(".onlycall_main").append(a):this.implementRatingFdbkUI(SiqAVRouter.chatwinobj)},O.prototype.implementRatingFdbkUI=function(e){e=e,ZSIQConversationManager.getChatWinObjById(e.chatID).RCHID,$Support.isSignature($Support.EmbedObj);var t,e=t=m(I("div",{class:"siqdc-home"},I("div",{class:"dc-feedback"},I("div",{class:"flexC"},e.rating?I("span",{calss:"reaction_ico "+e.rating+"_icon"}):"",I("span",{class:"reaction_ico neutral_icon"}),I("span",null,"Feedback"),I("span",{class:"sqico-close flexM",onclick:function(){$(t).remove(),$Support.showCallList(),$("body").removeClass("onlycallview"),$Support.container.find("header").removeClass("siqdc-hdr")}})),I("input",{type:"text",dockeyup:"feedback",dockeydown:"textarea",id:"fdbkarea","data-validate":"required",placeholder:LSResource.getRealValue("av.info.fdkbckmsg"),autofocus:"",style:"overflow: hidden;"}),I("div",{class:"dcsave-btn flexM",documentclick:"sendCallFb"},LSResource.getRealValue("embed.submit")))));JSON.parse($Support.EmbedObj.eprops.feedback[0])?($(".siqdc-home").remove(),document.querySelector(".onlycall_main").append(e)):this.directCallCancelled()},O.prototype.implementFdbkSuccessUI=function(e){$("body").removeClass("onlycallview"),$Support.container.find("header").removeClass("siqdc-hdr"),$(".siqdc-home").remove(),$Support.showCallList()},O.prototype.directCallCancelled=function(){$("#audiorec,#audiocal").remove(),$("body").prepend(CallUIHandler.getCallCancelledHtml()),$Support.isSignature($Support.EmbedObj)&&$("div.actbtn").remove(),$($Support.getParent().document.body).find(".siqembed").removeClass("zsiq_size2"),$Support.getParent().$ZSIQWidgetUI.handleMinCall()},O.prototype.deleteScreenShareState=function(e){this.states[e]&&this.states[e].screen_share&&delete this.states[e].screen_share},O.prototype.deletePlayer=function(e){this.states[e]&&this.states[e].player&&(clearTimeout(this.states[e].player.showCntrlTimer),delete this.states[e].player)},O.prototype.clearAllStates=function(e){this.states[e]&&delete this.states[e]},O.prototype.getCurrentScreenshareType=function(e){e=this.states[e];return e&&e.screen_share&&e.screen_share.type?e.screen_share.type:null},O.prototype.getUIPosition=function(e){e=getComputedStyle(this.siqdom.querySelector(e));if(e)return{left:parseInt(e.getPropertyValue("left"))||0,top:parseInt(e.getPropertyValue("top"))||0,bottom:parseInt(e.getPropertyValue("bottom"))||0,right:parseInt(e.getPropertyValue("right"))||0,width:parseInt(e.getPropertyValue("width"))||0,height:parseInt(e.getPropertyValue("height"))||0}},O.prototype.showAudioConsent=function(e,t){t.chid;var i=t.rejectCbk,t=t.acceptCbk,i={consent:{desc:this.__getConsentContent("audio"),title:LSResource.getRealValue("av.info.recordingconsent.title"),show:!0,reject_cbk:i,accept_cbk:t,type:w.audio}};$Support.container.find(".onlycall_main").append(Ce(i))},O.prototype.showScreenConsent=function(e,t){var i=t.rejectCbk,t=t.acceptCbk,i={consent:consent={desc:this.__getConsentContent("screen"),title:LSResource.getRealValue("av.info.recordingconsent.title"),show:!0,reject_cbk:i,accept_cbk:t,type:w.screen}};$Support.container.find(".onlycall_main").append(Ce(i))},O.prototype.__getConsentContent=function(e){var t=this.container.mediaUIHandler.getMediaRecordingConsentDetails(),t={audio_default:LSResource.getRealValue("av.info.audiorecordingconsent.defaultvalue"),screen_default:LSResource.getRealValue("av.info.screenrecordingconsent.defaultvalue"),audio:t&&t.call_consent_message,screen:t&&t.screenshare_consent_message};return t[e]||t[e+"_default"]},O.prototype.clearConsentState=function(e){$("#onlycallconsent").remove()},$(document).ready(function(){var e,n={},t=$Support.getParent();(e=n).commonImpl=new K(e),e.audioImpl=new W(e),e.videoImpl=new G(e),e.screen_shareImpl=new F(e),n.ajaxHandler=new d(n),n.detailsHandler=new h(n),n.mediaUIHandler=new E(n),n.detailsHandler.isOnlyCallEnabled()?n.uiHandler=new O(n):n.uiHandler=new c(n),n.logger=LSDebugger.postDebugInfo,n.lsrouter=new b(n),window.SiqAVRouter=new he(n),window.avUIhandler=n.uiHandler,n.commonImpl.checkOnGoingCall(),n.checkDirectCallOnload=function(){var e,t,i=n.commonImpl.getMediaCache(n.constants.siq_directcall),i=(i&&i.is_refreshed&&(e=i.chid,t=i.media_id,i.type,"outgoing"==(i=i.status)?($Support.audioid=t,n.detailsHandler.initMissedChat(e,"CALLENDED","2",!0)):"connected"==i&&(n.audioImpl.endOngoingCall(e,t),n.detailsHandler.endSession(e)),n.commonImpl.removeMediaCache(n.constants.siq_directcall)),n.commonImpl.getMediaCache(n.constants.siq_unifiedMedia));i&&i.is_refreshed&&(n.commonImpl.handleMediaOnRefresh(i),n.commonImpl.removeMediaCache(n.constants.siq_unifiedMedia))},!n.detailsHandler.isChatLive()&&t.$zohosq.values.initiatecall&&t.$zohosq.call.start(),!n.detailsHandler.isChatLive()&&t.$zohosq.values.isDirectCall&&t.$zohosq.call.start(),t.$zohosq.values.isInitialLoad&&t.$zohosq.values.initialLoadData&&n.lsrouter.handleMessage(t.$zohosq.values.initialLoadData)})}();
